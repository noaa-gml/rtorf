<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>surface-insitu â€¢ rtorf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="surface-insitu">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtorf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/aircore.html">aircore</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-flask.html">aircraft-flask</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-insitu.html">aircraft-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-pfp.html">aircraft-pfp</a></li>
    <li><a class="dropdown-item" href="../articles/shipboard-flask.html">shipboard-flask</a></li>
    <li><a class="dropdown-item" href="../articles/shipoboard-insitu.html">shipboard-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/summary.html">summary</a></li>
    <li><a class="dropdown-item" href="../articles/surface-flask.html">surface-flask</a></li>
    <li><a class="dropdown-item" href="../articles/surface-insitu.html">surface-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/surface-pfp.html">surface-pfp</a></li>
    <li><a class="dropdown-item" href="../articles/tower-insitu.html">tower-insitu</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/noaa-gml/rtorf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>surface-insitu</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/noaa-gml/rtorf/blob/main/vignettes/surface-insitu.Rmd" class="external-link"><code>vignettes/surface-insitu.Rmd</code></a></small>
      <div class="d-none name"><code>surface-insitu.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/noaa-gml/rtorf" class="external-link">rtorf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aircraft-pfp"</span>,</span>
<span>         <span class="st">"aircraft-insitu"</span>,</span>
<span>         <span class="st">"aircraft-flask"</span>,</span>
<span>         <span class="st">"surface-insitu"</span>,</span>
<span>         <span class="st">"surface-flask"</span>, </span>
<span>         <span class="st">"surface-pfp"</span>,   </span>
<span>         <span class="st">"tower-insitu"</span>,  </span>
<span>         <span class="st">"aircore"</span>,       </span>
<span>         <span class="st">"shipboard-insitu"</span>,</span>
<span>         <span class="st">"shipboard-flask"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="st">"Z:/torf/obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08/data/nc/"</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_summary.html">obs_summary</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>                     categories <span class="op">=</span> <span class="va">cate</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Number of files of index: 429</span></span>
<span><span class="co">#&gt;               sector     N</span></span>
<span><span class="co">#&gt;               &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1:     aircraft-pfp    40</span></span>
<span><span class="co">#&gt;  2:  aircraft-insitu    15</span></span>
<span><span class="co">#&gt;  3:    surface-flask   106</span></span>
<span><span class="co">#&gt;  4:   surface-insitu   174</span></span>
<span><span class="co">#&gt;  5:   aircraft-flask     4</span></span>
<span><span class="co">#&gt;  6:          aircore     1</span></span>
<span><span class="co">#&gt;  7:      surface-pfp    33</span></span>
<span><span class="co">#&gt;  8:     tower-insitu    51</span></span>
<span><span class="co">#&gt;  9:  shipboard-flask     4</span></span>
<span><span class="co">#&gt; 10: shipboard-insitu     1</span></span>
<span><span class="co">#&gt; 11:    Total sectors   429</span></span>
<span><span class="co">#&gt; Detected 190 files with agl</span></span>
<span><span class="co">#&gt; Detected 239 files without agl</span></span></code></pre>
<p>Now we read the <code>surface-insitu</code> using the function
<code>obs_read_nc</code>. <code>solar_time</code> is included for
surface, so we <code>TRUE</code> that argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datasetid</span> <span class="op">&lt;-</span> <span class="st">"surface-insitu"</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_read_nc.html">obs_read_nc</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">index</span>,</span>
<span>                  categories <span class="op">=</span> <span class="va">datasetid</span>,</span>
<span>                  solar_time <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Searching surface-insitu...</span></span>
<span><span class="co">#&gt; 1: ch4_abt_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 2: ch4_alt_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 3: ch4_amy_surface-insitu_61_allvalid.nc</span></span>
<span><span class="co">#&gt; 4: ch4_bck_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 5: ch4_bhd_surface-insitu_15_baseline.nc</span></span>
<span><span class="co">#&gt; 6: ch4_bir_surface-insitu_442_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 7: ch4_bir_surface-insitu_442_allvalid-50magl.nc</span></span>
<span><span class="co">#&gt; 8: ch4_bir_surface-insitu_442_allvalid-75magl.nc</span></span>
<span><span class="co">#&gt; 9: ch4_blk_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 10: ch4_bra_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 11: ch4_brw_surface-insitu_1_allvalid.nc</span></span>
<span><span class="co">#&gt; 12: ch4_buc_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 13: ch4_carl_surface-insitu_60_allvalid-9magl.nc</span></span>
<span><span class="co">#&gt; 14: ch4_cbw_surface-insitu_118_allvalid.nc</span></span>
<span><span class="co">#&gt; 15: ch4_cby_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 16: ch4_cdl_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 17: ch4_chl_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 18: ch4_chm_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 19: ch4_cmn_surface-insitu_106_allvalid.nc</span></span>
<span><span class="co">#&gt; 20: ch4_cmn_surface-insitu_442_allvalid-8magl.nc</span></span>
<span><span class="co">#&gt; 21: ch4_cps_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 22: ch4_cpt_surface-insitu_36_marine.nc</span></span>
<span><span class="co">#&gt; 23: ch4_cvo_surface-insitu_456_allvalid.nc</span></span>
<span><span class="co">#&gt; 24: ch4_dnh_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 25: ch4_egb_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 26: ch4_ena_surface-insitu_64_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 27: ch4_esp_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 28: ch4_est_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 29: ch4_etl_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 30: ch4_fne_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 31: ch4_fort_surface-insitu_60_allvalid-128magl.nc</span></span>
<span><span class="co">#&gt; 32: ch4_fsd_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 33: ch4_gat_surface-insitu_442_allvalid-132magl.nc</span></span>
<span><span class="co">#&gt; 34: ch4_gat_surface-insitu_442_allvalid-216magl.nc</span></span>
<span><span class="co">#&gt; 35: ch4_gat_surface-insitu_442_allvalid-30magl.nc</span></span>
<span><span class="co">#&gt; 36: ch4_gat_surface-insitu_442_allvalid-341magl.nc</span></span>
<span><span class="co">#&gt; 37: ch4_gat_surface-insitu_442_allvalid-60magl.nc</span></span>
<span><span class="co">#&gt; 38: ch4_ghg03_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 39: ch4_ghg06_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 40: ch4_ghg09_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 41: ch4_ghg10_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 42: ch4_hct_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 43: ch4_hel_surface-insitu_442_allvalid-110magl.nc</span></span>
<span><span class="co">#&gt; 44: ch4_hnp_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 45: ch4_hobb_surface-insitu_60_allvalid-91magl.nc</span></span>
<span><span class="co">#&gt; 46: ch4_hpb_surface-insitu_442_allvalid-131magl.nc</span></span>
<span><span class="co">#&gt; 47: ch4_hpb_surface-insitu_442_allvalid-50magl.nc</span></span>
<span><span class="co">#&gt; 48: ch4_hpb_surface-insitu_442_allvalid-93magl.nc</span></span>
<span><span class="co">#&gt; 49: ch4_htm_surface-insitu_442_allvalid-150magl.nc</span></span>
<span><span class="co">#&gt; 50: ch4_htm_surface-insitu_442_allvalid-30magl.nc</span></span>
<span><span class="co">#&gt; 51: ch4_htm_surface-insitu_442_allvalid-70magl.nc</span></span>
<span><span class="co">#&gt; 52: ch4_inu_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 53: ch4_inx01_surface-insitu_60_allhours-10magl.nc</span></span>
<span><span class="co">#&gt; 54: ch4_inx01_surface-insitu_60_allhours-121magl.nc</span></span>
<span><span class="co">#&gt; 55: ch4_inx01_surface-insitu_60_allhours-40magl.nc</span></span>
<span><span class="co">#&gt; 56: ch4_inx02_surface-insitu_60_allhours-10magl.nc</span></span>
<span><span class="co">#&gt; 57: ch4_inx02_surface-insitu_60_allhours-136magl.nc</span></span>
<span><span class="co">#&gt; 58: ch4_inx02_surface-insitu_60_allhours-40magl.nc</span></span>
<span><span class="co">#&gt; 59: ch4_inx03_surface-insitu_60_allhours-10magl.nc</span></span>
<span><span class="co">#&gt; 60: ch4_inx03_surface-insitu_60_allhours-20magl.nc</span></span>
<span><span class="co">#&gt; 61: ch4_inx03_surface-insitu_60_allhours-40magl.nc</span></span>
<span><span class="co">#&gt; 62: ch4_inx03_surface-insitu_60_allhours-54magl.nc</span></span>
<span><span class="co">#&gt; 63: ch4_inx04_surface-insitu_60_allhours-60magl.nc</span></span>
<span><span class="co">#&gt; 64: ch4_inx05_surface-insitu_60_allhours-125magl.nc</span></span>
<span><span class="co">#&gt; 65: ch4_inx07_surface-insitu_60_allhours-21magl.nc</span></span>
<span><span class="co">#&gt; 66: ch4_inx07_surface-insitu_60_allhours-58magl.nc</span></span>
<span><span class="co">#&gt; 67: ch4_inx08_surface-insitu_60_allhours-41magl.nc</span></span>
<span><span class="co">#&gt; 68: ch4_inx09_surface-insitu_60_allhours-130magl.nc</span></span>
<span><span class="co">#&gt; 69: ch4_inx10_surface-insitu_60_allhours-40magl.nc</span></span>
<span><span class="co">#&gt; 70: ch4_inx11_surface-insitu_60_allhours-130magl.nc</span></span>
<span><span class="co">#&gt; 71: ch4_inx13_surface-insitu_60_allhours-87magl.nc</span></span>
<span><span class="co">#&gt; 72: ch4_inx14_surface-insitu_60_allhours-76magl.nc</span></span>
<span><span class="co">#&gt; 73: ch4_inx15_surface-insitu_60_allhours-75magl.nc</span></span>
<span><span class="co">#&gt; 74: ch4_ipr_surface-insitu_442_allvalid-100magl.nc</span></span>
<span><span class="co">#&gt; 75: ch4_ipr_surface-insitu_442_allvalid-40magl.nc</span></span>
<span><span class="co">#&gt; 76: ch4_ipr_surface-insitu_442_allvalid-60magl.nc</span></span>
<span><span class="co">#&gt; 77: ch4_izo_surface-insitu_27_allvalid.nc</span></span>
<span><span class="co">#&gt; 78: ch4_jfj_surface-insitu_442_allvalid-5magl.nc</span></span>
<span><span class="co">#&gt; 79: ch4_jfj_surface-insitu_5_allvalid.nc</span></span>
<span><span class="co">#&gt; 80: ch4_jgs_surface-insitu_61_allvalid.nc</span></span>
<span><span class="co">#&gt; 81: ch4_jue_surface-insitu_442_allvalid-120magl.nc</span></span>
<span><span class="co">#&gt; 82: ch4_jue_surface-insitu_442_allvalid-50magl.nc</span></span>
<span><span class="co">#&gt; 83: ch4_jue_surface-insitu_442_allvalid-80magl.nc</span></span>
<span><span class="co">#&gt; 84: ch4_kit_surface-insitu_442_allvalid-100magl.nc</span></span>
<span><span class="co">#&gt; 85: ch4_kit_surface-insitu_442_allvalid-200magl.nc</span></span>
<span><span class="co">#&gt; 86: ch4_kit_surface-insitu_442_allvalid-30magl.nc</span></span>
<span><span class="co">#&gt; 87: ch4_kit_surface-insitu_442_allvalid-60magl.nc</span></span>
<span><span class="co">#&gt; 88: ch4_kre_surface-insitu_442_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 89: ch4_kre_surface-insitu_442_allvalid-125magl.nc</span></span>
<span><span class="co">#&gt; 90: ch4_kre_surface-insitu_442_allvalid-250magl.nc</span></span>
<span><span class="co">#&gt; 91: ch4_kre_surface-insitu_442_allvalid-50magl.nc</span></span>
<span><span class="co">#&gt; 92: ch4_krk_surface-insitu_118_allvalid.nc</span></span>
<span><span class="co">#&gt; 93: ch4_lew_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 94: ch4_lin_surface-insitu_442_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 95: ch4_lin_surface-insitu_442_allvalid-2.5magl.nc</span></span>
<span><span class="co">#&gt; 96: ch4_lin_surface-insitu_442_allvalid-40magl.nc</span></span>
<span><span class="co">#&gt; 97: ch4_lin_surface-insitu_442_allvalid-98magl.nc</span></span>
<span><span class="co">#&gt; 98: ch4_llb_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 99: ch4_lmp_surface-insitu_442_allvalid-8magl.nc</span></span>
<span><span class="co">#&gt; 100: ch4_lut_surface-insitu_118_allvalid.nc</span></span>
<span><span class="co">#&gt; 101: ch4_lut_surface-insitu_442_allvalid-60magl.nc</span></span>
<span><span class="co">#&gt; 102: ch4_malj_surface-insitu_60_allvalid-134magl.nc</span></span>
<span><span class="co">#&gt; 103: ch4_mlo_surface-insitu_1_allvalid.nc</span></span>
<span><span class="co">#&gt; 104: ch4_mnc_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 105: ch4_mnm_surface-insitu_19_representative.nc</span></span>
<span><span class="co">#&gt; 106: ch4_ndao_surface-insitu_45_allvalid-21magl.nc</span></span>
<span><span class="co">#&gt; 107: ch4_nor_surface-insitu_442_allvalid-100magl.nc</span></span>
<span><span class="co">#&gt; 108: ch4_nor_surface-insitu_442_allvalid-32magl.nc</span></span>
<span><span class="co">#&gt; 109: ch4_nor_surface-insitu_442_allvalid-58magl.nc</span></span>
<span><span class="co">#&gt; 110: ch4_notr_surface-insitu_60_allvalid-91magl.nc</span></span>
<span><span class="co">#&gt; 111: ch4_oli_surface-insitu_64_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 112: ch4_ope_surface-insitu_442_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 113: ch4_ope_surface-insitu_442_allvalid-120magl.nc</span></span>
<span><span class="co">#&gt; 114: ch4_ope_surface-insitu_442_allvalid-50magl.nc</span></span>
<span><span class="co">#&gt; 115: ch4_oxk_surface-insitu_442_allvalid-163magl.nc</span></span>
<span><span class="co">#&gt; 116: ch4_oxk_surface-insitu_442_allvalid-23magl.nc</span></span>
<span><span class="co">#&gt; 117: ch4_oxk_surface-insitu_442_allvalid-90magl.nc</span></span>
<span><span class="co">#&gt; 118: ch4_pal_surface-insitu_30_continental.nc</span></span>
<span><span class="co">#&gt; 119: ch4_pal_surface-insitu_30_marine.nc</span></span>
<span><span class="co">#&gt; 120: ch4_pal_surface-insitu_30_nonlocal.nc</span></span>
<span><span class="co">#&gt; 121: ch4_pal_surface-insitu_442_allvalid-12magl.nc</span></span>
<span><span class="co">#&gt; 122: ch4_prs_surface-insitu_442_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 123: ch4_pui_surface-insitu_442_allvalid-47magl.nc</span></span>
<span><span class="co">#&gt; 124: ch4_pui_surface-insitu_442_allvalid-84magl.nc</span></span>
<span><span class="co">#&gt; 125: ch4_puy_surface-insitu_442_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 126: ch4_rgl_surface-insitu_442_allvalid-45magl.nc</span></span>
<span><span class="co">#&gt; 127: ch4_rgl_surface-insitu_442_allvalid-90magl.nc</span></span>
<span><span class="co">#&gt; 128: ch4_ric_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 129: ch4_run_surface-insitu_442_allvalid-6magl.nc</span></span>
<span><span class="co">#&gt; 130: ch4_ryo_surface-insitu_19_representative.nc</span></span>
<span><span class="co">#&gt; 131: ch4_sac_surface-insitu_442_allvalid-100magl.nc</span></span>
<span><span class="co">#&gt; 132: ch4_sac_surface-insitu_442_allvalid-15magl.nc</span></span>
<span><span class="co">#&gt; 133: ch4_sac_surface-insitu_442_allvalid-50magl.nc</span></span>
<span><span class="co">#&gt; 134: ch4_sgp_surface-insitu_64_allvalid-60magl.nc</span></span>
<span><span class="co">#&gt; 135: ch4_sig_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 136: ch4_smr_surface-insitu_442_allvalid-125magl.nc</span></span>
<span><span class="co">#&gt; 137: ch4_smr_surface-insitu_442_allvalid-17magl.nc</span></span>
<span><span class="co">#&gt; 138: ch4_smr_surface-insitu_442_allvalid-67magl.nc</span></span>
<span><span class="co">#&gt; 139: ch4_snj_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 140: ch4_sno_surface-insitu_442_allvalid-20magl.nc</span></span>
<span><span class="co">#&gt; 141: ch4_sno_surface-insitu_442_allvalid-50magl.nc</span></span>
<span><span class="co">#&gt; 142: ch4_sno_surface-insitu_442_allvalid-85magl.nc</span></span>
<span><span class="co">#&gt; 143: ch4_ssl_surface-insitu_442_allvalid-12magl.nc</span></span>
<span><span class="co">#&gt; 144: ch4_ssl_surface-insitu_442_allvalid-35magl.nc</span></span>
<span><span class="co">#&gt; 145: ch4_ste_surface-insitu_442_allvalid-127magl.nc</span></span>
<span><span class="co">#&gt; 146: ch4_ste_surface-insitu_442_allvalid-187magl.nc</span></span>
<span><span class="co">#&gt; 147: ch4_ste_surface-insitu_442_allvalid-252magl.nc</span></span>
<span><span class="co">#&gt; 148: ch4_ste_surface-insitu_442_allvalid-32magl.nc</span></span>
<span><span class="co">#&gt; 149: ch4_ste_surface-insitu_442_allvalid-82magl.nc</span></span>
<span><span class="co">#&gt; 150: ch4_svb_surface-insitu_442_allvalid-150magl.nc</span></span>
<span><span class="co">#&gt; 151: ch4_svb_surface-insitu_442_allvalid-35magl.nc</span></span>
<span><span class="co">#&gt; 152: ch4_svb_surface-insitu_442_allvalid-85magl.nc</span></span>
<span><span class="co">#&gt; 153: ch4_syo_surface-insitu_8_representative.nc</span></span>
<span><span class="co">#&gt; 154: ch4_tao_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 155: ch4_thd_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 156: ch4_tik_surface-insitu_30_allvalid.nc</span></span>
<span><span class="co">#&gt; 157: ch4_toh_surface-insitu_442_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 158: ch4_toh_surface-insitu_442_allvalid-110magl.nc</span></span>
<span><span class="co">#&gt; 159: ch4_toh_surface-insitu_442_allvalid-147magl.nc</span></span>
<span><span class="co">#&gt; 160: ch4_toh_surface-insitu_442_allvalid-76magl.nc</span></span>
<span><span class="co">#&gt; 161: ch4_tpd_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 162: ch4_trn_surface-insitu_442_allvalid-100magl.nc</span></span>
<span><span class="co">#&gt; 163: ch4_trn_surface-insitu_442_allvalid-180magl.nc</span></span>
<span><span class="co">#&gt; 164: ch4_trn_surface-insitu_442_allvalid-50magl.nc</span></span>
<span><span class="co">#&gt; 165: ch4_trn_surface-insitu_442_allvalid-5magl.nc</span></span>
<span><span class="co">#&gt; 166: ch4_uld_surface-insitu_61_allvalid.nc</span></span>
<span><span class="co">#&gt; 167: ch4_uny_surface-insitu_112_allvalid.nc</span></span>
<span><span class="co">#&gt; 168: ch4_uto_surface-insitu_442_allvalid-57magl.nc</span></span>
<span><span class="co">#&gt; 169: ch4_wao_surface-insitu_442_allvalid-10magl.nc</span></span>
<span><span class="co">#&gt; 170: ch4_wes_surface-insitu_442_allvalid-14magl.nc</span></span>
<span><span class="co">#&gt; 171: ch4_wsa_surface-insitu_6_allvalid.nc</span></span>
<span><span class="co">#&gt; 172: ch4_yon_surface-insitu_19_representative.nc</span></span>
<span><span class="co">#&gt; 173: ch4_zep_surface-insitu_442_allvalid-15magl.nc</span></span>
<span><span class="co">#&gt; 174: ch4_zsf_surface-insitu_442_allvalid-3magl.nc</span></span></code></pre>
<p>Now we check the data</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;           year month   day  hour minute second       time start_time</span></span>
<span><span class="co">#&gt;          &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt;       1:  2014     3     6     5     30      0 1394083800 1394082000</span></span>
<span><span class="co">#&gt;       2:  2014     3     6     6     30      0 1394087400 1394085600</span></span>
<span><span class="co">#&gt;       3:  2014     3     6     7     30      0 1394091000 1394089200</span></span>
<span><span class="co">#&gt;       4:  2014     3     6     8     30      0 1394094600 1394092800</span></span>
<span><span class="co">#&gt;       5:  2014     3     6     9     30      0 1394098200 1394096400</span></span>
<span><span class="co">#&gt;      ---                                                            </span></span>
<span><span class="co">#&gt; 8281129:  2021    12    31    19     30      0 1640979000 1640977200</span></span>
<span><span class="co">#&gt; 8281130:  2021    12    31    20     30      0 1640982600 1640980800</span></span>
<span><span class="co">#&gt; 8281131:  2021    12    31    21     30      0 1640986200 1640984400</span></span>
<span><span class="co">#&gt; 8281132:  2021    12    31    22     30      0 1640989800 1640988000</span></span>
<span><span class="co">#&gt; 8281133:  2021    12    31    23     30      0 1640993400 1640991600</span></span>
<span><span class="co">#&gt;          midpoint_time             datetime time_decimal       value nvalue</span></span>
<span><span class="co">#&gt;                  &lt;int&gt;               &lt;char&gt;        &lt;num&gt;       &lt;num&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt;       1:    1394083800 2014-03-06T05:30:00Z     2014.176 1.93390e-06     53</span></span>
<span><span class="co">#&gt;       2:    1394087400 2014-03-06T06:30:00Z     2014.176 1.93930e-06     57</span></span>
<span><span class="co">#&gt;       3:    1394091000 2014-03-06T07:30:00Z     2014.176 1.95110e-06     57</span></span>
<span><span class="co">#&gt;       4:    1394094600 2014-03-06T08:30:00Z     2014.176 1.96890e-06     57</span></span>
<span><span class="co">#&gt;       5:    1394098200 2014-03-06T09:30:00Z     2014.176 1.99260e-06     57</span></span>
<span><span class="co">#&gt;      ---                                                                   </span></span>
<span><span class="co">#&gt; 8281129:    1640979000 2021-12-31T19:30:00Z     2021.999 1.93855e-06     60</span></span>
<span><span class="co">#&gt; 8281130:    1640982600 2021-12-31T20:30:00Z     2022.000 1.93909e-06     60</span></span>
<span><span class="co">#&gt; 8281131:    1640986200 2021-12-31T21:30:00Z     2022.000 1.93938e-06     60</span></span>
<span><span class="co">#&gt; 8281132:    1640989800 2021-12-31T22:30:00Z     2022.000 1.94089e-06     60</span></span>
<span><span class="co">#&gt; 8281133:    1640993400 2021-12-31T23:30:00Z     2022.000 1.94087e-06     26</span></span>
<span><span class="co">#&gt;          value_std_dev latitude longitude altitude elevation intake_height</span></span>
<span><span class="co">#&gt;                  &lt;num&gt;    &lt;num&gt;     &lt;num&gt;    &lt;num&gt;     &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:      4.20e-09  49.0114 -122.3353       93        60            33</span></span>
<span><span class="co">#&gt;       2:      8.40e-09  49.0114 -122.3353       93        60            33</span></span>
<span><span class="co">#&gt;       3:      5.70e-09  49.0114 -122.3353       93        60            33</span></span>
<span><span class="co">#&gt;       4:      2.18e-08  49.0114 -122.3353       93        60            33</span></span>
<span><span class="co">#&gt;       5:      9.40e-09  49.0114 -122.3353       93        60            33</span></span>
<span><span class="co">#&gt;      ---                                                                  </span></span>
<span><span class="co">#&gt; 8281129:      4.54e-10  47.4165   10.9796     2669      2666             3</span></span>
<span><span class="co">#&gt; 8281130:      3.38e-10  47.4165   10.9796     2669      2666             3</span></span>
<span><span class="co">#&gt; 8281131:      7.64e-10  47.4165   10.9796     2669      2666             3</span></span>
<span><span class="co">#&gt; 8281132:      4.25e-10  47.4165   10.9796     2669      2666             3</span></span>
<span><span class="co">#&gt; 8281133:      3.55e-10  47.4165   10.9796     2669      2666             3</span></span>
<span><span class="co">#&gt;          obs_flag obspack_num</span></span>
<span><span class="co">#&gt;             &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;       1:        0     2671976</span></span>
<span><span class="co">#&gt;       2:        0     2671977</span></span>
<span><span class="co">#&gt;       3:        0     2671978</span></span>
<span><span class="co">#&gt;       4:        0     2671979</span></span>
<span><span class="co">#&gt;       5:        0     2671980</span></span>
<span><span class="co">#&gt;      ---                     </span></span>
<span><span class="co">#&gt; 8281129:        0    13341897</span></span>
<span><span class="co">#&gt; 8281130:        0    13341898</span></span>
<span><span class="co">#&gt; 8281131:        0    13341899</span></span>
<span><span class="co">#&gt; 8281132:        0    13341900</span></span>
<span><span class="co">#&gt; 8281133:        0    13341901</span></span>
<span><span class="co">#&gt;                                                                                               obspack_id</span></span>
<span><span class="co">#&gt;                                                                                                   &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1:          obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abt_surface-insitu_6_allvalid~2671976</span></span>
<span><span class="co">#&gt;       2:          obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abt_surface-insitu_6_allvalid~2671977</span></span>
<span><span class="co">#&gt;       3:          obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abt_surface-insitu_6_allvalid~2671978</span></span>
<span><span class="co">#&gt;       4:          obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abt_surface-insitu_6_allvalid~2671979</span></span>
<span><span class="co">#&gt;       5:          obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abt_surface-insitu_6_allvalid~2671980</span></span>
<span><span class="co">#&gt;      ---                                                                                                </span></span>
<span><span class="co">#&gt; 8281129: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zsf_surface-insitu_442_allvalid-3magl~13341897</span></span>
<span><span class="co">#&gt; 8281130: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zsf_surface-insitu_442_allvalid-3magl~13341898</span></span>
<span><span class="co">#&gt; 8281131: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zsf_surface-insitu_442_allvalid-3magl~13341899</span></span>
<span><span class="co">#&gt; 8281132: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zsf_surface-insitu_442_allvalid-3magl~13341900</span></span>
<span><span class="co">#&gt; 8281133: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zsf_surface-insitu_442_allvalid-3magl~13341901</span></span>
<span><span class="co">#&gt;          unique_sample_location_num year_st month_st day_st hour_st minute_st</span></span>
<span><span class="co">#&gt;                               &lt;int&gt;   &lt;int&gt;    &lt;int&gt;  &lt;int&gt;   &lt;int&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt;       1:                   32763088    2014        3      5      21         8</span></span>
<span><span class="co">#&gt;       2:                   32763089    2014        3      5      22         8</span></span>
<span><span class="co">#&gt;       3:                   32763090    2014        3      5      23         8</span></span>
<span><span class="co">#&gt;       4:                   32763091    2014        3      6       0         8</span></span>
<span><span class="co">#&gt;       5:                   32763092    2014        3      6       1         8</span></span>
<span><span class="co">#&gt;      ---                                                                     </span></span>
<span><span class="co">#&gt; 8281129:                   49987485    2021       12     31      20        11</span></span>
<span><span class="co">#&gt; 8281130:                   49987486    2021       12     31      21        11</span></span>
<span><span class="co">#&gt; 8281131:                   49987487    2021       12     31      22        11</span></span>
<span><span class="co">#&gt; 8281132:                   49987488    2021       12     31      23        11</span></span>
<span><span class="co">#&gt; 8281133:                   49987489    2022        1      1       0        11</span></span>
<span><span class="co">#&gt;          second_st          scale site_elevation_unit dataset_project</span></span>
<span><span class="co">#&gt;              &lt;int&gt;         &lt;char&gt;              &lt;char&gt;          &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1:        58 WMO CH4 X2004A                masl  surface-insitu</span></span>
<span><span class="co">#&gt;       2:        58 WMO CH4 X2004A                masl  surface-insitu</span></span>
<span><span class="co">#&gt;       3:        58 WMO CH4 X2004A                masl  surface-insitu</span></span>
<span><span class="co">#&gt;       4:        58 WMO CH4 X2004A                masl  surface-insitu</span></span>
<span><span class="co">#&gt;       5:        58 WMO CH4 X2004A                masl  surface-insitu</span></span>
<span><span class="co">#&gt;      ---                                                             </span></span>
<span><span class="co">#&gt; 8281129:         1  WMO CH4 X2019                masl  surface-insitu</span></span>
<span><span class="co">#&gt; 8281130:         1  WMO CH4 X2019                masl  surface-insitu</span></span>
<span><span class="co">#&gt; 8281131:         1  WMO CH4 X2019                masl  surface-insitu</span></span>
<span><span class="co">#&gt; 8281132:         1  WMO CH4 X2019                masl  surface-insitu</span></span>
<span><span class="co">#&gt; 8281133:         1  WMO CH4 X2019                masl  surface-insitu</span></span>
<span><span class="co">#&gt;          dataset_selection_tag                    site_name site_elevation</span></span>
<span><span class="co">#&gt;                         &lt;char&gt;                       &lt;char&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:              allvalid Abbotsford, British Columbia             60</span></span>
<span><span class="co">#&gt;       2:              allvalid Abbotsford, British Columbia             60</span></span>
<span><span class="co">#&gt;       3:              allvalid Abbotsford, British Columbia             60</span></span>
<span><span class="co">#&gt;       4:              allvalid Abbotsford, British Columbia             60</span></span>
<span><span class="co">#&gt;       5:              allvalid Abbotsford, British Columbia             60</span></span>
<span><span class="co">#&gt;      ---                                                                  </span></span>
<span><span class="co">#&gt; 8281129:        allvalid-3magl Zugspitze / Schneefernerhaus           2666</span></span>
<span><span class="co">#&gt; 8281130:        allvalid-3magl Zugspitze / Schneefernerhaus           2666</span></span>
<span><span class="co">#&gt; 8281131:        allvalid-3magl Zugspitze / Schneefernerhaus           2666</span></span>
<span><span class="co">#&gt; 8281132:        allvalid-3magl Zugspitze / Schneefernerhaus           2666</span></span>
<span><span class="co">#&gt; 8281133:        allvalid-3magl Zugspitze / Schneefernerhaus           2666</span></span>
<span><span class="co">#&gt;          site_latitude site_longitude site_country site_code site_utc2lst</span></span>
<span><span class="co">#&gt;                  &lt;num&gt;          &lt;num&gt;       &lt;char&gt;    &lt;char&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:       49.0114      -122.3353       Canada       ABT           -8</span></span>
<span><span class="co">#&gt;       2:       49.0114      -122.3353       Canada       ABT           -8</span></span>
<span><span class="co">#&gt;       3:       49.0114      -122.3353       Canada       ABT           -8</span></span>
<span><span class="co">#&gt;       4:       49.0114      -122.3353       Canada       ABT           -8</span></span>
<span><span class="co">#&gt;       5:       49.0114      -122.3353       Canada       ABT           -8</span></span>
<span><span class="co">#&gt;      ---                                                                 </span></span>
<span><span class="co">#&gt; 8281129:       47.4165        10.9796      Germany       ZSF            0</span></span>
<span><span class="co">#&gt; 8281130:       47.4165        10.9796      Germany       ZSF            0</span></span>
<span><span class="co">#&gt; 8281131:       47.4165        10.9796      Germany       ZSF            0</span></span>
<span><span class="co">#&gt; 8281132:       47.4165        10.9796      Germany       ZSF            0</span></span>
<span><span class="co">#&gt; 8281133:       47.4165        10.9796      Germany       ZSF            0</span></span>
<span><span class="co">#&gt;          lab_1_abbr dataset_calibration_scale altitude_final type_altitude</span></span>
<span><span class="co">#&gt;              &lt;char&gt;                    &lt;char&gt;          &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:       ECCC            WMO CH4 X2004A             33            NA</span></span>
<span><span class="co">#&gt;       2:       ECCC            WMO CH4 X2004A             33            NA</span></span>
<span><span class="co">#&gt;       3:       ECCC            WMO CH4 X2004A             33            NA</span></span>
<span><span class="co">#&gt;       4:       ECCC            WMO CH4 X2004A             33            NA</span></span>
<span><span class="co">#&gt;       5:       ECCC            WMO CH4 X2004A             33            NA</span></span>
<span><span class="co">#&gt;      ---                                                                  </span></span>
<span><span class="co">#&gt; 8281129:   ICOS-ATC             WMO CH4 X2019              3             0</span></span>
<span><span class="co">#&gt; 8281130:   ICOS-ATC             WMO CH4 X2019              3             0</span></span>
<span><span class="co">#&gt; 8281131:   ICOS-ATC             WMO CH4 X2019              3             0</span></span>
<span><span class="co">#&gt; 8281132:   ICOS-ATC             WMO CH4 X2019              3             0</span></span>
<span><span class="co">#&gt; 8281133:   ICOS-ATC             WMO CH4 X2019              3             0</span></span>
<span><span class="co">#&gt;          dataset_intake_ht_unit instrument method pressure qcflag temperature</span></span>
<span><span class="co">#&gt;                          &lt;char&gt;     &lt;char&gt; &lt;char&gt;    &lt;num&gt; &lt;char&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:                   &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;       NA   &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;       2:                   &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;       NA   &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;       3:                   &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;       NA   &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;       4:                   &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;       NA   &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;       5:                   &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;       NA   &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;      ---                                                                     </span></span>
<span><span class="co">#&gt; 8281129:                   magl        880   &lt;NA&gt;       NA      O          NA</span></span>
<span><span class="co">#&gt; 8281130:                   magl        880   &lt;NA&gt;       NA      O          NA</span></span>
<span><span class="co">#&gt; 8281131:                   magl        880   &lt;NA&gt;       NA      O          NA</span></span>
<span><span class="co">#&gt; 8281132:                   magl        880   &lt;NA&gt;       NA      O          NA</span></span>
<span><span class="co">#&gt; 8281133:                   magl        880   &lt;NA&gt;       NA      O          NA</span></span>
<span><span class="co">#&gt;          time_interval     u     v value_unc</span></span>
<span><span class="co">#&gt;                  &lt;int&gt; &lt;num&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:            NA    NA    NA        NA</span></span>
<span><span class="co">#&gt;       2:            NA    NA    NA        NA</span></span>
<span><span class="co">#&gt;       3:            NA    NA    NA        NA</span></span>
<span><span class="co">#&gt;       4:            NA    NA    NA        NA</span></span>
<span><span class="co">#&gt;       5:            NA    NA    NA        NA</span></span>
<span><span class="co">#&gt;      ---                                    </span></span>
<span><span class="co">#&gt; 8281129:            NA    NA    NA        NA</span></span>
<span><span class="co">#&gt; 8281130:            NA    NA    NA        NA</span></span>
<span><span class="co">#&gt; 8281131:            NA    NA    NA        NA</span></span>
<span><span class="co">#&gt; 8281132:            NA    NA    NA        NA</span></span>
<span><span class="co">#&gt; 8281133:            NA    NA    NA        NA</span></span></code></pre>
<p>Now we can process the data. We first filter for observations within
our spatial domain:</p>
<div class="section level2">
<h2 id="checks-and-definitions">Checks and definitions<a class="anchor" aria-label="anchor" href="#checks-and-definitions"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">north</span> <span class="op">&lt;-</span> <span class="fl">80</span></span>
<span><span class="va">south</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">west</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">170</span></span>
<span><span class="va">east</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">50</span></span>
<span><span class="va">max_altitude</span> <span class="op">&lt;-</span> <span class="fl">8000</span></span>
<span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="fl">2020</span></span>
<span><span class="va">evening</span> <span class="op">&lt;-</span> <span class="fl">14</span></span></code></pre></div>
<p>We check altitude, intake_height, altitude_final and elevation.
altitude_final is a column from intake_height, added to match column
from obs_read text files.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"altitude"</span>, <span class="st">"altitude_final"</span>, <span class="st">"intake_height"</span>, <span class="st">"elevation"</span>,</span>
<span>       <span class="st">"dataset_selection_tag"</span>,</span>
<span>              <span class="st">"site_name"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;          altitude altitude_final intake_height elevation dataset_selection_tag</span></span>
<span><span class="co">#&gt;             &lt;num&gt;          &lt;num&gt;         &lt;num&gt;     &lt;num&gt;                &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1:       93             33            33        60              allvalid</span></span>
<span><span class="co">#&gt;       2:       93             33            33        60              allvalid</span></span>
<span><span class="co">#&gt;       3:       93             33            33        60              allvalid</span></span>
<span><span class="co">#&gt;       4:       93             33            33        60              allvalid</span></span>
<span><span class="co">#&gt;       5:       93             33            33        60              allvalid</span></span>
<span><span class="co">#&gt;      ---                                                                      </span></span>
<span><span class="co">#&gt; 8281129:     2669              3             3      2666        allvalid-3magl</span></span>
<span><span class="co">#&gt; 8281130:     2669              3             3      2666        allvalid-3magl</span></span>
<span><span class="co">#&gt; 8281131:     2669              3             3      2666        allvalid-3magl</span></span>
<span><span class="co">#&gt; 8281132:     2669              3             3      2666        allvalid-3magl</span></span>
<span><span class="co">#&gt; 8281133:     2669              3             3      2666        allvalid-3magl</span></span>
<span><span class="co">#&gt;                             site_name</span></span>
<span><span class="co">#&gt;                                &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1: Abbotsford, British Columbia</span></span>
<span><span class="co">#&gt;       2: Abbotsford, British Columbia</span></span>
<span><span class="co">#&gt;       3: Abbotsford, British Columbia</span></span>
<span><span class="co">#&gt;       4: Abbotsford, British Columbia</span></span>
<span><span class="co">#&gt;       5: Abbotsford, British Columbia</span></span>
<span><span class="co">#&gt;      ---                             </span></span>
<span><span class="co">#&gt; 8281129: Zugspitze / Schneefernerhaus</span></span>
<span><span class="co">#&gt; 8281130: Zugspitze / Schneefernerhaus</span></span>
<span><span class="co">#&gt; 8281131: Zugspitze / Schneefernerhaus</span></span>
<span><span class="co">#&gt; 8281132: Zugspitze / Schneefernerhaus</span></span>
<span><span class="co">#&gt; 8281133: Zugspitze / Schneefernerhaus</span></span></code></pre>
<p>The temporal range of data is</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 1983 2021</span></span></code></pre>
<p>We also check for dimensions of data</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 8281133      54</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="filters">Filters<a class="anchor" aria-label="anchor" href="#filters"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="va">yy</span><span class="op">]</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">altitude_final</span> <span class="op">&lt;</span> <span class="va">max_altitude</span> <span class="op">&amp;</span></span>
<span>           <span class="va">latitude</span> <span class="op">&lt;</span> <span class="va">north</span> <span class="op">&amp;</span></span>
<span>           <span class="va">latitude</span> <span class="op">&gt;</span> <span class="va">south</span> <span class="op">&amp;</span></span>
<span>           <span class="va">longitude</span> <span class="op">&lt;</span> <span class="va">east</span> <span class="op">&amp;</span></span>
<span>           <span class="va">longitude</span> <span class="op">&gt;</span> <span class="va">west</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 274587     54</span></span></code></pre>
<p>Towers can have observations at different heights. Here we need to
select one site with the observations registered at the highest height.
The column with the height is named <code>altitude_final</code> and the
max altitude was named <code>max_altitude</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfa</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">altitude_final</span><span class="op">)</span>,</span>
<span>          by <span class="op">=</span> <span class="va">site_code</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dfa</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"max_altitude"</span></span>
<span><span class="va">dfa</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     site_code max_altitude</span></span>
<span><span class="co">#&gt;        &lt;char&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:       ABT        33.00</span></span>
<span><span class="co">#&gt;  2:       BCK        60.00</span></span>
<span><span class="co">#&gt;  3:       BRA        35.00</span></span>
<span><span class="co">#&gt;  4:       BRW        16.46</span></span>
<span><span class="co">#&gt;  5:      CARL         9.00</span></span>
<span><span class="co">#&gt;  6:       CBY        12.00</span></span>
<span><span class="co">#&gt;  7:       CHL        60.00</span></span>
<span><span class="co">#&gt;  8:       CPS        40.00</span></span>
<span><span class="co">#&gt;  9:       EGB        25.00</span></span>
<span><span class="co">#&gt; 10:       ESP        40.00</span></span>
<span><span class="co">#&gt; 11:       EST        50.00</span></span>
<span><span class="co">#&gt; 12:       ETL       105.00</span></span>
<span><span class="co">#&gt; 13:       FNE        15.00</span></span>
<span><span class="co">#&gt; 14:      FORT       128.00</span></span>
<span><span class="co">#&gt; 15:       FSD        40.00</span></span>
<span><span class="co">#&gt; 16:     GHG06       100.00</span></span>
<span><span class="co">#&gt; 17:     GHG09       100.00</span></span>
<span><span class="co">#&gt; 18:       HNP        10.00</span></span>
<span><span class="co">#&gt; 19:      HOBB        91.00</span></span>
<span><span class="co">#&gt; 20:       INU        10.00</span></span>
<span><span class="co">#&gt; 21:     INX01       121.00</span></span>
<span><span class="co">#&gt; 22:     INX02       136.00</span></span>
<span><span class="co">#&gt; 23:     INX07        58.00</span></span>
<span><span class="co">#&gt; 24:     INX08        41.00</span></span>
<span><span class="co">#&gt; 25:     INX09       130.00</span></span>
<span><span class="co">#&gt; 26:     INX10        40.00</span></span>
<span><span class="co">#&gt; 27:     INX13        87.00</span></span>
<span><span class="co">#&gt; 28:     INX14        76.00</span></span>
<span><span class="co">#&gt; 29:       LLB        50.00</span></span>
<span><span class="co">#&gt; 30:      MALJ       134.00</span></span>
<span><span class="co">#&gt; 31:       MLO        40.00</span></span>
<span><span class="co">#&gt; 32:       OLI         0.00</span></span>
<span><span class="co">#&gt; 33:       SGP         4.00</span></span>
<span><span class="co">#&gt; 34:       THD        90.00</span></span>
<span><span class="co">#&gt; 35:       TPD        35.00</span></span>
<span><span class="co">#&gt; 36:       WSA         3.00</span></span>
<span><span class="co">#&gt;     site_code max_altitude</span></span></code></pre>
<div class="section level3">
<h3 id="key-time">Key Time<a class="anchor" aria-label="anchor" href="#key-time"></a>
</h3>
<p>Here we need to start time columns. The function
<code>obs_addtime</code> adds time columns <code>timeUTC</code>,
<code>timeUTC_start</code> which shows the start time of each
observation and <code>timeUTC_end</code> which shows the end time for
each observation.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_addtime.html">obs_addtime</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Adding timeUTC</span></span>
<span><span class="co">#&gt; Adding timeUTC_start</span></span>
<span><span class="co">#&gt; Adding timeUTC_end</span></span>
<span><span class="co">#&gt; Found time_interval</span></span></code></pre>
<p>Then we need a <em>key_time</em> to aggregate data. This can be done
using UTC, solar, or local time. The normal approach is using afternoon
solar or local time.</p>
<div class="section level4">
<h4 id="hierarchy-of-solar-or-local-time">Hierarchy of solar or local time<a class="anchor" aria-label="anchor" href="#hierarchy-of-solar-or-local-time"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Solar time</li>
<li>Local time with columns <code>site_utc2lst</code>
</li>
<li>Local time longitude</li>
</ol>
<blockquote>
<p>solar time (default)</p>
</blockquote>
<p>Here we select the hours of interest and then aggregate data by year,
month and day of solar time. In this way, we will have one information
per day. however this approach is not appropriate for aircraft which are
aggregated every 10 or 20 seconds. Hence we need to aggregate data by
one time column. Also, this helps to generate the receptor info files
including hour, minute and second. Hence, <em>we need to add solar or
local time column</em>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span><span class="op">$</span><span class="va">solar_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_addstime.html">obs_addstime</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>local time with column <code>site_utc2lst</code></p>
</blockquote>
<p>Then we need to identify the local time with the function
<code>add_ltime</code>. This is important because to identifying
observations in the evening in local time. <code>add_ltime</code> uses
two methods, first identify the time difference with utc by identifying
the metadata column â€œsite_utc2lstâ€. If solar time is not available #now
we need to cut solar time for the frequency needed. As we will work
with</p>
<blockquote>
<p>local time longitude</p>
</blockquote>
<p>If this information is not available, with the aircrafts for
instance, the local time is calculated with an approximation based on
longitude:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>t</mi><mo>=</mo><mi>U</mi><mi>T</mi><mi>C</mi><mo>+</mo><mi>l</mi><mi>o</mi><mi>n</mi><mi>g</mi><mi>i</mi><mi>t</mi><mi>u</mi><mi>d</mi><mi>e</mi><mi>/</mi><mn>15</mn><mo>*</mo><mn>60</mn><mo>*</mo><mn>60</mn></mrow><annotation encoding="application/x-tex">
lt = UTC + longitude/15 * 60 * 60
</annotation></semantics></math> Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">lt</annotation></semantics></math>
is the local time,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mi>T</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">UTC</annotation></semantics></math>
the time,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>n</mi><mi>g</mi><mi>i</mi><mi>t</mi><mi>u</mi><mi>d</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">longitude</annotation></semantics></math>
the coordinate. Then, the time is cut every two hours. Now, we identify
the local time to select evening hours.</p>
</div>
<div class="section level4">
<h4 id="cut-time">Cut time<a class="anchor" aria-label="anchor" href="#cut-time"></a>
</h4>
<p>Now we have they key column time, we can cut it accordingly.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span><span class="op">$</span><span class="va">solar_time_cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df2</span><span class="op">$</span><span class="va">solar_time</span>,</span>
<span>                          breaks <span class="op">=</span> <span class="st">"1 hour"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>How we can check the solar time and the cut solar time. Please note
that solar_time_cut, the column that it will be used to aggregate
data</p>
<p>How we filter for the required solar time, in this case 14.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="va">df2</span><span class="op">[</span><span class="va">hour_st</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">evening</span><span class="op">]</span></span>
<span><span class="va">df3</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solar_time"</span>, <span class="st">"solar_time_cut"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                 solar_time      solar_time_cut</span></span>
<span><span class="co">#&gt;                     &lt;POSc&gt;              &lt;char&gt;</span></span>
<span><span class="co">#&gt;     1: 2020-01-01 14:17:19 2020-01-01 14:00:00</span></span>
<span><span class="co">#&gt;     2: 2020-01-02 14:16:52 2020-01-02 14:00:00</span></span>
<span><span class="co">#&gt;     3: 2020-01-03 14:16:26 2020-01-03 14:00:00</span></span>
<span><span class="co">#&gt;     4: 2020-01-04 14:16:00 2020-01-04 14:00:00</span></span>
<span><span class="co">#&gt;     5: 2020-01-05 14:15:34 2020-01-05 14:00:00</span></span>
<span><span class="co">#&gt;    ---                                        </span></span>
<span><span class="co">#&gt; 11473: 2020-03-15 14:20:51 2020-03-15 14:00:00</span></span>
<span><span class="co">#&gt; 11474: 2020-03-16 14:21:08 2020-03-16 14:00:00</span></span>
<span><span class="co">#&gt; 11475: 2020-03-17 14:21:26 2020-03-17 14:00:00</span></span>
<span><span class="co">#&gt; 11476: 2020-03-18 14:21:44 2020-03-18 14:00:00</span></span>
<span><span class="co">#&gt; 11477: 2020-03-19 14:22:02 2020-03-19 14:00:00</span></span></code></pre>
<p>At this point we can calculate the averages of several columns by the
cut time. The function <code>obs_agg</code> does this aggregation as
shown in the following lines of code. The argument <code>gby</code>
establish the function used to aggregate <code>cols</code>. I need to
aggregate the data by date (year, month, date), because it is already
filtered by the hours of interest. Then, I would have 1 observation per
day.</p>
<p>As standard, let us define <code>key_time</code> as
<code>solar_time</code>. The <code>obs_agg</code> function will
aggregate the desired data by that column.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df3</span><span class="op">$</span><span class="va">key_time</span> <span class="op">&lt;-</span> <span class="va">df3</span><span class="op">$</span><span class="va">solar_time_cut</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_agg.html">obs_agg</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="va">df3</span>,</span>
<span>               cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>,</span>
<span>                        <span class="st">"latitude"</span>,</span>
<span>                        <span class="st">"longitude"</span>,</span>
<span>                        <span class="st">"site_utc2lst"</span><span class="op">)</span>,</span>
<span>               verbose <span class="op">=</span> <span class="cn">T</span>,</span>
<span>               byalt <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Selecting by alt</span></span>
<span><span class="co">#&gt; Adding time</span></span></code></pre>
<p>Here we add the column <code>max_altitude</code> to identify the max
altitude by site.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df4</span><span class="op">[</span>,</span>
<span>    <span class="va">max_altitude</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">altitude_final</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="va">site_code</span><span class="op">]</span></span>
<span><span class="va">df4</span><span class="op">[</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site_code"</span>,</span>
<span>      <span class="st">"altitude_final"</span>,</span>
<span>      <span class="st">"max_altitude"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     site_code altitude_final max_altitude</span></span>
<span><span class="co">#&gt;        &lt;char&gt;          &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:       ABT          33.00        33.00</span></span>
<span><span class="co">#&gt;  2:       BCK          60.00        60.00</span></span>
<span><span class="co">#&gt;  3:       BRA          35.00        35.00</span></span>
<span><span class="co">#&gt;  4:       BRW          16.46        16.46</span></span>
<span><span class="co">#&gt;  5:      CARL           9.00         9.00</span></span>
<span><span class="co">#&gt;  6:       CBY          12.00        12.00</span></span>
<span><span class="co">#&gt;  7:       CHL          60.00        60.00</span></span>
<span><span class="co">#&gt;  8:       CPS          40.00        40.00</span></span>
<span><span class="co">#&gt;  9:       EGB          25.00        25.00</span></span>
<span><span class="co">#&gt; 10:       ESP          40.00        40.00</span></span>
<span><span class="co">#&gt; 11:       EST          50.00        50.00</span></span>
<span><span class="co">#&gt; 12:       ETL         105.00       105.00</span></span>
<span><span class="co">#&gt; 13:       FNE          15.00        15.00</span></span>
<span><span class="co">#&gt; 14:      FORT         128.00       128.00</span></span>
<span><span class="co">#&gt; 15:       FSD          40.00        40.00</span></span>
<span><span class="co">#&gt; 16:     GHG06         100.00       100.00</span></span>
<span><span class="co">#&gt; 17:     GHG06          50.00       100.00</span></span>
<span><span class="co">#&gt; 18:     GHG09         100.00       100.00</span></span>
<span><span class="co">#&gt; 19:     GHG09          50.00       100.00</span></span>
<span><span class="co">#&gt; 20:       HNP          10.00        10.00</span></span>
<span><span class="co">#&gt; 21:      HOBB          91.00        91.00</span></span>
<span><span class="co">#&gt; 22:       INU          10.00        10.00</span></span>
<span><span class="co">#&gt; 23:     INX01          10.00       121.00</span></span>
<span><span class="co">#&gt; 24:     INX01         121.00       121.00</span></span>
<span><span class="co">#&gt; 25:     INX01          40.00       121.00</span></span>
<span><span class="co">#&gt; 26:     INX02         136.00       136.00</span></span>
<span><span class="co">#&gt; 27:     INX07          21.00        58.00</span></span>
<span><span class="co">#&gt; 28:     INX07          58.00        58.00</span></span>
<span><span class="co">#&gt; 29:     INX08          41.00        41.00</span></span>
<span><span class="co">#&gt; 30:     INX09         130.00       130.00</span></span>
<span><span class="co">#&gt; 31:     INX10          40.00        40.00</span></span>
<span><span class="co">#&gt; 32:     INX13          87.00        87.00</span></span>
<span><span class="co">#&gt; 33:     INX14          76.00        76.00</span></span>
<span><span class="co">#&gt; 34:       LLB          50.00        50.00</span></span>
<span><span class="co">#&gt; 35:      MALJ         134.00       134.00</span></span>
<span><span class="co">#&gt; 36:       MLO          40.00        40.00</span></span>
<span><span class="co">#&gt; 37:       OLI           0.00         0.00</span></span>
<span><span class="co">#&gt; 38:       SGP           4.00         4.00</span></span>
<span><span class="co">#&gt; 39:       THD          90.00        90.00</span></span>
<span><span class="co">#&gt; 40:       TPD          35.00        35.00</span></span>
<span><span class="co">#&gt; 41:       WSA           3.00         3.00</span></span>
<span><span class="co">#&gt;     site_code altitude_final max_altitude</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="master">Master<a class="anchor" aria-label="anchor" href="#master"></a>
</h2>
<p>Before generating the receptors list, we have the database with all
the required information</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master</span> <span class="op">&lt;-</span> <span class="va">df4</span></span></code></pre></div>
<p>We may replace missing values with a nine nines. Here is
commented</p>
<p>#master[is.na(master)] &lt;- 999999999</p>
<p>We transform the time variables to character and round coordinates
with 4 digits</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master</span><span class="op">$</span><span class="va">timeUTC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">timeUTC</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">local_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">local_time</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">latitude</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">longitude</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="save-master">Save master<a class="anchor" aria-label="anchor" href="#save-master"></a>
</h2>
<p>Finally we save the master file</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="txt">txt<a class="anchor" aria-label="anchor" href="#txt"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".txt\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">master</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".txt"</span><span class="op">)</span>,</span>
<span>       sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\Rtmp4k67qL\file531463a43a74_surface-insitu.txt</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="csv">csv<a class="anchor" aria-label="anchor" href="#csv"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csv\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">master</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csv"</span><span class="op">)</span>,</span>
<span>       sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\Rtmp4k67qL\file531463a43a74_surface-insitu.csv</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="csvy">csvy<a class="anchor" aria-label="anchor" href="#csvy"></a>
</h3>
<p>CSVY are csv files with a YAML header to include metadata in
tabulated text files</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAdding notes in csvy:\n"</span><span class="op">)</span></span>
<span><span class="va">notes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sector: "</span>, <span class="va">datasetid</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"timespan: "</span>, <span class="va">yy</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"spatial_limits: north = "</span>, <span class="va">north</span>, <span class="st">", south = "</span>, <span class="va">south</span>, <span class="st">", east = "</span>, <span class="va">east</span>, <span class="st">", west = "</span>, <span class="va">west</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"altitude: &lt; "</span>, <span class="va">max_altitude</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"hours: "</span>, <span class="va">evening</span><span class="op">)</span>,</span>
<span>           <span class="st">"local_time: used solar_time"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">notes</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/obs_write_csvy.html">obs_write_csvy</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="va">master</span>,</span>
<span>               notes <span class="op">=</span> <span class="va">notes</span>,</span>
<span>               out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Adding notes in csvy:</span></span>
<span><span class="co">#&gt; sector: surface-insitu</span></span>
<span><span class="co">#&gt; timespan: 2020</span></span>
<span><span class="co">#&gt; spatial_limits: north = 80, south = 10, east = -50, west = -170</span></span>
<span><span class="co">#&gt; data: Data averaged every 20 seconds</span></span>
<span><span class="co">#&gt; altitude: &lt; 8000</span></span>
<span><span class="co">#&gt; hours: 14</span></span>
<span><span class="co">#&gt; local_time: used solar_time</span></span>
<span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\Rtmp4k67qL\file531463a43a74_surface-insitu.csvy</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/obs_read_csvy.html">obs_read_csvy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "---"                                                                 </span></span>
<span><span class="co">#&gt;  [2] "name: Metadata "                                                     </span></span>
<span><span class="co">#&gt;  [3] "sector: surface-insitu"                                              </span></span>
<span><span class="co">#&gt;  [4] "timespan: 2020"                                                      </span></span>
<span><span class="co">#&gt;  [5] "spatial_limits: north = 80, south = 10, east = -50, west = -170"     </span></span>
<span><span class="co">#&gt;  [6] "data: Data averaged every 20 seconds"                                </span></span>
<span><span class="co">#&gt;  [7] "altitude: &lt; 8000"                                                    </span></span>
<span><span class="co">#&gt;  [8] "hours: 14"                                                           </span></span>
<span><span class="co">#&gt;  [9] "local_time: used solar_time"                                         </span></span>
<span><span class="co">#&gt; [10] "structure: "                                                         </span></span>
<span><span class="co">#&gt; [11] "Classes 'data.table' and 'data.frame':\t11378 obs. of  20 variables:"</span></span>
<span><span class="co">#&gt; [12] " $ timeUTC                  : chr  \"2020-01-01 14:00:00\" \".."     </span></span>
<span><span class="co">#&gt; [13] " $ site_code                : chr  \"ABT\" \"ABT\" ..."              </span></span>
<span><span class="co">#&gt; [14] " $ altitude_final           : num  33 33 33 33 33 ..."               </span></span>
<span><span class="co">#&gt; [15] " $ type_altitude            : num  NA NA NA NA NA ..."               </span></span>
<span><span class="co">#&gt; [16] " $ lab_1_abbr               : chr  \"ECCC\" \"ECCC\" ..."            </span></span>
<span><span class="co">#&gt; [17] " $ dataset_calibration_scale: chr  \"WMO CH4 X2004A\" \"WMO \".."    </span></span>
<span><span class="co">#&gt; [18] " $ value                    : num  1.96e-06 1.99e-06 ..."            </span></span>
<span><span class="co">#&gt; [19] " $ latitude                 : num  49 49 ..."                        </span></span>
<span><span class="co">#&gt; [20] " $ longitude                : num  -122 -122 ..."                    </span></span>
<span><span class="co">#&gt; [21] " $ site_utc2lst             : num  -8 -8 -8 -8 -8 ..."               </span></span>
<span><span class="co">#&gt; [22] " $ year                     : int  2020 2020 2020 2020 202.."        </span></span>
<span><span class="co">#&gt; [23] " $ month                    : int  1 1 1 1 1 ..."                    </span></span>
<span><span class="co">#&gt; [24] " $ day                      : chr  \"01\" \"02\" ..."                </span></span>
<span><span class="co">#&gt; [25] " $ hour                     : int  14 14 14 14 14 ..."               </span></span>
<span><span class="co">#&gt; [26] " $ minute                   : int  0 0 0 0 0 ..."                    </span></span>
<span><span class="co">#&gt; [27] " $ second                   : int  0 0 0 0 0 ..."                    </span></span>
<span><span class="co">#&gt; [28] " $ time                     : num  1.58e+09 1.58e+09 ..."            </span></span>
<span><span class="co">#&gt; [29] " $ time_decimal             : num  2020 2020 ..."                    </span></span>
<span><span class="co">#&gt; [30] " $ max_altitude             : num  33 33 33 33 33 ..."               </span></span>
<span><span class="co">#&gt; [31] " $ local_time               : chr  NA NA ..."                        </span></span>
<span><span class="co">#&gt; [32] " - attr(*, \".internal.selfref\")=&lt;externalptr&gt; "                    </span></span>
<span><span class="co">#&gt; [33] "NULL"                                                                </span></span>
<span><span class="co">#&gt; [34] "---"</span></span>
<span><span class="co">#&gt;                    timeUTC site_code altitude_final type_altitude lab_1_abbr</span></span>
<span><span class="co">#&gt;                     &lt;POSc&gt;    &lt;char&gt;          &lt;num&gt;         &lt;int&gt;     &lt;char&gt;</span></span>
<span><span class="co">#&gt;     1: 2020-01-01 14:00:00       ABT             33            NA       ECCC</span></span>
<span><span class="co">#&gt;     2: 2020-01-02 14:00:00       ABT             33            NA       ECCC</span></span>
<span><span class="co">#&gt;     3: 2020-01-03 14:00:00       ABT             33            NA       ECCC</span></span>
<span><span class="co">#&gt;     4: 2020-01-04 14:00:00       ABT             33            NA       ECCC</span></span>
<span><span class="co">#&gt;     5: 2020-01-05 14:00:00       ABT             33            NA       ECCC</span></span>
<span><span class="co">#&gt;    ---                                                                      </span></span>
<span><span class="co">#&gt; 11374: 2020-03-15 14:00:00       WSA              3            NA       ECCC</span></span>
<span><span class="co">#&gt; 11375: 2020-03-16 14:00:00       WSA              3            NA       ECCC</span></span>
<span><span class="co">#&gt; 11376: 2020-03-17 14:00:00       WSA              3            NA       ECCC</span></span>
<span><span class="co">#&gt; 11377: 2020-03-18 14:00:00       WSA              3            NA       ECCC</span></span>
<span><span class="co">#&gt; 11378: 2020-03-19 14:00:00       WSA              3            NA       ECCC</span></span>
<span><span class="co">#&gt;        dataset_calibration_scale      value latitude longitude site_utc2lst</span></span>
<span><span class="co">#&gt;                           &lt;char&gt;      &lt;num&gt;    &lt;num&gt;     &lt;num&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt;     1:            WMO CH4 X2004A 1.9555e-06  49.0114 -122.3353           -8</span></span>
<span><span class="co">#&gt;     2:            WMO CH4 X2004A 1.9929e-06  49.0114 -122.3353           -8</span></span>
<span><span class="co">#&gt;     3:            WMO CH4 X2004A 1.9471e-06  49.0114 -122.3353           -8</span></span>
<span><span class="co">#&gt;     4:            WMO CH4 X2004A 1.9763e-06  49.0114 -122.3353           -8</span></span>
<span><span class="co">#&gt;     5:            WMO CH4 X2004A 1.9656e-06  49.0114 -122.3353           -8</span></span>
<span><span class="co">#&gt;    ---                                                                     </span></span>
<span><span class="co">#&gt; 11374:            WMO CH4 X2004A 1.9610e-06  43.9322  -60.0093           -4</span></span>
<span><span class="co">#&gt; 11375:            WMO CH4 X2004A 1.9614e-06  43.9322  -60.0093           -4</span></span>
<span><span class="co">#&gt; 11376:            WMO CH4 X2004A 1.9560e-06  43.9322  -60.0093           -4</span></span>
<span><span class="co">#&gt; 11377:            WMO CH4 X2004A 1.9663e-06  43.9322  -60.0093           -4</span></span>
<span><span class="co">#&gt; 11378:            WMO CH4 X2004A 1.9711e-06  43.9322  -60.0093           -4</span></span>
<span><span class="co">#&gt;         year month   day  hour minute second       time time_decimal</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;int&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;     1:  2020     1     1    14      0      0 1577887200     2020.002</span></span>
<span><span class="co">#&gt;     2:  2020     1     2    14      0      0 1577973600     2020.004</span></span>
<span><span class="co">#&gt;     3:  2020     1     3    14      0      0 1578060000     2020.007</span></span>
<span><span class="co">#&gt;     4:  2020     1     4    14      0      0 1578146400     2020.010</span></span>
<span><span class="co">#&gt;     5:  2020     1     5    14      0      0 1578232800     2020.013</span></span>
<span><span class="co">#&gt;    ---                                                              </span></span>
<span><span class="co">#&gt; 11374:  2020     3    15    14      0      0 1584280800     2020.204</span></span>
<span><span class="co">#&gt; 11375:  2020     3    16    14      0      0 1584367200     2020.207</span></span>
<span><span class="co">#&gt; 11376:  2020     3    17    14      0      0 1584453600     2020.209</span></span>
<span><span class="co">#&gt; 11377:  2020     3    18    14      0      0 1584540000     2020.212</span></span>
<span><span class="co">#&gt; 11378:  2020     3    19    14      0      0 1584626400     2020.215</span></span>
<span><span class="co">#&gt;        max_altitude local_time</span></span>
<span><span class="co">#&gt;               &lt;num&gt;     &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt;     1:           33         NA</span></span>
<span><span class="co">#&gt;     2:           33         NA</span></span>
<span><span class="co">#&gt;     3:           33         NA</span></span>
<span><span class="co">#&gt;     4:           33         NA</span></span>
<span><span class="co">#&gt;     5:           33         NA</span></span>
<span><span class="co">#&gt;    ---                        </span></span>
<span><span class="co">#&gt; 11374:            3         NA</span></span>
<span><span class="co">#&gt; 11375:            3         NA</span></span>
<span><span class="co">#&gt; 11376:            3         NA</span></span>
<span><span class="co">#&gt; 11377:            3         NA</span></span>
<span><span class="co">#&gt; 11378:            3         NA</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="receptors">Receptors<a class="anchor" aria-label="anchor" href="#receptors"></a>
</h2>
<p>Now we can do the last step which is generating the receptor list
files. Now we filter selected columns</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span> <span class="op">&lt;-</span> <span class="va">master</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site_code"</span>,</span>
<span>                     <span class="st">"year"</span>,</span>
<span>                     <span class="st">"month"</span>,</span>
<span>                     <span class="st">"day"</span>,</span>
<span>                     <span class="st">"hour"</span>,</span>
<span>                     <span class="st">"minute"</span>,</span>
<span>                     <span class="st">"second"</span>,</span>
<span>                     <span class="st">"latitude"</span>,</span>
<span>                     <span class="st">"longitude"</span>,</span>
<span>                     <span class="st">"altitude_final"</span>,</span>
<span>                     <span class="st">"type_altitude"</span>,</span>
<span>                     <span class="st">"time_decimal"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We can round altitude also</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span><span class="op">$</span><span class="va">altitude_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">receptor</span><span class="op">$</span><span class="va">altitude_final</span><span class="op">)</span></span></code></pre></div>
<p>Now we can format time variables with two digits</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_format.html">obs_format</a></span><span class="op">(</span><span class="va">receptor</span>,</span>
<span>                        spf <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"month"</span>, <span class="st">"day"</span>,</span>
<span>                                 <span class="st">"hour"</span>, <span class="st">"minute"</span>, <span class="st">"second"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We have a column that indicate AGL or ASL</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor_agl</span> <span class="op">&lt;-</span> <span class="va">receptor</span><span class="op">[</span><span class="va">type_altitude</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="va">receptor_asl</span> <span class="op">&lt;-</span> <span class="va">receptor</span><span class="op">[</span><span class="va">type_altitude</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>Finally, we save the receptors</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">receptor_agl</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_AGL.txt"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receptor_agl</span>,</span>
<span>         file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_AGL.txt"</span><span class="op">)</span>,</span>
<span>         sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">receptor_asl</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_ASL.txt"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receptor_asl</span>,</span>
<span>         file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"receptor_ASL.txt"</span><span class="op">)</span>,</span>
<span>         sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\Rtmp4k67qL\file531463a43a74_surface-insitu_receptor_AGL.txt</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="plot">Plot<a class="anchor" aria-label="anchor" href="#plot"></a>
</h2>
<p>Finally, we just plot some data, run it locally</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/obs_plot.html">obs_plot</a></span><span class="op">(</span><span class="va">df4</span>, time <span class="op">=</span> <span class="st">"timeUTC"</span>, yfactor <span class="op">=</span> <span class="fl">1e9</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Found the following sites: </span></span>
<span><span class="co">#&gt;  [1] ABT   BCK   BRA   BRW   CARL  CBY   CHL   CPS   EGB   ESP   EST   ETL  </span></span>
<span><span class="co">#&gt; [13] FNE   FORT  FSD   GHG06 GHG09 HNP   HOBB  INU   INX01 INX02 INX07 INX08</span></span>
<span><span class="co">#&gt; [25] INX09 INX10 INX13 INX14 LLB   MALJ  MLO   OLI   SGP   THD   TPD   WSA  </span></span>
<span><span class="co">#&gt; Plotting the following sites: </span></span>
<span><span class="co">#&gt; [1] ABT BCK</span></span></code></pre>
<div class="float">
<img src="https://github.com/noaa-gml/rtorf/blob/main/man/figures/obsplot_surfaceinsitu.png?raw=true" alt="Time series"><div class="figcaption">Time series</div>
</div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">dx</span> <span class="op">&lt;-</span> <span class="va">df4</span><span class="op">[</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>    .SDcols <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">latitude</span>, <span class="va">longitude</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">dx</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"value"</span><span class="op">]</span>, axes <span class="op">=</span> <span class="cn">T</span>, reset <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu">map</span><span class="op">(</span>add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="https://github.com/noaa-gml/rtorf/blob/main/man/figures/obsplot_surfaceinsitu_map.png?raw=true" alt="Map"><div class="figcaption">Map</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sergio Ibarra-Espinosa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
