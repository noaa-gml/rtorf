<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>surface-flask • rtorf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="surface-flask">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtorf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/aircore.html">aircore</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-flask.html">aircraft-flask</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-insitu.html">aircraft-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-pfp.html">aircraft-pfp</a></li>
    <li><a class="dropdown-item" href="../articles/hysplit.html">hysplit</a></li>
    <li><a class="dropdown-item" href="../articles/shipboard-flask.html">shipboard-flask</a></li>
    <li><a class="dropdown-item" href="../articles/shipoboard-insitu.html">shipboard-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/summary.html">summary</a></li>
    <li><a class="dropdown-item" href="../articles/surface-flask.html">surface-flask</a></li>
    <li><a class="dropdown-item" href="../articles/surface-insitu.html">surface-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/surface-pfp.html">surface-pfp</a></li>
    <li><a class="dropdown-item" href="../articles/tower-insitu.html">tower-insitu</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/noaa-gml/rtorf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>surface-flask</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/noaa-gml/rtorf/blob/main/vignettes/surface-flask.Rmd" class="external-link"><code>vignettes/surface-flask.Rmd</code></a></small>
      <div class="d-none name"><code>surface-flask.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/noaa-gml/rtorf" class="external-link">rtorf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aircraft-pfp"</span>,</span>
<span>         <span class="st">"aircraft-insitu"</span>,</span>
<span>         <span class="st">"aircraft-flask"</span>,</span>
<span>         <span class="st">"surface-insitu"</span>,</span>
<span>         <span class="st">"surface-flask"</span>, </span>
<span>         <span class="st">"surface-pfp"</span>,   </span>
<span>         <span class="st">"tower-insitu"</span>,  </span>
<span>         <span class="st">"aircore"</span>,       </span>
<span>         <span class="st">"shipboard-insitu"</span>,</span>
<span>         <span class="st">"shipboard-flask"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="st">"Z:/obspack/obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08/data/nc/"</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_summary.html">obs_summary</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>                     categories <span class="op">=</span> <span class="va">cate</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Number of files of index: 429</span></span>
<span><span class="co">#&gt;               sector     N</span></span>
<span><span class="co">#&gt;               &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1:     aircraft-pfp    40</span></span>
<span><span class="co">#&gt;  2:  aircraft-insitu    15</span></span>
<span><span class="co">#&gt;  3:    surface-flask   106</span></span>
<span><span class="co">#&gt;  4:   surface-insitu   174</span></span>
<span><span class="co">#&gt;  5:   aircraft-flask     4</span></span>
<span><span class="co">#&gt;  6:          aircore     1</span></span>
<span><span class="co">#&gt;  7:      surface-pfp    33</span></span>
<span><span class="co">#&gt;  8:     tower-insitu    51</span></span>
<span><span class="co">#&gt;  9:  shipboard-flask     4</span></span>
<span><span class="co">#&gt; 10: shipboard-insitu     1</span></span>
<span><span class="co">#&gt; 11:    Total sectors   429</span></span>
<span><span class="co">#&gt; Detected 190 files with agl</span></span>
<span><span class="co">#&gt; Detected 239 files without agl</span></span></code></pre>
<p>Now we read the <code>surface-flask</code> using the function
<code>obs_read_nc</code>. <code>solar_time</code> is included for
surface, so we <code>TRUE</code> that argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datasetid</span> <span class="op">&lt;-</span> <span class="st">"surface-flask"</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_read_nc.html">obs_read_nc</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">index</span>,</span>
<span>                  categories <span class="op">=</span> <span class="va">datasetid</span>,</span>
<span>                  solar_time <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Searching surface-flask...</span></span>
<span><span class="co">#&gt; 1: ch4_abp_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 2: ch4_alt_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 3: ch4_alt_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 4: ch4_alt_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 5: ch4_ams_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 6: ch4_amt_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 7: ch4_amy_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 8: ch4_ara_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 9: ch4_asc_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 10: ch4_ask_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 11: ch4_avi_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 12: ch4_azr_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 13: ch4_bal_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 14: ch4_bhd_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 15: ch4_bik_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 16: ch4_bkt_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 17: ch4_bme_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 18: ch4_bmw_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 19: ch4_bnt_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 20: ch4_brw_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 21: ch4_bsc_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 22: ch4_cba_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 23: ch4_cfa_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 24: ch4_cgo_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 25: ch4_cgo_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 26: ch4_cgo_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 27: ch4_chr_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 28: ch4_cib_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 29: ch4_cmo_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 30: ch4_cpa_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 31: ch4_cpt_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 32: ch4_cri_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 33: ch4_crz_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 34: ch4_cvo_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 35: ch4_cya_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 36: ch4_dsi_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 37: ch4_eic_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 38: ch4_esp_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 39: ch4_gmi_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 40: ch4_goz_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 41: ch4_gpa_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 42: ch4_gvn_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 43: ch4_hba_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 44: ch4_hpb_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 45: ch4_hsu_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 46: ch4_hun_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 47: ch4_ice_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 48: ch4_izo_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 49: ch4_jfj_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 50: ch4_key_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 51: ch4_kjn_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 52: ch4_kum_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 53: ch4_kzd_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 54: ch4_kzm_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 55: ch4_lef_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 56: ch4_llb_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 57: ch4_lln_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 58: ch4_lmp_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 59: ch4_maa_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 60: ch4_mbc_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 61: ch4_mex_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 62: ch4_mhd_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 63: ch4_mid_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 64: ch4_mkn_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 65: ch4_mlo_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 66: ch4_mlo_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 67: ch4_mqa_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 68: ch4_nam_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 69: ch4_nat_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 70: ch4_nmb_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 71: ch4_nwr_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 72: ch4_obn_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 73: ch4_opw_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 74: ch4_ota_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 75: ch4_oxk_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 76: ch4_oxk_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 77: ch4_pal_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 78: ch4_psa_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 79: ch4_pta_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 80: ch4_rpb_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 81: ch4_sdz_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 82: ch4_sey_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 83: ch4_sgi_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 84: ch4_sgp_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 85: ch4_shm_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 86: ch4_sis_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 87: ch4_sis_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 88: ch4_smo_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 89: ch4_spo_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 90: ch4_spo_surface-flask_2_representative.nc</span></span>
<span><span class="co">#&gt; 91: ch4_stm_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 92: ch4_sum_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 93: ch4_syo_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 94: ch4_tac_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 95: ch4_tap_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 96: ch4_thd_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 97: ch4_tik_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 98: ch4_ush_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 99: ch4_uta_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 100: ch4_uum_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 101: ch4_vrs_surface-flask_45_representative.nc</span></span>
<span><span class="co">#&gt; 102: ch4_wis_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 103: ch4_wkt_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 104: ch4_wlg_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 105: ch4_zep_surface-flask_1_representative.nc</span></span>
<span><span class="co">#&gt; 106: ch4_zot_surface-flask_45_representative.nc</span></span></code></pre>
<p>Now we check the data</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;          year month   day  hour minute second       time start_time</span></span>
<span><span class="co">#&gt;         &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt;      1:  2006    10    27    15     50      0 1161964200 1161964200</span></span>
<span><span class="co">#&gt;      2:  2006    11     3    16     24      0 1162571040 1162571040</span></span>
<span><span class="co">#&gt;      3:  2006    11    18    15     47      0 1163864820 1163864820</span></span>
<span><span class="co">#&gt;      4:  2006    11    24    15     54      0 1164383640 1164383640</span></span>
<span><span class="co">#&gt;      5:  2006    12     1    17      2      0 1164992520 1164992520</span></span>
<span><span class="co">#&gt;     ---                                                            </span></span>
<span><span class="co">#&gt; 107797:  2021    11    28    12     30      0 1638102600 1638102600</span></span>
<span><span class="co">#&gt; 107798:  2021    12     5     8     56      0 1638694560 1638694560</span></span>
<span><span class="co">#&gt; 107799:  2021    12    12     9     46      0 1639302360 1639302360</span></span>
<span><span class="co">#&gt; 107800:  2021    12    19     7     59      0 1639900740 1639900740</span></span>
<span><span class="co">#&gt; 107801:  2021    12    26    12     51      0 1640523060 1640523060</span></span>
<span><span class="co">#&gt;         midpoint_time             datetime time_decimal time_interval</span></span>
<span><span class="co">#&gt;                 &lt;int&gt;               &lt;char&gt;        &lt;num&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt;      1:    1161964200 2006-10-27T15:50:00Z     2006.821          3600</span></span>
<span><span class="co">#&gt;      2:    1162571040 2006-11-03T16:24:00Z     2006.840          3600</span></span>
<span><span class="co">#&gt;      3:    1163864820 2006-11-18T15:47:00Z     2006.881          3600</span></span>
<span><span class="co">#&gt;      4:    1164383640 2006-11-24T15:54:00Z     2006.898          3600</span></span>
<span><span class="co">#&gt;      5:    1164992520 2006-12-01T17:02:00Z     2006.917          3600</span></span>
<span><span class="co">#&gt;     ---                                                              </span></span>
<span><span class="co">#&gt; 107797:    1638102600 2021-11-28T12:30:00Z     2021.908          3600</span></span>
<span><span class="co">#&gt; 107798:    1638694560 2021-12-05T08:56:00Z     2021.927          3600</span></span>
<span><span class="co">#&gt; 107799:    1639302360 2021-12-12T09:46:00Z     2021.946          3600</span></span>
<span><span class="co">#&gt; 107800:    1639900740 2021-12-19T07:59:00Z     2021.965          3600</span></span>
<span><span class="co">#&gt; 107801:    1640523060 2021-12-26T12:51:00Z     2021.985          3600</span></span>
<span><span class="co">#&gt;                value value_unc nvalue value_std_dev latitude longitude altitude</span></span>
<span><span class="co">#&gt;                &lt;num&gt;     &lt;num&gt;  &lt;int&gt;         &lt;num&gt;    &lt;num&gt;     &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;      1: 1.736280e-06  2.05e-09      2  7.636753e-10   -12.76    -38.16        6</span></span>
<span><span class="co">#&gt;      2: 1.739605e-06  2.05e-09      2  5.444722e-10   -12.76    -38.16        6</span></span>
<span><span class="co">#&gt;      3: 1.731770e-06  2.05e-09      2  1.159655e-09   -12.76    -38.16        6</span></span>
<span><span class="co">#&gt;      4: 1.733130e-06  2.05e-09      2  1.131371e-10   -12.76    -38.16        6</span></span>
<span><span class="co">#&gt;      5: 1.745230e-06  2.05e-09      2  5.232590e-10   -12.76    -38.16        6</span></span>
<span><span class="co">#&gt;     ---                                                                        </span></span>
<span><span class="co">#&gt; 107797: 2.039500e-06        NA      1  8.600000e-10    60.75     89.38      411</span></span>
<span><span class="co">#&gt; 107798: 2.102740e-06        NA      1  7.900000e-10    60.75     89.38      411</span></span>
<span><span class="co">#&gt; 107799: 2.087280e-06        NA      1  3.100000e-10    60.75     89.38      411</span></span>
<span><span class="co">#&gt; 107800: 2.067420e-06        NA      1  2.000000e-09    60.75     89.38      411</span></span>
<span><span class="co">#&gt; 107801: 2.024140e-06        NA      1  6.000000e-09    60.75     89.38      411</span></span>
<span><span class="co">#&gt;         elevation intake_height qcflag instrument   analysis_datetime method</span></span>
<span><span class="co">#&gt;             &lt;num&gt;         &lt;num&gt; &lt;char&gt;     &lt;char&gt;              &lt;char&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt;      1:         1             5    ...         H4 2007-04-02T12:43:00      G</span></span>
<span><span class="co">#&gt;      2:         1             5    ...         H4 2007-02-20T13:29:00      G</span></span>
<span><span class="co">#&gt;      3:         1             5    ...         H4 2007-02-20T13:00:00      G</span></span>
<span><span class="co">#&gt;      4:         1             5    ...         H4 2007-02-20T09:55:00      G</span></span>
<span><span class="co">#&gt;      5:         1             5    ...         H4 2007-02-16T15:39:00      G</span></span>
<span><span class="co">#&gt;     ---                                                                     </span></span>
<span><span class="co">#&gt; 107797:       111           300      0       &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 107798:       111           300      0       &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 107799:       111           300      0       &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 107800:       111           300      0       &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 107801:       111           300      0       &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;          event_number air_sample_container_id obs_flag obspack_num</span></span>
<span><span class="co">#&gt;                &lt;char&gt;                  &lt;char&gt;    &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;      1: 231671,231672         1779-99,1780-99        1     1033168</span></span>
<span><span class="co">#&gt;      2: 229105,229106         6717-66,6718-66        1     1033169</span></span>
<span><span class="co">#&gt;      3: 229103,229104         2969-99,2970-99        1     1033170</span></span>
<span><span class="co">#&gt;      4: 229081,229082         3217-99,3218-99        1     1033171</span></span>
<span><span class="co">#&gt;      5: 229079,229080           759-99,760-99        1     1033172</span></span>
<span><span class="co">#&gt;     ---                                                           </span></span>
<span><span class="co">#&gt; 107797:          &lt;NA&gt;                    &lt;NA&gt;        1    10187962</span></span>
<span><span class="co">#&gt; 107798:          &lt;NA&gt;                    &lt;NA&gt;        1    10187963</span></span>
<span><span class="co">#&gt; 107799:          &lt;NA&gt;                    &lt;NA&gt;        1    10187964</span></span>
<span><span class="co">#&gt; 107800:          &lt;NA&gt;                    &lt;NA&gt;        1    10187965</span></span>
<span><span class="co">#&gt; 107801:          &lt;NA&gt;                    &lt;NA&gt;        1    10187966</span></span>
<span><span class="co">#&gt;                                                                                            obspack_id</span></span>
<span><span class="co">#&gt;                                                                                                &lt;char&gt;</span></span>
<span><span class="co">#&gt;      1:   obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abp_surface-flask_1_representative~1033168</span></span>
<span><span class="co">#&gt;      2:   obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abp_surface-flask_1_representative~1033169</span></span>
<span><span class="co">#&gt;      3:   obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abp_surface-flask_1_representative~1033170</span></span>
<span><span class="co">#&gt;      4:   obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abp_surface-flask_1_representative~1033171</span></span>
<span><span class="co">#&gt;      5:   obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_abp_surface-flask_1_representative~1033172</span></span>
<span><span class="co">#&gt;     ---                                                                                              </span></span>
<span><span class="co">#&gt; 107797: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zot_surface-flask_45_representative~10187962</span></span>
<span><span class="co">#&gt; 107798: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zot_surface-flask_45_representative~10187963</span></span>
<span><span class="co">#&gt; 107799: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zot_surface-flask_45_representative~10187964</span></span>
<span><span class="co">#&gt; 107800: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zot_surface-flask_45_representative~10187965</span></span>
<span><span class="co">#&gt; 107801: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_zot_surface-flask_45_representative~10187966</span></span>
<span><span class="co">#&gt;         unique_sample_location_num year_st month_st day_st hour_st minute_st</span></span>
<span><span class="co">#&gt;                              &lt;int&gt;   &lt;int&gt;    &lt;int&gt;  &lt;int&gt;   &lt;int&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt;      1:                   21955180    2006       10     27      13        33</span></span>
<span><span class="co">#&gt;      2:                   21955181    2006       11      3      14         7</span></span>
<span><span class="co">#&gt;      3:                   21955182    2006       11     18      13        28</span></span>
<span><span class="co">#&gt;      4:                   21955183    2006       11     24      13        34</span></span>
<span><span class="co">#&gt;      5:                   21955184    2006       12      1      14        39</span></span>
<span><span class="co">#&gt;     ---                                                                     </span></span>
<span><span class="co">#&gt; 107797:                   54363784    2021       11     28      18        38</span></span>
<span><span class="co">#&gt; 107798:                   54363785    2021       12      5      15         2</span></span>
<span><span class="co">#&gt; 107799:                   54363786    2021       12     12      15        49</span></span>
<span><span class="co">#&gt; 107800:                   54887377    2021       12     19      13        59</span></span>
<span><span class="co">#&gt; 107801:                   54363787    2021       12     26      18        47</span></span>
<span><span class="co">#&gt;         second_st          scale site_elevation_unit dataset_project</span></span>
<span><span class="co">#&gt;             &lt;int&gt;         &lt;char&gt;              &lt;char&gt;          &lt;char&gt;</span></span>
<span><span class="co">#&gt;      1:        36 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt;      2:        42 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt;      3:        40 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt;      4:         4 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt;      5:        42 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt;     ---                                                             </span></span>
<span><span class="co">#&gt; 107797:        56 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt; 107798:        19 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt; 107799:        21 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt; 107800:         9 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt; 107801:        54 WMO CH4 X2004A                masl   surface-flask</span></span>
<span><span class="co">#&gt;         dataset_selection_tag       site_name site_elevation site_latitude</span></span>
<span><span class="co">#&gt;                        &lt;char&gt;          &lt;char&gt;          &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;      1:        representative Arembepe, Bahia              1        -12.77</span></span>
<span><span class="co">#&gt;      2:        representative Arembepe, Bahia              1        -12.77</span></span>
<span><span class="co">#&gt;      3:        representative Arembepe, Bahia              1        -12.77</span></span>
<span><span class="co">#&gt;      4:        representative Arembepe, Bahia              1        -12.77</span></span>
<span><span class="co">#&gt;      5:        representative Arembepe, Bahia              1        -12.77</span></span>
<span><span class="co">#&gt;     ---                                                                   </span></span>
<span><span class="co">#&gt; 107797:        representative Zotino, Siberia            111         60.75</span></span>
<span><span class="co">#&gt; 107798:        representative Zotino, Siberia            111         60.75</span></span>
<span><span class="co">#&gt; 107799:        representative Zotino, Siberia            111         60.75</span></span>
<span><span class="co">#&gt; 107800:        representative Zotino, Siberia            111         60.75</span></span>
<span><span class="co">#&gt; 107801:        representative Zotino, Siberia            111         60.75</span></span>
<span><span class="co">#&gt;         site_longitude site_country site_code site_utc2lst lab_1_abbr</span></span>
<span><span class="co">#&gt;                  &lt;num&gt;       &lt;char&gt;    &lt;char&gt;        &lt;num&gt;     &lt;char&gt;</span></span>
<span><span class="co">#&gt;      1:         -38.17       Brazil       ABP           -3       NOAA</span></span>
<span><span class="co">#&gt;      2:         -38.17       Brazil       ABP           -3       NOAA</span></span>
<span><span class="co">#&gt;      3:         -38.17       Brazil       ABP           -3       NOAA</span></span>
<span><span class="co">#&gt;      4:         -38.17       Brazil       ABP           -3       NOAA</span></span>
<span><span class="co">#&gt;      5:         -38.17       Brazil       ABP           -3       NOAA</span></span>
<span><span class="co">#&gt;     ---                                                              </span></span>
<span><span class="co">#&gt; 107797:          89.38       Russia       ZOT            7    MPI-BGC</span></span>
<span><span class="co">#&gt; 107798:          89.38       Russia       ZOT            7    MPI-BGC</span></span>
<span><span class="co">#&gt; 107799:          89.38       Russia       ZOT            7    MPI-BGC</span></span>
<span><span class="co">#&gt; 107800:          89.38       Russia       ZOT            7    MPI-BGC</span></span>
<span><span class="co">#&gt; 107801:          89.38       Russia       ZOT            7    MPI-BGC</span></span>
<span><span class="co">#&gt;         dataset_calibration_scale altitude_final type_altitude</span></span>
<span><span class="co">#&gt;                            &lt;char&gt;          &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;      1:            WMO CH4 X2004A              5            NA</span></span>
<span><span class="co">#&gt;      2:            WMO CH4 X2004A              5            NA</span></span>
<span><span class="co">#&gt;      3:            WMO CH4 X2004A              5            NA</span></span>
<span><span class="co">#&gt;      4:            WMO CH4 X2004A              5            NA</span></span>
<span><span class="co">#&gt;      5:            WMO CH4 X2004A              5            NA</span></span>
<span><span class="co">#&gt;     ---                                                       </span></span>
<span><span class="co">#&gt; 107797:            WMO CH4 X2004A            300             0</span></span>
<span><span class="co">#&gt; 107798:            WMO CH4 X2004A            300             0</span></span>
<span><span class="co">#&gt; 107799:            WMO CH4 X2004A            300             0</span></span>
<span><span class="co">#&gt; 107800:            WMO CH4 X2004A            300             0</span></span>
<span><span class="co">#&gt; 107801:            WMO CH4 X2004A            300             0</span></span>
<span><span class="co">#&gt;         dataset_intake_ht_unit</span></span>
<span><span class="co">#&gt;                         &lt;char&gt;</span></span>
<span><span class="co">#&gt;      1:                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;      2:                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;      3:                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;      4:                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;      5:                   &lt;NA&gt;</span></span>
<span><span class="co">#&gt;     ---                       </span></span>
<span><span class="co">#&gt; 107797:                   magl</span></span>
<span><span class="co">#&gt; 107798:                   magl</span></span>
<span><span class="co">#&gt; 107799:                   magl</span></span>
<span><span class="co">#&gt; 107800:                   magl</span></span>
<span><span class="co">#&gt; 107801:                   magl</span></span></code></pre>
<p>Now we can process the data. We first filter for observations within
our spatial domain:</p>
<div class="section level2">
<h2 id="checks-and-definitions">Checks and definitions<a class="anchor" aria-label="anchor" href="#checks-and-definitions"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">north</span> <span class="op">&lt;-</span> <span class="fl">80</span></span>
<span><span class="va">south</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">west</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">170</span></span>
<span><span class="va">east</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">50</span></span>
<span><span class="va">max_altitude</span> <span class="op">&lt;-</span> <span class="fl">8000</span></span>
<span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="fl">2020</span></span>
<span><span class="va">evening</span> <span class="op">&lt;-</span> <span class="fl">14</span></span></code></pre></div>
<p>We check altitude, intake_height, altitude_final and elevation.
altitude_final is a column from intake_height, added to match column
from obs_read text files.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"altitude"</span>, <span class="st">"altitude_final"</span>, <span class="st">"intake_height"</span>, <span class="st">"elevation"</span>,</span>
<span>       <span class="st">"dataset_selection_tag"</span>,</span>
<span>              <span class="st">"site_name"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;         altitude altitude_final intake_height elevation dataset_selection_tag</span></span>
<span><span class="co">#&gt;            &lt;num&gt;          &lt;num&gt;         &lt;num&gt;     &lt;num&gt;                &lt;char&gt;</span></span>
<span><span class="co">#&gt;      1:        6              5             5         1        representative</span></span>
<span><span class="co">#&gt;      2:        6              5             5         1        representative</span></span>
<span><span class="co">#&gt;      3:        6              5             5         1        representative</span></span>
<span><span class="co">#&gt;      4:        6              5             5         1        representative</span></span>
<span><span class="co">#&gt;      5:        6              5             5         1        representative</span></span>
<span><span class="co">#&gt;     ---                                                                      </span></span>
<span><span class="co">#&gt; 107797:      411            300           300       111        representative</span></span>
<span><span class="co">#&gt; 107798:      411            300           300       111        representative</span></span>
<span><span class="co">#&gt; 107799:      411            300           300       111        representative</span></span>
<span><span class="co">#&gt; 107800:      411            300           300       111        representative</span></span>
<span><span class="co">#&gt; 107801:      411            300           300       111        representative</span></span>
<span><span class="co">#&gt;               site_name</span></span>
<span><span class="co">#&gt;                  &lt;char&gt;</span></span>
<span><span class="co">#&gt;      1: Arembepe, Bahia</span></span>
<span><span class="co">#&gt;      2: Arembepe, Bahia</span></span>
<span><span class="co">#&gt;      3: Arembepe, Bahia</span></span>
<span><span class="co">#&gt;      4: Arembepe, Bahia</span></span>
<span><span class="co">#&gt;      5: Arembepe, Bahia</span></span>
<span><span class="co">#&gt;     ---                </span></span>
<span><span class="co">#&gt; 107797: Zotino, Siberia</span></span>
<span><span class="co">#&gt; 107798: Zotino, Siberia</span></span>
<span><span class="co">#&gt; 107799: Zotino, Siberia</span></span>
<span><span class="co">#&gt; 107800: Zotino, Siberia</span></span>
<span><span class="co">#&gt; 107801: Zotino, Siberia</span></span></code></pre>
<p>The temporal range of data is</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 1983 2021</span></span></code></pre>
<p>We also check for dimensions of data</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 107801     53</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="filters">Filters<a class="anchor" aria-label="anchor" href="#filters"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="va">yy</span><span class="op">]</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">altitude_final</span> <span class="op">&lt;</span> <span class="va">max_altitude</span> <span class="op">&amp;</span></span>
<span>           <span class="va">latitude</span> <span class="op">&lt;</span> <span class="va">north</span> <span class="op">&amp;</span></span>
<span>           <span class="va">latitude</span> <span class="op">&gt;</span> <span class="va">south</span> <span class="op">&amp;</span></span>
<span>           <span class="va">longitude</span> <span class="op">&lt;</span> <span class="va">east</span> <span class="op">&amp;</span></span>
<span>           <span class="va">longitude</span> <span class="op">&gt;</span> <span class="va">west</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 799  53</span></span></code></pre>
<p>Towers can have observations at different heights. Here we need to
select one site with the observations registered at the highest height.
The column with the height is named <code>altitude_final</code> and the
max altitude was named <code>max_altitude</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfa</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">altitude_final</span><span class="op">)</span>,</span>
<span>          by <span class="op">=</span> <span class="va">site_code</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dfa</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"max_altitude"</span></span>
<span><span class="va">dfa</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;     site_code max_altitude</span></span>
<span><span class="co">#&gt;        &lt;char&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:       BMW         21.3</span></span>
<span><span class="co">#&gt;  2:       BRW         16.5</span></span>
<span><span class="co">#&gt;  3:       CBA         35.7</span></span>
<span><span class="co">#&gt;  4:       KEY          5.0</span></span>
<span><span class="co">#&gt;  5:       KUM          5.0</span></span>
<span><span class="co">#&gt;  6:       LEF        396.0</span></span>
<span><span class="co">#&gt;  7:       MEX          5.0</span></span>
<span><span class="co">#&gt;  8:       MLO         40.0</span></span>
<span><span class="co">#&gt;  9:       NWR          3.0</span></span>
<span><span class="co">#&gt; 10:       RPB          5.0</span></span>
<span><span class="co">#&gt; 11:       SGP         60.0</span></span>
<span><span class="co">#&gt; 12:       UTA          5.0</span></span></code></pre>
<div class="section level3">
<h3 id="key-time">Key Time<a class="anchor" aria-label="anchor" href="#key-time"></a>
</h3>
<p>Here we need to start time columns. The function
<code>obs_addtime</code> adds time columns <code>timeUTC</code>,
<code>timeUTC_start</code> which shows the start time of each
observation and <code>timeUTC_end</code> which shows the end time for
each observation.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_addtime.html">obs_addtime</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Adding timeUTC</span></span>
<span><span class="co">#&gt; Adding timeUTC_start</span></span>
<span><span class="co">#&gt; Adding timeUTC_end</span></span>
<span><span class="co">#&gt; Found time_interval</span></span></code></pre>
<p>Then we need a <em>key_time</em> to aggregate data. This can be done
using UTC, solar, or local time. The normal approach is using afternoon
solar or local time.</p>
<div class="section level4">
<h4 id="hierarchy-of-solar-or-local-time">Hierarchy of solar or local time<a class="anchor" aria-label="anchor" href="#hierarchy-of-solar-or-local-time"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Solar time</li>
<li>Local time with columns <code>site_utc2lst</code>
</li>
<li>Local time longitude</li>
</ol>
<blockquote>
<p>solar time (default)</p>
</blockquote>
<p>Here we select the hours of interest and then aggregate data by year,
month and day of solar time. In this way, we will have one information
per day. however this approach is not appropriate for aircraft which are
aggregated every 10 or 20 seconds. Hence we need to aggregate data by
one time column. Also, this helps to generate the receptor info files
including hour, minute and second. Hence, <em>we need to add solar or
local time column</em>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span><span class="op">$</span><span class="va">solar_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_addstime.html">obs_addstime</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>local time with column <code>site_utc2lst</code></p>
</blockquote>
<p>Then we need to identify the local time with the function
<code>add_ltime</code>. This is important because to identifying
observations in the evening in local time. <code>add_ltime</code> uses
two methods, first identify the time difference with utc by identifying
the metadata column “site_utc2lst”. If solar time is not available #now
we need to cut solar time for the frequency needed. As we will work
with</p>
<blockquote>
<p>local time longitude</p>
</blockquote>
<p>If this information is not available, with the aircrafts for
instance, the local time is calculated with an approximation based on
longitude:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>t</mi><mo>=</mo><mi>U</mi><mi>T</mi><mi>C</mi><mo>+</mo><mi>l</mi><mi>o</mi><mi>n</mi><mi>g</mi><mi>i</mi><mi>t</mi><mi>u</mi><mi>d</mi><mi>e</mi><mi>/</mi><mn>15</mn><mo>*</mo><mn>60</mn><mo>*</mo><mn>60</mn></mrow><annotation encoding="application/x-tex">
lt = UTC + longitude/15 * 60 * 60
</annotation></semantics></math> Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">lt</annotation></semantics></math>
is the local time,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mi>T</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">UTC</annotation></semantics></math>
the time,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>n</mi><mi>g</mi><mi>i</mi><mi>t</mi><mi>u</mi><mi>d</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">longitude</annotation></semantics></math>
the coordinate. Then, the time is cut every two hours. Now, we identify
the local time to select evening hours.</p>
</div>
<div class="section level4">
<h4 id="cut-time">Cut time<a class="anchor" aria-label="anchor" href="#cut-time"></a>
</h4>
<p>Now we have they key column time, we can cut it accordingly.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span><span class="op">$</span><span class="va">solar_time_cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df2</span><span class="op">$</span><span class="va">solar_time</span>,</span>
<span>                          breaks <span class="op">=</span> <span class="st">"1 hour"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>How we can check the solar time and the cut solar time. Please note
that solar_time_cut, the column that it will be used to aggregate
data</p>
<p>How we filter for the required solar time, in this case 14.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="va">df2</span><span class="op">[</span><span class="va">hour_st</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">evening</span><span class="op">]</span></span>
<span><span class="va">df3</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"solar_time"</span>, <span class="st">"solar_time_cut"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              solar_time      solar_time_cut</span></span>
<span><span class="co">#&gt;                  &lt;POSc&gt;              &lt;char&gt;</span></span>
<span><span class="co">#&gt;  1: 2020-03-10 14:22:19 2020-03-10 14:00:00</span></span>
<span><span class="co">#&gt;  2: 2020-04-01 14:28:02 2020-04-01 14:00:00</span></span>
<span><span class="co">#&gt;  3: 2020-04-14 14:52:45 2020-04-14 14:00:00</span></span>
<span><span class="co">#&gt;  4: 2020-10-02 14:24:04 2020-10-02 14:00:00</span></span>
<span><span class="co">#&gt;  5: 2020-10-02 14:44:04 2020-10-02 14:00:00</span></span>
<span><span class="co">#&gt;  6: 2020-10-05 14:15:59 2020-10-05 14:00:00</span></span>
<span><span class="co">#&gt;  7: 2020-10-30 14:06:56 2020-10-30 14:00:00</span></span>
<span><span class="co">#&gt;  8: 2020-10-30 14:24:56 2020-10-30 14:00:00</span></span>
<span><span class="co">#&gt;  9: 2020-11-10 14:04:10 2020-11-10 14:00:00</span></span>
<span><span class="co">#&gt; 10: 2020-11-10 14:22:10 2020-11-10 14:00:00</span></span>
<span><span class="co">#&gt; 11: 2020-03-27 14:23:57 2020-03-27 14:00:00</span></span>
<span><span class="co">#&gt; 12: 2020-04-22 14:09:09 2020-04-22 14:00:00</span></span>
<span><span class="co">#&gt; 13: 2020-05-28 14:19:16 2020-05-28 14:00:00</span></span>
<span><span class="co">#&gt; 14: 2020-06-09 14:38:15 2020-06-09 14:00:00</span></span>
<span><span class="co">#&gt; 15: 2020-06-18 14:29:22 2020-06-18 14:00:00</span></span>
<span><span class="co">#&gt; 16: 2020-06-25 14:18:50 2020-06-25 14:00:00</span></span>
<span><span class="co">#&gt; 17: 2020-07-15 14:18:25 2020-07-15 14:00:00</span></span>
<span><span class="co">#&gt; 18: 2020-12-12 14:41:10 2020-12-12 14:00:00</span></span>
<span><span class="co">#&gt; 19: 2020-03-25 14:30:43 2020-03-25 14:00:00</span></span>
<span><span class="co">#&gt; 20: 2020-04-09 14:27:40 2020-04-09 14:00:00</span></span>
<span><span class="co">#&gt; 21: 2020-04-23 14:23:37 2020-04-23 14:00:00</span></span>
<span><span class="co">#&gt; 22: 2020-04-27 14:54:16 2020-04-27 14:00:00</span></span>
<span><span class="co">#&gt; 23: 2020-05-18 14:16:12 2020-05-18 14:00:00</span></span>
<span><span class="co">#&gt; 24: 2020-06-15 14:03:53 2020-06-15 14:00:00</span></span>
<span><span class="co">#&gt; 25: 2020-06-15 14:17:53 2020-06-15 14:00:00</span></span>
<span><span class="co">#&gt; 26: 2020-06-22 14:24:21 2020-06-22 14:00:00</span></span>
<span><span class="co">#&gt; 27: 2020-06-22 14:41:21 2020-06-22 14:00:00</span></span>
<span><span class="co">#&gt; 28: 2020-08-05 14:25:26 2020-08-05 14:00:00</span></span>
<span><span class="co">#&gt; 29: 2020-08-05 14:39:26 2020-08-05 14:00:00</span></span>
<span><span class="co">#&gt; 30: 2020-11-02 14:18:47 2020-11-02 14:00:00</span></span>
<span><span class="co">#&gt; 31: 2020-11-02 14:32:47 2020-11-02 14:00:00</span></span>
<span><span class="co">#&gt; 32: 2020-11-12 14:13:45 2020-11-12 14:00:00</span></span>
<span><span class="co">#&gt; 33: 2020-11-27 14:14:50 2020-11-27 14:00:00</span></span>
<span><span class="co">#&gt; 34: 2020-11-27 14:28:50 2020-11-27 14:00:00</span></span>
<span><span class="co">#&gt; 35: 2020-12-22 14:11:13 2020-12-22 14:00:00</span></span>
<span><span class="co">#&gt; 36: 2020-12-22 14:28:13 2020-12-22 14:00:00</span></span>
<span><span class="co">#&gt; 37: 2020-02-18 14:27:33 2020-02-18 14:00:00</span></span>
<span><span class="co">#&gt; 38: 2020-01-06 14:27:37 2020-01-06 14:00:00</span></span>
<span><span class="co">#&gt; 39: 2020-04-22 14:26:55 2020-04-22 14:00:00</span></span>
<span><span class="co">#&gt; 40: 2020-05-05 14:25:44 2020-05-05 14:00:00</span></span>
<span><span class="co">#&gt; 41: 2020-05-22 14:34:41 2020-05-22 14:00:00</span></span>
<span><span class="co">#&gt; 42: 2020-06-04 14:51:57 2020-06-04 14:00:00</span></span>
<span><span class="co">#&gt; 43: 2020-07-09 14:04:58 2020-07-09 14:00:00</span></span>
<span><span class="co">#&gt; 44: 2020-08-26 14:52:18 2020-08-26 14:00:00</span></span>
<span><span class="co">#&gt; 45: 2020-09-26 14:44:19 2020-09-26 14:00:00</span></span>
<span><span class="co">#&gt; 46: 2020-12-13 14:33:29 2020-12-13 14:00:00</span></span>
<span><span class="co">#&gt; 47: 2020-12-31 14:17:13 2020-12-31 14:00:00</span></span>
<span><span class="co">#&gt;              solar_time      solar_time_cut</span></span></code></pre>
<p>At this point we can calculate the averages of several columns by the
cut time. The function <code>obs_agg</code> does this aggregation as
shown in the following lines of code. The argument <code>gby</code>
establish the function used to aggregate <code>cols</code>. I need to
aggregate the data by date (year, month, date), because it is already
filtered by the hours of interest. Then, I would have 1 observation per
day.</p>
<p>As standard, let us define <code>key_time</code> as
<code>solar_time</code>. The <code>obs_agg</code> function will
aggregate the desired data by that column.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df3</span><span class="op">$</span><span class="va">key_time</span> <span class="op">&lt;-</span> <span class="va">df3</span><span class="op">$</span><span class="va">solar_time_cut</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_agg.html">obs_agg</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="va">df3</span>,</span>
<span>               cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>,</span>
<span>                        <span class="st">"latitude"</span>,</span>
<span>                        <span class="st">"longitude"</span>,</span>
<span>                        <span class="st">"site_utc2lst"</span><span class="op">)</span>,</span>
<span>               verbose <span class="op">=</span> <span class="cn">T</span>,</span>
<span>               byalt <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Selecting by alt</span></span>
<span><span class="co">#&gt; Adding time</span></span></code></pre>
<p>Here we add the column <code>max_altitude</code> to identify the max
altitude by site.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df4</span><span class="op">[</span>,</span>
<span>    <span class="va">max_altitude</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">altitude_final</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="va">site_code</span><span class="op">]</span></span>
<span><span class="va">df4</span><span class="op">[</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site_code"</span>,</span>
<span>      <span class="st">"altitude_final"</span>,</span>
<span>      <span class="st">"max_altitude"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;    site_code altitude_final max_altitude</span></span>
<span><span class="co">#&gt;       &lt;char&gt;          &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:       BRW            5.0         16.5</span></span>
<span><span class="co">#&gt; 2:       BRW           16.5         16.5</span></span>
<span><span class="co">#&gt; 3:       KEY            5.0          5.0</span></span>
<span><span class="co">#&gt; 4:       KUM            5.0          5.0</span></span>
<span><span class="co">#&gt; 5:       NWR            3.0          3.0</span></span>
<span><span class="co">#&gt; 6:       UTA            5.0          5.0</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="master">Master<a class="anchor" aria-label="anchor" href="#master"></a>
</h2>
<p>Before generating the receptors list, we have the database with all
the required information</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master</span> <span class="op">&lt;-</span> <span class="va">df4</span></span></code></pre></div>
<p>We may replace missing values with a nine nines. Here is
commented</p>
<p>#master[is.na(master)] &lt;- 999999999</p>
<p>We transform the time variables to character and round coordinates
with 4 digits</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master</span><span class="op">$</span><span class="va">timeUTC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">timeUTC</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">local_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">local_time</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">latitude</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">longitude</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="save-master">Save master<a class="anchor" aria-label="anchor" href="#save-master"></a>
</h2>
<p>Finally we save the master file</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="txt">txt<a class="anchor" aria-label="anchor" href="#txt"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".txt\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">master</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".txt"</span><span class="op">)</span>,</span>
<span>       sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpSMAWpf\file9558428068b2_surface-flask.txt</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="csv">csv<a class="anchor" aria-label="anchor" href="#csv"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csv\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">master</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csv"</span><span class="op">)</span>,</span>
<span>       sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpSMAWpf\file9558428068b2_surface-flask.csv</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="csvy">csvy<a class="anchor" aria-label="anchor" href="#csvy"></a>
</h3>
<p>CSVY are csv files with a YAML header to include metadata in
tabulated text files</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAdding notes in csvy:\n"</span><span class="op">)</span></span>
<span><span class="va">notes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sector: "</span>, <span class="va">datasetid</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"timespan: "</span>, <span class="va">yy</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"spatial_limits: north = "</span>, <span class="va">north</span>, <span class="st">", south = "</span>, <span class="va">south</span>, <span class="st">", east = "</span>, <span class="va">east</span>, <span class="st">", west = "</span>, <span class="va">west</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"altitude: &lt; "</span>, <span class="va">max_altitude</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"hours: "</span>, <span class="va">evening</span><span class="op">)</span>,</span>
<span>           <span class="st">"local_time: used solar_time"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">notes</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/obs_write_csvy.html">obs_write_csvy</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="va">master</span>,</span>
<span>               notes <span class="op">=</span> <span class="va">notes</span>,</span>
<span>               out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Adding notes in csvy:</span></span>
<span><span class="co">#&gt; sector: surface-insitu</span></span>
<span><span class="co">#&gt; timespan: 2020</span></span>
<span><span class="co">#&gt; spatial_limits: north = 80, south = 10, east = -50, west = -170</span></span>
<span><span class="co">#&gt; data: Data averaged every 20 seconds</span></span>
<span><span class="co">#&gt; altitude: &lt; 8000</span></span>
<span><span class="co">#&gt; hours: 14</span></span>
<span><span class="co">#&gt; local_time: used solar_time</span></span>
<span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpSMAWpf\file9558428068b2_surface-flask.csvy</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/obs_read_csvy.html">obs_read_csvy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "---"                                                              </span></span>
<span><span class="co">#&gt;  [2] "name: Metadata "                                                  </span></span>
<span><span class="co">#&gt;  [3] "sector: surface-flask"                                            </span></span>
<span><span class="co">#&gt;  [4] "timespan: 2020"                                                   </span></span>
<span><span class="co">#&gt;  [5] "spatial_limits: north = 80, south = 10, east = -50, west = -170"  </span></span>
<span><span class="co">#&gt;  [6] "data: Data averaged every 20 seconds"                             </span></span>
<span><span class="co">#&gt;  [7] "altitude: &lt; 8000"                                                 </span></span>
<span><span class="co">#&gt;  [8] "hours: 14"                                                        </span></span>
<span><span class="co">#&gt;  [9] "local_time: used solar_time"                                      </span></span>
<span><span class="co">#&gt; [10] "structure: "                                                      </span></span>
<span><span class="co">#&gt; [11] "Classes 'data.table' and 'data.frame':\t41 obs. of  20 variables:"</span></span>
<span><span class="co">#&gt; [12] " $ timeUTC                  : chr  \"2020-03-10 14:00:00\" \".."  </span></span>
<span><span class="co">#&gt; [13] " $ site_code                : chr  \"BRW\" \"BRW\" ..."           </span></span>
<span><span class="co">#&gt; [14] " $ altitude_final           : num  5 5 5 16.5 5 ..."              </span></span>
<span><span class="co">#&gt; [15] " $ type_altitude            : num  NA NA NA NA NA ..."            </span></span>
<span><span class="co">#&gt; [16] " $ lab_1_abbr               : chr  \"NOAA\" \"NOAA\" ..."         </span></span>
<span><span class="co">#&gt; [17] " $ dataset_calibration_scale: chr  \"WMO CH4 X2004A\" \"WMO \".." </span></span>
<span><span class="co">#&gt; [18] " $ value                    : num  1.98e-06 1.98e-06 ..."         </span></span>
<span><span class="co">#&gt; [19] " $ latitude                 : num  71.3 71.3 ..."                 </span></span>
<span><span class="co">#&gt; [20] " $ longitude                : num  -157 -157 ..."                 </span></span>
<span><span class="co">#&gt; [21] " $ site_utc2lst             : num  -9 -9 -9 -9 -9 ..."            </span></span>
<span><span class="co">#&gt; [22] " $ year                     : int  2020 2020 2020 2020 202.."     </span></span>
<span><span class="co">#&gt; [23] " $ month                    : int  3 4 4 10 10 ..."               </span></span>
<span><span class="co">#&gt; [24] " $ day                      : chr  \"10\" \"01\" ..."             </span></span>
<span><span class="co">#&gt; [25] " $ hour                     : int  14 14 14 14 14 ..."            </span></span>
<span><span class="co">#&gt; [26] " $ minute                   : int  0 0 0 0 0 ..."                 </span></span>
<span><span class="co">#&gt; [27] " $ second                   : int  0 0 0 0 0 ..."                 </span></span>
<span><span class="co">#&gt; [28] " $ time                     : num  1.58e+09 1.59e+09 ..."         </span></span>
<span><span class="co">#&gt; [29] " $ time_decimal             : num  2020 2020 ..."                 </span></span>
<span><span class="co">#&gt; [30] " $ max_altitude             : num  16.5 16.5 16.5 16.5 16..."     </span></span>
<span><span class="co">#&gt; [31] " $ local_time               : chr  NA NA ..."                     </span></span>
<span><span class="co">#&gt; [32] " - attr(*, \".internal.selfref\")=&lt;externalptr&gt; "                 </span></span>
<span><span class="co">#&gt; [33] "NULL"                                                             </span></span>
<span><span class="co">#&gt; [34] "---"</span></span>
<span><span class="co">#&gt;                 timeUTC site_code altitude_final type_altitude lab_1_abbr</span></span>
<span><span class="co">#&gt;                  &lt;POSc&gt;    &lt;char&gt;          &lt;num&gt;        &lt;lgcl&gt;     &lt;char&gt;</span></span>
<span><span class="co">#&gt;  1: 2020-03-10 14:00:00       BRW            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt;  2: 2020-04-01 14:00:00       BRW            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt;  3: 2020-04-14 14:00:00       BRW            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt;  4: 2020-10-02 14:00:00       BRW           16.5            NA       NOAA</span></span>
<span><span class="co">#&gt;  5: 2020-10-02 14:00:00       BRW            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt;  6: 2020-10-05 14:00:00       BRW           16.5            NA       NOAA</span></span>
<span><span class="co">#&gt;  7: 2020-10-30 14:00:00       BRW           16.5            NA       NOAA</span></span>
<span><span class="co">#&gt;  8: 2020-10-30 14:00:00       BRW            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt;  9: 2020-11-10 14:00:00       BRW           16.5            NA       NOAA</span></span>
<span><span class="co">#&gt; 10: 2020-11-10 14:00:00       BRW            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 11: 2020-03-27 14:00:00       KEY            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 12: 2020-04-22 14:00:00       KEY            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 13: 2020-05-28 14:00:00       KEY            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 14: 2020-06-09 14:00:00       KEY            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 15: 2020-06-18 14:00:00       KEY            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 16: 2020-06-25 14:00:00       KEY            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 17: 2020-07-15 14:00:00       KEY            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 18: 2020-12-12 14:00:00       KEY            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 19: 2020-03-25 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 20: 2020-04-09 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 21: 2020-04-23 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 22: 2020-04-27 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 23: 2020-05-18 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 24: 2020-06-15 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 25: 2020-06-22 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 26: 2020-08-05 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 27: 2020-11-02 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 28: 2020-11-12 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 29: 2020-11-27 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 30: 2020-12-22 14:00:00       KUM            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 31: 2020-02-18 14:00:00       NWR            3.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 32: 2020-01-06 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 33: 2020-04-22 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 34: 2020-05-05 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 35: 2020-05-22 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 36: 2020-06-04 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 37: 2020-07-09 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 38: 2020-08-26 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 39: 2020-09-26 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 40: 2020-12-13 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt; 41: 2020-12-31 14:00:00       UTA            5.0            NA       NOAA</span></span>
<span><span class="co">#&gt;                 timeUTC site_code altitude_final type_altitude lab_1_abbr</span></span>
<span><span class="co">#&gt;     dataset_calibration_scale        value latitude longitude site_utc2lst</span></span>
<span><span class="co">#&gt;                        &lt;char&gt;        &lt;num&gt;    &lt;num&gt;     &lt;num&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1:            WMO CH4 X2004A 1.981330e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt;  2:            WMO CH4 X2004A 1.976885e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt;  3:            WMO CH4 X2004A 1.974370e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt;  4:            WMO CH4 X2004A 1.983600e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt;  5:            WMO CH4 X2004A 1.984495e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt;  6:            WMO CH4 X2004A 1.978800e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt;  7:            WMO CH4 X2004A 2.047570e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt;  8:            WMO CH4 X2004A 2.071295e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt;  9:            WMO CH4 X2004A 1.993950e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt; 10:            WMO CH4 X2004A 1.994955e-06  71.3230 -156.6114           -9</span></span>
<span><span class="co">#&gt; 11:            WMO CH4 X2004A 1.944370e-06  25.6654  -80.1580           -5</span></span>
<span><span class="co">#&gt; 12:            WMO CH4 X2004A 2.000845e-06  25.6654  -80.1580           -5</span></span>
<span><span class="co">#&gt; 13:            WMO CH4 X2004A 1.886655e-06  25.6654  -80.1580           -5</span></span>
<span><span class="co">#&gt; 14:            WMO CH4 X2004A 1.895580e-06  25.6654  -80.1580           -5</span></span>
<span><span class="co">#&gt; 15:            WMO CH4 X2004A 1.891915e-06  25.6654  -80.1580           -5</span></span>
<span><span class="co">#&gt; 16:            WMO CH4 X2004A 1.880020e-06  25.6654  -80.1580           -5</span></span>
<span><span class="co">#&gt; 17:            WMO CH4 X2004A 1.918770e-06  25.6654  -80.1580           -5</span></span>
<span><span class="co">#&gt; 18:            WMO CH4 X2004A 1.965620e-06  25.6654  -80.1580           -5</span></span>
<span><span class="co">#&gt; 19:            WMO CH4 X2004A 1.927310e-06  19.5610 -154.8880          -10</span></span>
<span><span class="co">#&gt; 20:            WMO CH4 X2004A 1.895440e-06  19.7333 -155.0500          -10</span></span>
<span><span class="co">#&gt; 21:            WMO CH4 X2004A 1.914920e-06  19.5610 -154.8880          -10</span></span>
<span><span class="co">#&gt; 22:            WMO CH4 X2004A 1.901675e-06  19.5610 -154.8880          -10</span></span>
<span><span class="co">#&gt; 23:            WMO CH4 X2004A 1.908090e-06  19.5608 -154.8880          -10</span></span>
<span><span class="co">#&gt; 24:            WMO CH4 X2004A 1.907615e-06  19.5608 -154.8880          -10</span></span>
<span><span class="co">#&gt; 25:            WMO CH4 X2004A 1.911838e-06  19.5609 -154.8880          -10</span></span>
<span><span class="co">#&gt; 26:            WMO CH4 X2004A 1.888437e-06  19.5608 -154.8880          -10</span></span>
<span><span class="co">#&gt; 27:            WMO CH4 X2004A 1.891255e-06  19.5610 -154.8880          -10</span></span>
<span><span class="co">#&gt; 28:            WMO CH4 X2004A 1.944140e-06  19.5610 -154.8880          -10</span></span>
<span><span class="co">#&gt; 29:            WMO CH4 X2004A 1.939297e-06  19.5609 -154.8880          -10</span></span>
<span><span class="co">#&gt; 30:            WMO CH4 X2004A 1.938703e-06  19.5610 -154.8880          -10</span></span>
<span><span class="co">#&gt; 31:            WMO CH4 X2004A 1.942230e-06  40.0531 -105.5864           -7</span></span>
<span><span class="co">#&gt; 32:            WMO CH4 X2004A 1.945065e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt; 33:            WMO CH4 X2004A 1.938295e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt; 34:            WMO CH4 X2004A 1.936620e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt; 35:            WMO CH4 X2004A 1.941100e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt; 36:            WMO CH4 X2004A 1.895945e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt; 37:            WMO CH4 X2004A 1.932505e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt; 38:            WMO CH4 X2004A 1.906940e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt; 39:            WMO CH4 X2004A 1.939845e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt; 40:            WMO CH4 X2004A 1.969730e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt; 41:            WMO CH4 X2004A 1.971970e-06  39.9018 -113.7181           -7</span></span>
<span><span class="co">#&gt;     dataset_calibration_scale        value latitude longitude site_utc2lst</span></span>
<span><span class="co">#&gt;      year month   day  hour minute second       time time_decimal max_altitude</span></span>
<span><span class="co">#&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;int&gt;        &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:  2020     3    10    14      0      0 1583848800     2020.190         16.5</span></span>
<span><span class="co">#&gt;  2:  2020     4     1    14      0      0 1585749600     2020.250         16.5</span></span>
<span><span class="co">#&gt;  3:  2020     4    14    14      0      0 1586872800     2020.286         16.5</span></span>
<span><span class="co">#&gt;  4:  2020    10     2    14      0      0 1601647200     2020.753         16.5</span></span>
<span><span class="co">#&gt;  5:  2020    10     2    14      0      0 1601647200     2020.753         16.5</span></span>
<span><span class="co">#&gt;  6:  2020    10     5    14      0      0 1601906400     2020.761         16.5</span></span>
<span><span class="co">#&gt;  7:  2020    10    30    14      0      0 1604066400     2020.829         16.5</span></span>
<span><span class="co">#&gt;  8:  2020    10    30    14      0      0 1604066400     2020.829         16.5</span></span>
<span><span class="co">#&gt;  9:  2020    11    10    14      0      0 1605016800     2020.860         16.5</span></span>
<span><span class="co">#&gt; 10:  2020    11    10    14      0      0 1605016800     2020.860         16.5</span></span>
<span><span class="co">#&gt; 11:  2020     3    27    14      0      0 1585317600     2020.237          5.0</span></span>
<span><span class="co">#&gt; 12:  2020     4    22    14      0      0 1587564000     2020.308          5.0</span></span>
<span><span class="co">#&gt; 13:  2020     5    28    14      0      0 1590674400     2020.406          5.0</span></span>
<span><span class="co">#&gt; 14:  2020     6     9    14      0      0 1591711200     2020.439          5.0</span></span>
<span><span class="co">#&gt; 15:  2020     6    18    14      0      0 1592488800     2020.463          5.0</span></span>
<span><span class="co">#&gt; 16:  2020     6    25    14      0      0 1593093600     2020.482          5.0</span></span>
<span><span class="co">#&gt; 17:  2020     7    15    14      0      0 1594821600     2020.537          5.0</span></span>
<span><span class="co">#&gt; 18:  2020    12    12    14      0      0 1607781600     2020.947          5.0</span></span>
<span><span class="co">#&gt; 19:  2020     3    25    14      0      0 1585144800     2020.231          5.0</span></span>
<span><span class="co">#&gt; 20:  2020     4     9    14      0      0 1586440800     2020.272          5.0</span></span>
<span><span class="co">#&gt; 21:  2020     4    23    14      0      0 1587650400     2020.310          5.0</span></span>
<span><span class="co">#&gt; 22:  2020     4    27    14      0      0 1587996000     2020.321          5.0</span></span>
<span><span class="co">#&gt; 23:  2020     5    18    14      0      0 1589810400     2020.379          5.0</span></span>
<span><span class="co">#&gt; 24:  2020     6    15    14      0      0 1592229600     2020.455          5.0</span></span>
<span><span class="co">#&gt; 25:  2020     6    22    14      0      0 1592834400     2020.474          5.0</span></span>
<span><span class="co">#&gt; 26:  2020     8     5    14      0      0 1596636000     2020.594          5.0</span></span>
<span><span class="co">#&gt; 27:  2020    11     2    14      0      0 1604325600     2020.838          5.0</span></span>
<span><span class="co">#&gt; 28:  2020    11    12    14      0      0 1605189600     2020.865          5.0</span></span>
<span><span class="co">#&gt; 29:  2020    11    27    14      0      0 1606485600     2020.906          5.0</span></span>
<span><span class="co">#&gt; 30:  2020    12    22    14      0      0 1608645600     2020.974          5.0</span></span>
<span><span class="co">#&gt; 31:  2020     2    18    14      0      0 1582034400     2020.133          3.0</span></span>
<span><span class="co">#&gt; 32:  2020     1     6    14      0      0 1578319200     2020.015          5.0</span></span>
<span><span class="co">#&gt; 33:  2020     4    22    14      0      0 1587564000     2020.308          5.0</span></span>
<span><span class="co">#&gt; 34:  2020     5     5    14      0      0 1588687200     2020.343          5.0</span></span>
<span><span class="co">#&gt; 35:  2020     5    22    14      0      0 1590156000     2020.390          5.0</span></span>
<span><span class="co">#&gt; 36:  2020     6     4    14      0      0 1591279200     2020.425          5.0</span></span>
<span><span class="co">#&gt; 37:  2020     7     9    14      0      0 1594303200     2020.521          5.0</span></span>
<span><span class="co">#&gt; 38:  2020     8    26    14      0      0 1598450400     2020.652          5.0</span></span>
<span><span class="co">#&gt; 39:  2020     9    26    14      0      0 1601128800     2020.737          5.0</span></span>
<span><span class="co">#&gt; 40:  2020    12    13    14      0      0 1607868000     2020.950          5.0</span></span>
<span><span class="co">#&gt; 41:  2020    12    31    14      0      0 1609423200     2020.999          5.0</span></span>
<span><span class="co">#&gt;      year month   day  hour minute second       time time_decimal max_altitude</span></span>
<span><span class="co">#&gt;     local_time</span></span>
<span><span class="co">#&gt;         &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt;  1:         NA</span></span>
<span><span class="co">#&gt;  2:         NA</span></span>
<span><span class="co">#&gt;  3:         NA</span></span>
<span><span class="co">#&gt;  4:         NA</span></span>
<span><span class="co">#&gt;  5:         NA</span></span>
<span><span class="co">#&gt;  6:         NA</span></span>
<span><span class="co">#&gt;  7:         NA</span></span>
<span><span class="co">#&gt;  8:         NA</span></span>
<span><span class="co">#&gt;  9:         NA</span></span>
<span><span class="co">#&gt; 10:         NA</span></span>
<span><span class="co">#&gt; 11:         NA</span></span>
<span><span class="co">#&gt; 12:         NA</span></span>
<span><span class="co">#&gt; 13:         NA</span></span>
<span><span class="co">#&gt; 14:         NA</span></span>
<span><span class="co">#&gt; 15:         NA</span></span>
<span><span class="co">#&gt; 16:         NA</span></span>
<span><span class="co">#&gt; 17:         NA</span></span>
<span><span class="co">#&gt; 18:         NA</span></span>
<span><span class="co">#&gt; 19:         NA</span></span>
<span><span class="co">#&gt; 20:         NA</span></span>
<span><span class="co">#&gt; 21:         NA</span></span>
<span><span class="co">#&gt; 22:         NA</span></span>
<span><span class="co">#&gt; 23:         NA</span></span>
<span><span class="co">#&gt; 24:         NA</span></span>
<span><span class="co">#&gt; 25:         NA</span></span>
<span><span class="co">#&gt; 26:         NA</span></span>
<span><span class="co">#&gt; 27:         NA</span></span>
<span><span class="co">#&gt; 28:         NA</span></span>
<span><span class="co">#&gt; 29:         NA</span></span>
<span><span class="co">#&gt; 30:         NA</span></span>
<span><span class="co">#&gt; 31:         NA</span></span>
<span><span class="co">#&gt; 32:         NA</span></span>
<span><span class="co">#&gt; 33:         NA</span></span>
<span><span class="co">#&gt; 34:         NA</span></span>
<span><span class="co">#&gt; 35:         NA</span></span>
<span><span class="co">#&gt; 36:         NA</span></span>
<span><span class="co">#&gt; 37:         NA</span></span>
<span><span class="co">#&gt; 38:         NA</span></span>
<span><span class="co">#&gt; 39:         NA</span></span>
<span><span class="co">#&gt; 40:         NA</span></span>
<span><span class="co">#&gt; 41:         NA</span></span>
<span><span class="co">#&gt;     local_time</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="receptors">Receptors<a class="anchor" aria-label="anchor" href="#receptors"></a>
</h2>
<p>Now we can do the last step which is generating the receptor list
files. Now we filter selected columns</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span> <span class="op">&lt;-</span> <span class="va">master</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site_code"</span>,</span>
<span>                     <span class="st">"year"</span>,</span>
<span>                     <span class="st">"month"</span>,</span>
<span>                     <span class="st">"day"</span>,</span>
<span>                     <span class="st">"hour"</span>,</span>
<span>                     <span class="st">"minute"</span>,</span>
<span>                     <span class="st">"second"</span>,</span>
<span>                     <span class="st">"latitude"</span>,</span>
<span>                     <span class="st">"longitude"</span>,</span>
<span>                     <span class="st">"altitude_final"</span>,</span>
<span>                     <span class="st">"type_altitude"</span>,</span>
<span>                     <span class="st">"time_decimal"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We can round altitude also</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span><span class="op">$</span><span class="va">altitude_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">receptor</span><span class="op">$</span><span class="va">altitude_final</span><span class="op">)</span></span></code></pre></div>
<p>Now we can format time variables with two digits</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_format.html">obs_format</a></span><span class="op">(</span><span class="va">receptor</span>,</span>
<span>                        spf <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"month"</span>, <span class="st">"day"</span>,</span>
<span>                                 <span class="st">"hour"</span>, <span class="st">"minute"</span>, <span class="st">"second"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We have a column that indicate AGL or ASL</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor_agl</span> <span class="op">&lt;-</span> <span class="va">receptor</span><span class="op">[</span><span class="va">type_altitude</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="va">receptor_asl</span> <span class="op">&lt;-</span> <span class="va">receptor</span><span class="op">[</span><span class="va">type_altitude</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>Finally, we save the receptors</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">receptor_agl</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_AGL.txt"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receptor_agl</span>,</span>
<span>         file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_AGL.txt"</span><span class="op">)</span>,</span>
<span>         sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">receptor_asl</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_ASL.txt"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receptor_asl</span>,</span>
<span>         file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"receptor_ASL.txt"</span><span class="op">)</span>,</span>
<span>         sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot">Plot<a class="anchor" aria-label="anchor" href="#plot"></a>
</h2>
<p>Finally, we just plot some data, run it locally</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/obs_plot.html">obs_plot</a></span><span class="op">(</span><span class="va">df4</span>, time <span class="op">=</span> <span class="st">"timeUTC"</span>, yfactor <span class="op">=</span> <span class="fl">1e9</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Found the following sites: </span></span>
<span><span class="co">#&gt;  [1] ABT   BCK   BRA   BRW   CARL  CBY   CHL   CPS   EGB   ESP   EST   ETL  </span></span>
<span><span class="co">#&gt; [13] FNE   FORT  FSD   GHG06 GHG09 HNP   HOBB  INU   INX01 INX02 INX07 INX08</span></span>
<span><span class="co">#&gt; [25] INX09 INX10 INX13 INX14 LLB   MALJ  MLO   OLI   SGP   THD   TPD   WSA  </span></span>
<span><span class="co">#&gt; Plotting the following sites: </span></span>
<span><span class="co">#&gt; [1] ABT BCK</span></span></code></pre>
<div class="float">
<img src="https://github.com/noaa-gml/rtorf/blob/main/man/figures/obsplot_surfaceinsitu.png?raw=true" alt="Time series"><div class="figcaption">Time series</div>
</div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">dx</span> <span class="op">&lt;-</span> <span class="va">df4</span><span class="op">[</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>    .SDcols <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">latitude</span>, <span class="va">longitude</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">dx</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"value"</span><span class="op">]</span>, axes <span class="op">=</span> <span class="cn">T</span>, reset <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu">map</span><span class="op">(</span>add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="https://github.com/noaa-gml/rtorf/blob/main/man/figures/obsplot_surfaceinsitu_map.png?raw=true" alt="Map"><div class="figcaption">Map</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sergio Ibarra-Espinosa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
