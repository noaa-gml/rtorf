<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>aircraft-insitu • rtorf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="aircraft-insitu">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtorf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/aircore.html">aircore</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-flask.html">aircraft-flask</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-insitu.html">aircraft-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-pfp.html">aircraft-pfp</a></li>
    <li><a class="dropdown-item" href="../articles/hysplit.html">hysplit</a></li>
    <li><a class="dropdown-item" href="../articles/shipboard-flask.html">shipboard-flask</a></li>
    <li><a class="dropdown-item" href="../articles/shipoboard-insitu.html">shipboard-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/summary.html">summary</a></li>
    <li><a class="dropdown-item" href="../articles/surface-flask.html">surface-flask</a></li>
    <li><a class="dropdown-item" href="../articles/surface-insitu.html">surface-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/surface-pfp.html">surface-pfp</a></li>
    <li><a class="dropdown-item" href="../articles/tower-insitu.html">tower-insitu</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/noaa-gml/rtorf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>aircraft-insitu</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/noaa-gml/rtorf/blob/main/vignettes/aircraft-insitu.Rmd" class="external-link"><code>vignettes/aircraft-insitu.Rmd</code></a></small>
      <div class="d-none name"><code>aircraft-insitu.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/noaa-gml/rtorf" class="external-link">rtorf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aircraft-pfp"</span>,</span>
<span>         <span class="st">"aircraft-insitu"</span>,</span>
<span>         <span class="st">"aircraft-flask"</span>,</span>
<span>         <span class="st">"surface-insitu"</span>,</span>
<span>         <span class="st">"surface-flask"</span>, </span>
<span>         <span class="st">"surface-pfp"</span>,   </span>
<span>         <span class="st">"tower-insitu"</span>,  </span>
<span>         <span class="st">"aircore"</span>,       </span>
<span>         <span class="st">"shipboard-insitu"</span>,</span>
<span>         <span class="st">"shipboard-flask"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="st">"Z:/obspack/obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08/data/nc/"</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_summary.html">obs_summary</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>                     categories <span class="op">=</span> <span class="va">cate</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Number of files of index: 479</span></span>
<span><span class="co">#&gt;               sector     N</span></span>
<span><span class="co">#&gt;               &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1:     aircraft-pfp    42</span></span>
<span><span class="co">#&gt;  2:  aircraft-insitu    17</span></span>
<span><span class="co">#&gt;  3:    surface-flask   106</span></span>
<span><span class="co">#&gt;  4:   surface-insitu   121</span></span>
<span><span class="co">#&gt;  5:   aircraft-flask     4</span></span>
<span><span class="co">#&gt;  6:          aircore     1</span></span>
<span><span class="co">#&gt;  7:      surface-pfp    33</span></span>
<span><span class="co">#&gt;  8:     tower-insitu   150</span></span>
<span><span class="co">#&gt;  9:  shipboard-flask     4</span></span>
<span><span class="co">#&gt; 10: shipboard-insitu     1</span></span>
<span><span class="co">#&gt; 11:    Total sectors   479</span></span>
<span><span class="co">#&gt; Detected 203 files with agl</span></span>
<span><span class="co">#&gt; Detected 276 files without agl</span></span></code></pre>
<p>Now we read the <code>aircraft-insitu</code> using the function
<code>obs_read_nc</code>. To this date, <code>solar_time</code> is not
included for aircraft, so we <code>FALSE</code> that argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datasetid</span> <span class="op">&lt;-</span> <span class="st">"aircraft-insitu"</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_read_nc.html">obs_read_nc</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">index</span>,</span>
<span>                  categories <span class="op">=</span> <span class="va">datasetid</span>,</span>
<span>                  solar_time <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Searching aircraft-insitu...</span></span>
<span><span class="co">#&gt; 1: ch4_above_aircraft-insitu_1_allvalid.nc</span></span>
<span><span class="co">#&gt; 2: ch4_act_aircraft-insitu_428_allvalid-b200.nc</span></span>
<span><span class="co">#&gt; 3: ch4_act_aircraft-insitu_428_allvalid-c130.nc</span></span>
<span><span class="co">#&gt; 4: ch4_ajax_aircraft-insitu_429_allvalid.nc</span></span>
<span><span class="co">#&gt; 5: ch4_cob2003b_aircraft-insitu_59_allvalid.nc</span></span>
<span><span class="co">#&gt; 6: ch4_eco_aircraft-insitu_1_allvalid.nc</span></span>
<span><span class="co">#&gt; 7: ch4_hip_aircraft-insitu_59_allvalid.nc</span></span>
<span><span class="co">#&gt; 8: ch4_iagos-caribic_aircraft-insitu_457_allvalid.nc</span></span>
<span><span class="co">#&gt; 9: ch4_iagos-core_aircraft-insitu_45_allvalid.nc</span></span>
<span><span class="co">#&gt; 10: ch4_korus-aq_aircraft-insitu_428_allvalid-dc8.nc</span></span>
<span><span class="co">#&gt; 11: ch4_man_aircraft-insitu_1_allvalid.nc</span></span>
<span><span class="co">#&gt; 12: ch4_orc_aircraft-insitu_3_allvalid-merge10.nc</span></span>
<span><span class="co">#&gt; 13: ch4_seac4rs_aircraft-insitu_428_allvalid-ER2.nc</span></span>
<span><span class="co">#&gt; 14: ch4_seac4rs_aircraft-insitu_428_allvalid-dc8.nc</span></span>
<span><span class="co">#&gt; 15: ch4_start08_aircraft-insitu_59_allvalid.nc</span></span>
<span><span class="co">#&gt; 16: ch4_tom_aircraft-insitu_1_allvalid.nc</span></span>
<span><span class="co">#&gt; 17: ch4_ugd_aircraft-insitu_1_allvalid.nc</span></span></code></pre>
<p>Now we check the data</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;           year month   day  hour minute second       time start_time</span></span>
<span><span class="co">#&gt;          &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt;       1:  2017     4    26    15     32     10 1493220730 1493220730</span></span>
<span><span class="co">#&gt;       2:  2017     4    26    15     32     20 1493220740 1493220740</span></span>
<span><span class="co">#&gt;       3:  2017     4    26    15     32     30 1493220750 1493220750</span></span>
<span><span class="co">#&gt;       4:  2017     4    26    15     32     40 1493220760 1493220760</span></span>
<span><span class="co">#&gt;       5:  2017     4    26    15     32     50 1493220770 1493220770</span></span>
<span><span class="co">#&gt;      ---                                                            </span></span>
<span><span class="co">#&gt; 3158219:  2021    12    10    11     37     45 1639136265 1639136260</span></span>
<span><span class="co">#&gt; 3158220:  2021    12    10    11     37     55 1639136275 1639136270</span></span>
<span><span class="co">#&gt; 3158221:  2021    12    10    11     38      5 1639136285 1639136280</span></span>
<span><span class="co">#&gt; 3158222:  2021    12    10    11     38     15 1639136295 1639136290</span></span>
<span><span class="co">#&gt; 3158223:  2021    12    10    11     38     25 1639136305 1639136300</span></span>
<span><span class="co">#&gt;          midpoint_time             datetime time_decimal       value value_unc</span></span>
<span><span class="co">#&gt;                  &lt;int&gt;               &lt;char&gt;        &lt;num&gt;       &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:    1493220730 2017-04-26T15:32:10Z     2017.317 1.96430e-06     5e-10</span></span>
<span><span class="co">#&gt;       2:    1493220740 2017-04-26T15:32:20Z     2017.317 1.96176e-06     5e-10</span></span>
<span><span class="co">#&gt;       3:    1493220750 2017-04-26T15:32:30Z     2017.317 1.96173e-06     5e-10</span></span>
<span><span class="co">#&gt;       4:    1493220760 2017-04-26T15:32:40Z     2017.317 1.96131e-06     5e-10</span></span>
<span><span class="co">#&gt;       5:    1493220770 2017-04-26T15:32:50Z     2017.317 1.96199e-06     5e-10</span></span>
<span><span class="co">#&gt;      ---                                                                      </span></span>
<span><span class="co">#&gt; 3158219:    1639136265 2021-12-10T11:37:45Z     2021.941 1.97308e-06     1e-09</span></span>
<span><span class="co">#&gt; 3158220:    1639136275 2021-12-10T11:37:55Z     2021.941 1.97495e-06     1e-09</span></span>
<span><span class="co">#&gt; 3158221:    1639136285 2021-12-10T11:38:05Z     2021.941 1.97649e-06     1e-09</span></span>
<span><span class="co">#&gt; 3158222:    1639136295 2021-12-10T11:38:15Z     2021.941 1.98205e-06     1e-09</span></span>
<span><span class="co">#&gt; 3158223:    1639136305 2021-12-10T11:38:25Z     2021.941 1.97504e-06     1e-09</span></span>
<span><span class="co">#&gt;          nvalue value_std_dev latitude longitude altitude pressure     u     v</span></span>
<span><span class="co">#&gt;           &lt;int&gt;         &lt;num&gt;    &lt;num&gt;     &lt;num&gt;    &lt;num&gt;    &lt;num&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:      4      1.23e-09  40.0391 -105.2320  1617.03   836.39 -2.39  0.16</span></span>
<span><span class="co">#&gt;       2:      5      3.10e-10  40.0391 -105.2290  1617.04   836.78 -1.45  0.33</span></span>
<span><span class="co">#&gt;       3:      5      4.30e-10  40.0391 -105.2240  1617.03   836.79 -1.40  0.94</span></span>
<span><span class="co">#&gt;       4:      4      2.40e-10  40.0391 -105.2190  1630.93   835.28 -3.37  1.82</span></span>
<span><span class="co">#&gt;       5:      5      1.16e-09  40.0389 -105.2120  1650.95   832.78 -2.25  2.68</span></span>
<span><span class="co">#&gt;      ---                                                                      </span></span>
<span><span class="co">#&gt; 3158219:      3      2.96e-09   0.2176   32.5360  1239.50   865.98    NA    NA</span></span>
<span><span class="co">#&gt; 3158220:      3      1.46e-09   0.2142   32.5387  1213.20   867.65    NA    NA</span></span>
<span><span class="co">#&gt; 3158221:      4      3.31e-09   0.2109   32.5413  1199.20   869.33    NA    NA</span></span>
<span><span class="co">#&gt; 3158222:      3      4.50e-09   0.2076   32.5440  1181.10   871.76    NA    NA</span></span>
<span><span class="co">#&gt; 3158223:      4      1.62e-09   0.2044   32.5466  1163.50   873.92    NA    NA</span></span>
<span><span class="co">#&gt;          temperature profile_id      flight_id obs_flag obspack_num</span></span>
<span><span class="co">#&gt;                &lt;num&gt;     &lt;char&gt;         &lt;char&gt;    &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;       1:      282.02          0       20170426        1    11109646</span></span>
<span><span class="co">#&gt;       2:      281.79          0       20170426        1    11109647</span></span>
<span><span class="co">#&gt;       3:      281.34          0       20170426        1    11109648</span></span>
<span><span class="co">#&gt;       4:      280.92          1       20170426        1    11109649</span></span>
<span><span class="co">#&gt;       5:      280.43          1       20170426        1    11109650</span></span>
<span><span class="co">#&gt;      ---                                                           </span></span>
<span><span class="co">#&gt; 3158219:      296.70         12 20211210_27100        1     2042566</span></span>
<span><span class="co">#&gt; 3158220:      296.90         12 20211210_27100        1     2042567</span></span>
<span><span class="co">#&gt; 3158221:      297.00         12 20211210_27100        1     2042568</span></span>
<span><span class="co">#&gt; 3158222:      297.20         12 20211210_27100        1     2042569</span></span>
<span><span class="co">#&gt; 3158223:      297.40         12 20211210_27100        1     2042570</span></span>
<span><span class="co">#&gt;                                                                                          obspack_id</span></span>
<span><span class="co">#&gt;                                                                                              &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1: obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_above_aircraft-insitu_1_allvalid~11109646</span></span>
<span><span class="co">#&gt;       2: obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_above_aircraft-insitu_1_allvalid~11109647</span></span>
<span><span class="co">#&gt;       3: obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_above_aircraft-insitu_1_allvalid~11109648</span></span>
<span><span class="co">#&gt;       4: obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_above_aircraft-insitu_1_allvalid~11109649</span></span>
<span><span class="co">#&gt;       5: obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_above_aircraft-insitu_1_allvalid~11109650</span></span>
<span><span class="co">#&gt;      ---                                                                                           </span></span>
<span><span class="co">#&gt; 3158219:    obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_ugd_aircraft-insitu_1_allvalid~2042566</span></span>
<span><span class="co">#&gt; 3158220:    obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_ugd_aircraft-insitu_1_allvalid~2042567</span></span>
<span><span class="co">#&gt; 3158221:    obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_ugd_aircraft-insitu_1_allvalid~2042568</span></span>
<span><span class="co">#&gt; 3158222:    obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_ugd_aircraft-insitu_1_allvalid~2042569</span></span>
<span><span class="co">#&gt; 3158223:    obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01~ch4_ugd_aircraft-insitu_1_allvalid~2042570</span></span>
<span><span class="co">#&gt;          unique_sample_location_num          scale dataset_project</span></span>
<span><span class="co">#&gt;                               &lt;int&gt;         &lt;char&gt;          &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1:                   33175520 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt;       2:                   33175521 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt;       3:                   33175522 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt;       4:                   33175523 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt;       5:                   33175519 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt;      ---                                                          </span></span>
<span><span class="co">#&gt; 3158219:                   51772833 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt; 3158220:                   51772776 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt; 3158221:                   51772721 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt; 3158222:                   51772671 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt; 3158223:                   51772623 WMO CH4 X2004A aircraft-insitu</span></span>
<span><span class="co">#&gt;          dataset_selection_tag</span></span>
<span><span class="co">#&gt;                         &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1:              allvalid</span></span>
<span><span class="co">#&gt;       2:              allvalid</span></span>
<span><span class="co">#&gt;       3:              allvalid</span></span>
<span><span class="co">#&gt;       4:              allvalid</span></span>
<span><span class="co">#&gt;       5:              allvalid</span></span>
<span><span class="co">#&gt;      ---                      </span></span>
<span><span class="co">#&gt; 3158219:              allvalid</span></span>
<span><span class="co">#&gt; 3158220:              allvalid</span></span>
<span><span class="co">#&gt; 3158221:              allvalid</span></span>
<span><span class="co">#&gt; 3158222:              allvalid</span></span>
<span><span class="co">#&gt; 3158223:              allvalid</span></span>
<span><span class="co">#&gt;                                                             site_name</span></span>
<span><span class="co">#&gt;                                                                &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1: Carbon in Arctic Reservoirs Vulnerability Experiment (CARVE)</span></span>
<span><span class="co">#&gt;       2: Carbon in Arctic Reservoirs Vulnerability Experiment (CARVE)</span></span>
<span><span class="co">#&gt;       3: Carbon in Arctic Reservoirs Vulnerability Experiment (CARVE)</span></span>
<span><span class="co">#&gt;       4: Carbon in Arctic Reservoirs Vulnerability Experiment (CARVE)</span></span>
<span><span class="co">#&gt;       5: Carbon in Arctic Reservoirs Vulnerability Experiment (CARVE)</span></span>
<span><span class="co">#&gt;      ---                                                             </span></span>
<span><span class="co">#&gt; 3158219:                           Kajjansi Airfield, Kampala, Uganda</span></span>
<span><span class="co">#&gt; 3158220:                           Kajjansi Airfield, Kampala, Uganda</span></span>
<span><span class="co">#&gt; 3158221:                           Kajjansi Airfield, Kampala, Uganda</span></span>
<span><span class="co">#&gt; 3158222:                           Kajjansi Airfield, Kampala, Uganda</span></span>
<span><span class="co">#&gt; 3158223:                           Kajjansi Airfield, Kampala, Uganda</span></span>
<span><span class="co">#&gt;          site_elevation site_latitude site_longitude  site_country site_code</span></span>
<span><span class="co">#&gt;                   &lt;num&gt;         &lt;num&gt;          &lt;num&gt;        &lt;char&gt;    &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1:     -1.000e+34        -1e+34     -1.000e+34 United States       CRV</span></span>
<span><span class="co">#&gt;       2:     -1.000e+34        -1e+34     -1.000e+34 United States       CRV</span></span>
<span><span class="co">#&gt;       3:     -1.000e+34        -1e+34     -1.000e+34 United States       CRV</span></span>
<span><span class="co">#&gt;       4:     -1.000e+34        -1e+34     -1.000e+34 United States       CRV</span></span>
<span><span class="co">#&gt;       5:     -1.000e+34        -1e+34     -1.000e+34 United States       CRV</span></span>
<span><span class="co">#&gt;      ---                                                                    </span></span>
<span><span class="co">#&gt; 3158219:      1.141e+03         2e-01      3.255e+01        Uganda       UGD</span></span>
<span><span class="co">#&gt; 3158220:      1.141e+03         2e-01      3.255e+01        Uganda       UGD</span></span>
<span><span class="co">#&gt; 3158221:      1.141e+03         2e-01      3.255e+01        Uganda       UGD</span></span>
<span><span class="co">#&gt; 3158222:      1.141e+03         2e-01      3.255e+01        Uganda       UGD</span></span>
<span><span class="co">#&gt; 3158223:      1.141e+03         2e-01      3.255e+01        Uganda       UGD</span></span>
<span><span class="co">#&gt;          site_utc2lst lab_1_abbr dataset_calibration_scale altitude_final</span></span>
<span><span class="co">#&gt;                 &lt;num&gt;     &lt;char&gt;                    &lt;char&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:           -8       NOAA            WMO CH4 X2004A        1617.03</span></span>
<span><span class="co">#&gt;       2:           -8       NOAA            WMO CH4 X2004A        1617.04</span></span>
<span><span class="co">#&gt;       3:           -8       NOAA            WMO CH4 X2004A        1617.03</span></span>
<span><span class="co">#&gt;       4:           -8       NOAA            WMO CH4 X2004A        1630.93</span></span>
<span><span class="co">#&gt;       5:           -8       NOAA            WMO CH4 X2004A        1650.95</span></span>
<span><span class="co">#&gt;      ---                                                                 </span></span>
<span><span class="co">#&gt; 3158219:            3       NOAA            WMO CH4 X2004A        1239.50</span></span>
<span><span class="co">#&gt; 3158220:            3       NOAA            WMO CH4 X2004A        1213.20</span></span>
<span><span class="co">#&gt; 3158221:            3       NOAA            WMO CH4 X2004A        1199.20</span></span>
<span><span class="co">#&gt; 3158222:            3       NOAA            WMO CH4 X2004A        1181.10</span></span>
<span><span class="co">#&gt; 3158223:            3       NOAA            WMO CH4 X2004A        1163.50</span></span>
<span><span class="co">#&gt;          type_altitude air_flag bl_bt_flag elevation event_number flight_flag</span></span>
<span><span class="co">#&gt;                  &lt;num&gt;    &lt;int&gt;      &lt;int&gt;     &lt;num&gt;       &lt;char&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;       1:             1       NA         NA        NA         &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;       2:             1       NA         NA        NA         &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;       3:             1       NA         NA        NA         &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;       4:             1       NA         NA        NA         &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;       5:             1       NA         NA        NA         &lt;NA&gt;          NA</span></span>
<span><span class="co">#&gt;      ---                                                                     </span></span>
<span><span class="co">#&gt; 3158219:             1       NA         NA      1138       251934          NA</span></span>
<span><span class="co">#&gt; 3158220:             1       NA         NA      1141       251935          NA</span></span>
<span><span class="co">#&gt; 3158221:             1       NA         NA      1143       251936          NA</span></span>
<span><span class="co">#&gt; 3158222:             1       NA         NA      1140       251937          NA</span></span>
<span><span class="co">#&gt; 3158223:             1       NA         NA      1138       251938          NA</span></span>
<span><span class="co">#&gt;          gps_altitude   h2o         instrument intake_height maneuver_flag</span></span>
<span><span class="co">#&gt;                 &lt;num&gt; &lt;num&gt;             &lt;char&gt;         &lt;num&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt;       1:           NA    NA               &lt;NA&gt;            NA            NA</span></span>
<span><span class="co">#&gt;       2:           NA    NA               &lt;NA&gt;            NA            NA</span></span>
<span><span class="co">#&gt;       3:           NA    NA               &lt;NA&gt;            NA            NA</span></span>
<span><span class="co">#&gt;       4:           NA    NA               &lt;NA&gt;            NA            NA</span></span>
<span><span class="co">#&gt;       5:           NA    NA               &lt;NA&gt;            NA            NA</span></span>
<span><span class="co">#&gt;      ---                                                                  </span></span>
<span><span class="co">#&gt; 3158219:           NA    NA Picarro_CFKBDS2302         101.5            NA</span></span>
<span><span class="co">#&gt; 3158220:           NA    NA Picarro_CFKBDS2302          72.2            NA</span></span>
<span><span class="co">#&gt; 3158221:           NA    NA Picarro_CFKBDS2302          56.2            NA</span></span>
<span><span class="co">#&gt; 3158222:           NA    NA Picarro_CFKBDS2302          41.1            NA</span></span>
<span><span class="co">#&gt; 3158223:           NA    NA Picarro_CFKBDS2302          25.5            NA</span></span>
<span><span class="co">#&gt;          maneuver_flagqc pressure_altitude qcflag    rh site_elevation_unit</span></span>
<span><span class="co">#&gt;                    &lt;int&gt;             &lt;num&gt; &lt;char&gt; &lt;num&gt;              &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1:              NA                NA   &lt;NA&gt;    NA                &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       2:              NA                NA   &lt;NA&gt;    NA                &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       3:              NA                NA   &lt;NA&gt;    NA                &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       4:              NA                NA   &lt;NA&gt;    NA                &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       5:              NA                NA   &lt;NA&gt;    NA                &lt;NA&gt;</span></span>
<span><span class="co">#&gt;      ---                                                                   </span></span>
<span><span class="co">#&gt; 3158219:              NA                NA    ..P  79.9                masl</span></span>
<span><span class="co">#&gt; 3158220:              NA                NA    ..P  79.8                masl</span></span>
<span><span class="co">#&gt; 3158221:              NA                NA    ..P  78.3                masl</span></span>
<span><span class="co">#&gt; 3158222:              NA                NA    ..P  78.9                masl</span></span>
<span><span class="co">#&gt; 3158223:              NA                NA    ..P  78.6                masl</span></span>
<span><span class="co">#&gt;                                                                   source_id</span></span>
<span><span class="co">#&gt;                                                                      &lt;char&gt;</span></span>
<span><span class="co">#&gt;       1:                                                               &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       2:                                                               &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       3:                                                               &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       4:                                                               &lt;NA&gt;</span></span>
<span><span class="co">#&gt;       5:                                                               &lt;NA&gt;</span></span>
<span><span class="co">#&gt;      ---                                                                   </span></span>
<span><span class="co">#&gt; 3158219: KampalaExecutiveAviation_CessnaCaravan208B_5XKEB~20211210_27100~12</span></span>
<span><span class="co">#&gt; 3158220: KampalaExecutiveAviation_CessnaCaravan208B_5XKEB~20211210_27100~12</span></span>
<span><span class="co">#&gt; 3158221: KampalaExecutiveAviation_CessnaCaravan208B_5XKEB~20211210_27100~12</span></span>
<span><span class="co">#&gt; 3158222: KampalaExecutiveAviation_CessnaCaravan208B_5XKEB~20211210_27100~12</span></span>
<span><span class="co">#&gt; 3158223: KampalaExecutiveAviation_CessnaCaravan208B_5XKEB~20211210_27100~12</span></span>
<span><span class="co">#&gt;          time_interval value_original_scale</span></span>
<span><span class="co">#&gt;                  &lt;int&gt;                &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:            NA                   NA</span></span>
<span><span class="co">#&gt;       2:            NA                   NA</span></span>
<span><span class="co">#&gt;       3:            NA                   NA</span></span>
<span><span class="co">#&gt;       4:            NA                   NA</span></span>
<span><span class="co">#&gt;       5:            NA                   NA</span></span>
<span><span class="co">#&gt;      ---                                   </span></span>
<span><span class="co">#&gt; 3158219:            NA                   NA</span></span>
<span><span class="co">#&gt; 3158220:            NA                   NA</span></span>
<span><span class="co">#&gt; 3158221:            NA                   NA</span></span>
<span><span class="co">#&gt; 3158222:            NA                   NA</span></span>
<span><span class="co">#&gt; 3158223:            NA                   NA</span></span></code></pre>
<p>Now we can process the data. We first filter for observations within
our spatial domain:</p>
<div class="section level2">
<h2 id="checks-and-definitions">Checks and definitions<a class="anchor" aria-label="anchor" href="#checks-and-definitions"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">north</span> <span class="op">&lt;-</span> <span class="fl">80</span></span>
<span><span class="va">south</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">west</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">170</span></span>
<span><span class="va">east</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">50</span></span>
<span><span class="va">max_altitude</span> <span class="op">&lt;-</span> <span class="fl">8000</span></span>
<span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="fl">2020</span></span></code></pre></div>
<p>We check altitude, intake_height, altitude_final and elevation.
altitude_final is a column from intake_height, added to match column
from obs_read text files.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"altitude"</span>, <span class="st">"altitude_final"</span>, <span class="st">"intake_height"</span>, <span class="st">"elevation"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;          altitude altitude_final intake_height elevation</span></span>
<span><span class="co">#&gt;             &lt;num&gt;          &lt;num&gt;         &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;       1:  1617.03        1617.03            NA        NA</span></span>
<span><span class="co">#&gt;       2:  1617.04        1617.04            NA        NA</span></span>
<span><span class="co">#&gt;       3:  1617.03        1617.03            NA        NA</span></span>
<span><span class="co">#&gt;       4:  1630.93        1630.93            NA        NA</span></span>
<span><span class="co">#&gt;       5:  1650.95        1650.95            NA        NA</span></span>
<span><span class="co">#&gt;      ---                                                </span></span>
<span><span class="co">#&gt; 3158219:  1239.50        1239.50         101.5      1138</span></span>
<span><span class="co">#&gt; 3158220:  1213.20        1213.20          72.2      1141</span></span>
<span><span class="co">#&gt; 3158221:  1199.20        1199.20          56.2      1143</span></span>
<span><span class="co">#&gt; 3158222:  1181.10        1181.10          41.1      1140</span></span>
<span><span class="co">#&gt; 3158223:  1163.50        1163.50          25.5      1138</span></span></code></pre>
<p>The temporal range of data is</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 2003 2021</span></span></code></pre>
<p>We also check for dimensions of data</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 2041758      59</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="filters">Filters<a class="anchor" aria-label="anchor" href="#filters"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="va">yy</span><span class="op">]</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">altitude_final</span> <span class="op">&lt;</span> <span class="va">max_altitude</span> <span class="op">&amp;</span></span>
<span>           <span class="va">latitude</span> <span class="op">&lt;</span> <span class="va">north</span> <span class="op">&amp;</span></span>
<span>           <span class="va">latitude</span> <span class="op">&gt;</span> <span class="va">south</span> <span class="op">&amp;</span></span>
<span>           <span class="va">longitude</span> <span class="op">&lt;</span> <span class="va">east</span> <span class="op">&amp;</span></span>
<span>           <span class="va">longitude</span> <span class="op">&gt;</span> <span class="va">west</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 236  59</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="adding-time-as-posixct-class">Adding time as POSIXct class<a class="anchor" aria-label="anchor" href="#adding-time-as-posixct-class"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_addtime.html">obs_addtime</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"timeUTC"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                  timeUTC</span></span>
<span><span class="co">#&gt;                   &lt;POSc&gt;</span></span>
<span><span class="co">#&gt;   1: 2020-01-08 22:59:55</span></span>
<span><span class="co">#&gt;   2: 2020-01-08 23:00:05</span></span>
<span><span class="co">#&gt;   3: 2020-01-08 23:00:15</span></span>
<span><span class="co">#&gt;   4: 2020-01-08 23:00:25</span></span>
<span><span class="co">#&gt;   5: 2020-01-08 23:00:35</span></span>
<span><span class="co">#&gt;  ---                    </span></span>
<span><span class="co">#&gt; 232: 2020-03-02 22:56:15</span></span>
<span><span class="co">#&gt; 233: 2020-03-02 22:56:25</span></span>
<span><span class="co">#&gt; 234: 2020-03-02 22:56:35</span></span>
<span><span class="co">#&gt; 235: 2020-03-02 22:56:45</span></span>
<span><span class="co">#&gt; 236: 2020-03-02 22:56:55</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="cut-time">Cut time<a class="anchor" aria-label="anchor" href="#cut-time"></a>
</h2>
<p>now we can cut time every 20 seconds. We can chosse other frequency
as well.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">sec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_freq.html">obs_freq</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">second</span>,</span>
<span>                     freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"second"</span>, <span class="st">"sec2"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;      second  sec2</span></span>
<span><span class="co">#&gt;       &lt;int&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:     55    40</span></span>
<span><span class="co">#&gt;   2:      5     0</span></span>
<span><span class="co">#&gt;   3:     15     0</span></span>
<span><span class="co">#&gt;   4:     25    20</span></span>
<span><span class="co">#&gt;   5:     35    20</span></span>
<span><span class="co">#&gt;  ---             </span></span>
<span><span class="co">#&gt; 232:     15     0</span></span>
<span><span class="co">#&gt; 233:     25    20</span></span>
<span><span class="co">#&gt; 234:     35    20</span></span>
<span><span class="co">#&gt; 235:     45    40</span></span>
<span><span class="co">#&gt; 236:     55    40</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="aggregate-data">Aggregate data<a class="anchor" aria-label="anchor" href="#aggregate-data"></a>
</h2>
<p>now we need to add the column key_time, that it will be used to
aggregate other variables</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">key_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html" class="external-link">ISOdatetime</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span>,</span>
<span>                           month <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">month</span>,</span>
<span>                           day <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">day</span>,</span>
<span>                           hour <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">hour</span>,</span>
<span>                           min <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">minute</span>,</span>
<span>                           sec <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">sec2</span>,</span>
<span>                           tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"timeUTC"</span>, <span class="st">"key_time"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                  timeUTC            key_time</span></span>
<span><span class="co">#&gt;                   &lt;POSc&gt;              &lt;POSc&gt;</span></span>
<span><span class="co">#&gt;   1: 2020-01-08 22:59:55 2020-01-08 22:59:40</span></span>
<span><span class="co">#&gt;   2: 2020-01-08 23:00:05 2020-01-08 23:00:00</span></span>
<span><span class="co">#&gt;   3: 2020-01-08 23:00:15 2020-01-08 23:00:00</span></span>
<span><span class="co">#&gt;   4: 2020-01-08 23:00:25 2020-01-08 23:00:20</span></span>
<span><span class="co">#&gt;   5: 2020-01-08 23:00:35 2020-01-08 23:00:20</span></span>
<span><span class="co">#&gt;  ---                                        </span></span>
<span><span class="co">#&gt; 232: 2020-03-02 22:56:15 2020-03-02 22:56:00</span></span>
<span><span class="co">#&gt; 233: 2020-03-02 22:56:25 2020-03-02 22:56:20</span></span>
<span><span class="co">#&gt; 234: 2020-03-02 22:56:35 2020-03-02 22:56:20</span></span>
<span><span class="co">#&gt; 235: 2020-03-02 22:56:45 2020-03-02 22:56:40</span></span>
<span><span class="co">#&gt; 236: 2020-03-02 22:56:55 2020-03-02 22:56:40</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_agg.html">obs_agg</a></span><span class="op">(</span><span class="va">df</span>, cols <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>,</span>
<span>                             <span class="st">"month"</span>,</span>
<span>                             <span class="st">"day"</span>,</span>
<span>                             <span class="st">"hour"</span>,</span>
<span>                             <span class="st">"minute"</span>,</span>
<span>                             <span class="st">"second"</span>,</span>
<span>                             <span class="st">"time"</span>,</span>
<span>                             <span class="st">"time_decimal"</span>,</span>
<span>                             <span class="st">"value"</span>,</span>
<span>                             <span class="st">"latitude"</span>,</span>
<span>                             <span class="st">"longitude"</span>,</span>
<span>                             <span class="st">"altitude_final"</span>,</span>
<span>                             <span class="st">"elevation"</span>,</span>
<span>                             <span class="st">"intake_height"</span>,</span>
<span>                             <span class="st">"gps_altitude"</span>,</span>
<span>                             <span class="st">"pressure"</span>,</span>
<span>                             <span class="st">"pressure_altitude"</span>,</span>
<span>                             <span class="st">"u"</span>, <span class="st">"v"</span>, <span class="st">"temperature"</span>,</span>
<span>                             <span class="st">"type_altitude"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Adding time</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="add-local-time">Add local time<a class="anchor" aria-label="anchor" href="#add-local-time"></a>
</h2>
<p>Now we add local time</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_addltime.html">obs_addltime</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorderv</a></span><span class="op">(</span><span class="va">df3</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site_code"</span>, <span class="st">"timeUTC"</span><span class="op">)</span>,</span>
<span>          order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df3</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                  timeUTC site_code  lab_1_abbr dataset_calibration_scale  year</span></span>
<span><span class="co">#&gt;                   &lt;POSc&gt;    &lt;char&gt;      &lt;char&gt;                    &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1: 2020-01-08 22:59:40     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;   2: 2020-01-08 23:00:00     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;   3: 2020-01-08 23:00:20     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;   4: 2020-01-08 23:00:40     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;   5: 2020-01-08 23:01:00     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;  ---                                                                          </span></span>
<span><span class="co">#&gt; 115: 2020-03-02 22:55:20     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt; 116: 2020-03-02 22:55:40     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt; 117: 2020-03-02 22:56:00     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt; 118: 2020-03-02 22:56:20     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt; 119: 2020-03-02 22:56:40     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;      month    day  hour minute second       time time_decimal       value</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;char&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;num&gt;        &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:     1     08    22     59     40 1578524380     2020.022 1.90980e-06</span></span>
<span><span class="co">#&gt;   2:     1     08    23      0      0 1578524400     2020.022 1.90885e-06</span></span>
<span><span class="co">#&gt;   3:     1     08    23      0     20 1578524420     2020.022 1.90775e-06</span></span>
<span><span class="co">#&gt;   4:     1     08    23      0     40 1578524440     2020.022 1.90815e-06</span></span>
<span><span class="co">#&gt;   5:     1     08    23      1      0 1578524460     2020.022 1.90780e-06</span></span>
<span><span class="co">#&gt;  ---                                                                     </span></span>
<span><span class="co">#&gt; 115:     3     02    22     55     20 1583189720     2020.169 1.94435e-06</span></span>
<span><span class="co">#&gt; 116:     3     02    22     55     40 1583189740     2020.169 1.94785e-06</span></span>
<span><span class="co">#&gt; 117:     3     02    22     56      0 1583189760     2020.169 1.95025e-06</span></span>
<span><span class="co">#&gt; 118:     3     02    22     56     20 1583189780     2020.169 1.95040e-06</span></span>
<span><span class="co">#&gt; 119:     3     02    22     56     40 1583189800     2020.169 1.94940e-06</span></span>
<span><span class="co">#&gt;      latitude longitude altitude_final elevation intake_height gps_altitude</span></span>
<span><span class="co">#&gt;         &lt;num&gt;     &lt;num&gt;          &lt;num&gt;     &lt;num&gt;         &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:  34.4790 -116.4090        7983.10       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt;   2:  34.4675 -116.4360        7907.00       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt;   3:  34.4525 -116.4720        7796.40       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt;   4:  34.4375 -116.5075        7615.25       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt;   5:  34.4225 -116.5430        7413.90       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt;  ---                                                                       </span></span>
<span><span class="co">#&gt; 115:  33.9955 -118.2480        1113.10       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt; 116:  33.9935 -118.2705         983.70       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt; 117:  33.9915 -118.2925         855.05       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt; 118:  33.9895 -118.3145         753.00       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt; 119:  33.9875 -118.3340         648.10       NaN           NaN          NaN</span></span>
<span><span class="co">#&gt;      pressure pressure_altitude           u         v temperature type_altitude</span></span>
<span><span class="co">#&gt;         &lt;num&gt;             &lt;num&gt;       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:   481.30               NaN 20.82002449 -4.235882      257.65             1</span></span>
<span><span class="co">#&gt;   2:   485.65               NaN 21.46781063 -3.550151      258.30             1</span></span>
<span><span class="co">#&gt;   3:   491.60               NaN 22.83116627 -2.518281      259.05             1</span></span>
<span><span class="co">#&gt;   4:   505.15               NaN 25.19994354 -1.720480      260.95             1</span></span>
<span><span class="co">#&gt;   5:   517.75               NaN 26.27869606 -3.928331      262.50             1</span></span>
<span><span class="co">#&gt;  ---                                                                           </span></span>
<span><span class="co">#&gt; 115:   947.15               NaN  0.40699802 -4.795110      288.90             1</span></span>
<span><span class="co">#&gt; 116:   961.05               NaN  0.16893618 -4.854677      290.10             1</span></span>
<span><span class="co">#&gt; 117:   976.05               NaN  0.05610672 -6.043770      291.35             1</span></span>
<span><span class="co">#&gt; 118:   978.35               NaN -0.99867356 -5.014345      291.60             1</span></span>
<span><span class="co">#&gt; 119:   981.70               NaN -1.99368972 -5.770015      291.90             1</span></span>
<span><span class="co">#&gt;               local_time    lh</span></span>
<span><span class="co">#&gt;                   &lt;POSc&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1: 2020-01-08 15:14:01    15</span></span>
<span><span class="co">#&gt;   2: 2020-01-08 15:14:15    15</span></span>
<span><span class="co">#&gt;   3: 2020-01-08 15:14:26    15</span></span>
<span><span class="co">#&gt;   4: 2020-01-08 15:14:38    15</span></span>
<span><span class="co">#&gt;   5: 2020-01-08 15:14:49    15</span></span>
<span><span class="co">#&gt;  ---                          </span></span>
<span><span class="co">#&gt; 115: 2020-03-02 15:02:20    15</span></span>
<span><span class="co">#&gt; 116: 2020-03-02 15:02:35    15</span></span>
<span><span class="co">#&gt; 117: 2020-03-02 15:02:49    15</span></span>
<span><span class="co">#&gt; 118: 2020-03-02 15:03:04    15</span></span>
<span><span class="co">#&gt; 119: 2020-03-02 15:03:19    15</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="master">Master<a class="anchor" aria-label="anchor" href="#master"></a>
</h2>
<p>Before generating the receptors list, we have the databe with all the
required information</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master</span> <span class="op">&lt;-</span> <span class="va">df3</span></span></code></pre></div>
<p>We may replace missing values with a nine nines. Here is
commented</p>
<p>#master[is.na(master)] &lt;- 999999999</p>
<p>We transform the time variables to character and round coordinates
with 4 digits</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master</span><span class="op">$</span><span class="va">timeUTC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">timeUTC</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">local_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">local_time</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">latitude</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">longitude</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="save-master">Save master<a class="anchor" aria-label="anchor" href="#save-master"></a>
</h2>
<p>Finally we save the master file</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="txt">txt<a class="anchor" aria-label="anchor" href="#txt"></a>
</h3>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".txt\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">master</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".txt"</span><span class="op">)</span>,</span>
<span>       sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpCmgiyH\file7abc7b936bd2_aircraft-insitu.txt</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="csv">csv<a class="anchor" aria-label="anchor" href="#csv"></a>
</h3>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csv\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">master</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csv"</span><span class="op">)</span>,</span>
<span>       sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpCmgiyH\file7abc7b936bd2_aircraft-insitu.csv</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="csvy">csvy<a class="anchor" aria-label="anchor" href="#csvy"></a>
</h3>
<p>CSVY are csv files with a YAML header to include metadata in
tabulated text files</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAdding notes in csvy:\n"</span><span class="op">)</span></span>
<span><span class="va">notes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sector: "</span>, <span class="va">datasetid</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"timespan: "</span>, <span class="va">yy</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"spatial_limits: north = "</span>, <span class="va">north</span>, <span class="st">", south = "</span>, <span class="va">south</span>, <span class="st">", east = "</span>, <span class="va">east</span>, <span class="st">", west = "</span>, <span class="va">west</span><span class="op">)</span>,</span>
<span>           <span class="st">"data: Data averaged every 20 seconds"</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"altitude: &lt; "</span>, <span class="va">max_altitude</span><span class="op">)</span>,</span>
<span>           <span class="st">"hours: All"</span>,</span>
<span>           <span class="st">"local_time: if var `site_utc2lst` is not available, calculated as"</span>,</span>
<span>           <span class="st">"longitude/15*60*60 (John Miller)"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">notes</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/obs_write_csvy.html">obs_write_csvy</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="va">master</span>,</span>
<span>               notes <span class="op">=</span> <span class="va">notes</span>,</span>
<span>               out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; sector: aircraft-insitu</span></span>
<span><span class="co">#&gt; timespan: 2020</span></span>
<span><span class="co">#&gt; spatial_limits: north = 80, south = 10, east = -50, west = -170</span></span>
<span><span class="co">#&gt; data: Data averaged every 20 seconds</span></span>
<span><span class="co">#&gt; altitude: &lt; 8000</span></span>
<span><span class="co">#&gt; hours: All</span></span>
<span><span class="co">#&gt; local_time: if var `site_utc2lst` is not available, calculated as</span></span>
<span><span class="co">#&gt; longitude/15*60*60 (John Miller)</span></span>
<span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpCmgiyH\file7abc7b936bd2_aircraft-insitu.csvy</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/obs_read_csvy.html">obs_read_csvy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "---"                                                               </span></span>
<span><span class="co">#&gt;  [2] "name: Metadata "                                                   </span></span>
<span><span class="co">#&gt;  [3] "sector: aircraft-insitu"                                           </span></span>
<span><span class="co">#&gt;  [4] "timespan: 2020"                                                    </span></span>
<span><span class="co">#&gt;  [5] "spatial_limits: north = 80, south = 10, east = -50, west = -170"   </span></span>
<span><span class="co">#&gt;  [6] "data: Data averaged every 20 seconds"                              </span></span>
<span><span class="co">#&gt;  [7] "altitude: &lt; 8000"                                                  </span></span>
<span><span class="co">#&gt;  [8] "hours: All"                                                        </span></span>
<span><span class="co">#&gt;  [9] "local_time: if var `site_utc2lst` is not available, calculated as" </span></span>
<span><span class="co">#&gt; [10] "longitude/15*60*60 (John Miller)"                                  </span></span>
<span><span class="co">#&gt; [11] "structure: "                                                       </span></span>
<span><span class="co">#&gt; [12] "Classes 'data.table' and 'data.frame':\t119 obs. of  27 variables:"</span></span>
<span><span class="co">#&gt; [13] " $ timeUTC                  : chr  \"2020-01-08 22:59:40\" \".."   </span></span>
<span><span class="co">#&gt; [14] " $ site_code                : chr  \"IAGOS\" \"IAGOS\" ..."        </span></span>
<span><span class="co">#&gt; [15] " $ lab_1_abbr               : chr  \"KIT/IMK-ASF\" \"KIT/IMK\".."  </span></span>
<span><span class="co">#&gt; [16] " $ dataset_calibration_scale: chr  \"WMO CH4 X2004A\" \"WMO \".."  </span></span>
<span><span class="co">#&gt; [17] " $ year                     : int  2020 2020 2020 2020 202.."      </span></span>
<span><span class="co">#&gt; [18] " $ month                    : int  1 1 1 1 1 ..."                  </span></span>
<span><span class="co">#&gt; [19] " $ day                      : chr  \"08\" \"08\" ..."              </span></span>
<span><span class="co">#&gt; [20] " $ hour                     : int  22 23 23 23 23 ..."             </span></span>
<span><span class="co">#&gt; [21] " $ minute                   : int  59 0 0 0 1 ..."                 </span></span>
<span><span class="co">#&gt; [22] " $ second                   : int  40 0 20 40 0 ..."               </span></span>
<span><span class="co">#&gt; [23] " $ time                     : num  1.58e+09 1.58e+09 ..."          </span></span>
<span><span class="co">#&gt; [24] " $ time_decimal             : num  2020 2020 ..."                  </span></span>
<span><span class="co">#&gt; [25] " $ value                    : num  1.91e-06 1.91e-06 ..."          </span></span>
<span><span class="co">#&gt; [26] " $ latitude                 : num  34.5 34.5 ..."                  </span></span>
<span><span class="co">#&gt; [27] " $ longitude                : num  -116 -116 ..."                  </span></span>
<span><span class="co">#&gt; [28] " $ altitude_final           : num  7983 7907 ..."                  </span></span>
<span><span class="co">#&gt; [29] " $ elevation                : num  NaN NaN NaN NaN NaN ..."        </span></span>
<span><span class="co">#&gt; [30] " $ intake_height            : num  NaN NaN NaN NaN NaN ..."        </span></span>
<span><span class="co">#&gt; [31] " $ gps_altitude             : num  NaN NaN NaN NaN NaN ..."        </span></span>
<span><span class="co">#&gt; [32] " $ pressure                 : num  481 486 ..."                    </span></span>
<span><span class="co">#&gt; [33] " $ pressure_altitude        : num  NaN NaN NaN NaN NaN ..."        </span></span>
<span><span class="co">#&gt; [34] " $ u                        : num  20.8 21.5 ..."                  </span></span>
<span><span class="co">#&gt; [35] " $ v                        : num  -4.24 -3.55 ..."                </span></span>
<span><span class="co">#&gt; [36] " $ temperature              : num  258 258 ..."                    </span></span>
<span><span class="co">#&gt; [37] " $ type_altitude            : num  1 1 1 1 1 ..."                  </span></span>
<span><span class="co">#&gt; [38] " $ local_time               : chr  \"2020-01-08 15:14:01.8\".."    </span></span>
<span><span class="co">#&gt; [39] " $ lh                       : int  15 15 15 15 15 ..."             </span></span>
<span><span class="co">#&gt; [40] " - attr(*, \".internal.selfref\")=&lt;externalptr&gt; "                  </span></span>
<span><span class="co">#&gt; [41] "NULL"                                                              </span></span>
<span><span class="co">#&gt; [42] "---"</span></span>
<span><span class="co">#&gt;                  timeUTC site_code  lab_1_abbr dataset_calibration_scale  year</span></span>
<span><span class="co">#&gt;                   &lt;POSc&gt;    &lt;char&gt;      &lt;char&gt;                    &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1: 2020-01-08 22:59:40     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;   2: 2020-01-08 23:00:00     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;   3: 2020-01-08 23:00:20     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;   4: 2020-01-08 23:00:40     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;   5: 2020-01-08 23:01:00     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;  ---                                                                          </span></span>
<span><span class="co">#&gt; 115: 2020-03-02 22:55:20     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt; 116: 2020-03-02 22:55:40     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt; 117: 2020-03-02 22:56:00     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt; 118: 2020-03-02 22:56:20     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt; 119: 2020-03-02 22:56:40     IAGOS KIT/IMK-ASF            WMO CH4 X2004A  2020</span></span>
<span><span class="co">#&gt;      month   day  hour minute second       time time_decimal       value</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;int&gt;        &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:     1     8    22     59     40 1578524380     2020.022 1.90980e-06</span></span>
<span><span class="co">#&gt;   2:     1     8    23      0      0 1578524400     2020.022 1.90885e-06</span></span>
<span><span class="co">#&gt;   3:     1     8    23      0     20 1578524420     2020.022 1.90775e-06</span></span>
<span><span class="co">#&gt;   4:     1     8    23      0     40 1578524440     2020.022 1.90815e-06</span></span>
<span><span class="co">#&gt;   5:     1     8    23      1      0 1578524460     2020.022 1.90780e-06</span></span>
<span><span class="co">#&gt;  ---                                                                    </span></span>
<span><span class="co">#&gt; 115:     3     2    22     55     20 1583189720     2020.169 1.94435e-06</span></span>
<span><span class="co">#&gt; 116:     3     2    22     55     40 1583189740     2020.169 1.94785e-06</span></span>
<span><span class="co">#&gt; 117:     3     2    22     56      0 1583189760     2020.169 1.95025e-06</span></span>
<span><span class="co">#&gt; 118:     3     2    22     56     20 1583189780     2020.169 1.95040e-06</span></span>
<span><span class="co">#&gt; 119:     3     2    22     56     40 1583189800     2020.169 1.94940e-06</span></span>
<span><span class="co">#&gt;      latitude longitude altitude_final elevation intake_height gps_altitude</span></span>
<span><span class="co">#&gt;         &lt;num&gt;     &lt;num&gt;          &lt;num&gt;    &lt;lgcl&gt;        &lt;lgcl&gt;       &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt;   1:  34.4790 -116.4090        7983.10        NA            NA           NA</span></span>
<span><span class="co">#&gt;   2:  34.4675 -116.4360        7907.00        NA            NA           NA</span></span>
<span><span class="co">#&gt;   3:  34.4525 -116.4720        7796.40        NA            NA           NA</span></span>
<span><span class="co">#&gt;   4:  34.4375 -116.5075        7615.25        NA            NA           NA</span></span>
<span><span class="co">#&gt;   5:  34.4225 -116.5430        7413.90        NA            NA           NA</span></span>
<span><span class="co">#&gt;  ---                                                                       </span></span>
<span><span class="co">#&gt; 115:  33.9955 -118.2480        1113.10        NA            NA           NA</span></span>
<span><span class="co">#&gt; 116:  33.9935 -118.2705         983.70        NA            NA           NA</span></span>
<span><span class="co">#&gt; 117:  33.9915 -118.2925         855.05        NA            NA           NA</span></span>
<span><span class="co">#&gt; 118:  33.9895 -118.3145         753.00        NA            NA           NA</span></span>
<span><span class="co">#&gt; 119:  33.9875 -118.3340         648.10        NA            NA           NA</span></span>
<span><span class="co">#&gt;      pressure pressure_altitude           u         v temperature type_altitude</span></span>
<span><span class="co">#&gt;         &lt;num&gt;            &lt;lgcl&gt;       &lt;num&gt;     &lt;num&gt;       &lt;num&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1:   481.30                NA 20.82002449 -4.235882      257.65             1</span></span>
<span><span class="co">#&gt;   2:   485.65                NA 21.46781063 -3.550151      258.30             1</span></span>
<span><span class="co">#&gt;   3:   491.60                NA 22.83116627 -2.518281      259.05             1</span></span>
<span><span class="co">#&gt;   4:   505.15                NA 25.19994354 -1.720480      260.95             1</span></span>
<span><span class="co">#&gt;   5:   517.75                NA 26.27869606 -3.928331      262.50             1</span></span>
<span><span class="co">#&gt;  ---                                                                           </span></span>
<span><span class="co">#&gt; 115:   947.15                NA  0.40699802 -4.795110      288.90             1</span></span>
<span><span class="co">#&gt; 116:   961.05                NA  0.16893618 -4.854677      290.10             1</span></span>
<span><span class="co">#&gt; 117:   976.05                NA  0.05610672 -6.043770      291.35             1</span></span>
<span><span class="co">#&gt; 118:   978.35                NA -0.99867356 -5.014345      291.60             1</span></span>
<span><span class="co">#&gt; 119:   981.70                NA -1.99368972 -5.770015      291.90             1</span></span>
<span><span class="co">#&gt;               local_time    lh</span></span>
<span><span class="co">#&gt;                   &lt;POSc&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1: 2020-01-08 15:14:01    15</span></span>
<span><span class="co">#&gt;   2: 2020-01-08 15:14:15    15</span></span>
<span><span class="co">#&gt;   3: 2020-01-08 15:14:26    15</span></span>
<span><span class="co">#&gt;   4: 2020-01-08 15:14:38    15</span></span>
<span><span class="co">#&gt;   5: 2020-01-08 15:14:49    15</span></span>
<span><span class="co">#&gt;  ---                          </span></span>
<span><span class="co">#&gt; 115: 2020-03-02 15:02:20    15</span></span>
<span><span class="co">#&gt; 116: 2020-03-02 15:02:35    15</span></span>
<span><span class="co">#&gt; 117: 2020-03-02 15:02:49    15</span></span>
<span><span class="co">#&gt; 118: 2020-03-02 15:03:04    15</span></span>
<span><span class="co">#&gt; 119: 2020-03-02 15:03:19    15</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="receptors">Receptors<a class="anchor" aria-label="anchor" href="#receptors"></a>
</h2>
<p>Now we can do the last step which is generating the receptor list
files. Now we filter selected columns</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span> <span class="op">&lt;-</span> <span class="va">master</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site_code"</span>,</span>
<span>                       <span class="st">"year"</span>,</span>
<span>                       <span class="st">"month"</span>,</span>
<span>                       <span class="st">"day"</span>,</span>
<span>                       <span class="st">"hour"</span>,</span>
<span>                       <span class="st">"minute"</span>,</span>
<span>                       <span class="st">"second"</span>,</span>
<span>                       <span class="st">"latitude"</span>,</span>
<span>                       <span class="st">"longitude"</span>,</span>
<span>                       <span class="st">"altitude_final"</span>,</span>
<span>                       <span class="st">"type_altitude"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We can round altitude also</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span><span class="op">$</span><span class="va">altitude_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">receptor</span><span class="op">$</span><span class="va">altitude_final</span><span class="op">)</span></span></code></pre></div>
<p>Now we can format time variables with two digits</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_format.html">obs_format</a></span><span class="op">(</span><span class="va">receptor</span>,</span>
<span>                        spf <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"month"</span>, <span class="st">"day"</span>,</span>
<span>                                 <span class="st">"hour"</span>, <span class="st">"minute"</span>, <span class="st">"second"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We have a column that indicate AGL or ASL</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor_agl</span> <span class="op">&lt;-</span> <span class="va">receptor</span><span class="op">[</span><span class="va">type_altitude</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="va">receptor_asl</span> <span class="op">&lt;-</span> <span class="va">receptor</span><span class="op">[</span><span class="va">type_altitude</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>Finally, we save the receptors</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">receptor_agl</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_AGL.txt"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receptor_agl</span>,</span>
<span>         file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_AGL.txt"</span><span class="op">)</span>,</span>
<span>         sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">receptor_asl</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_ASL.txt"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receptor_asl</span>,</span>
<span>         file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"receptor_ASL.txt"</span><span class="op">)</span>,</span>
<span>         sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpCmgiyH\file7abc7b936bd2_aircraft-insitu_receptor_ASL.txt</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="plot">Plot<a class="anchor" aria-label="anchor" href="#plot"></a>
</h2>
<p>Finally, we just plot some data, run it locally</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/obs_plot.html">obs_plot</a></span><span class="op">(</span><span class="va">df3</span>, time <span class="op">=</span> <span class="st">"timeUTC"</span>, yfactor <span class="op">=</span> <span class="fl">1e9</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="https://github.com/noaa-gml/rtorf/blob/main/man/figures/obsplot_aircraftinsitu.png?raw=true" alt="Time Series"><div class="figcaption">Time Series</div>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">df3</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"value"</span><span class="op">]</span>, axes <span class="op">=</span> <span class="cn">T</span>, reset <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu">map</span><span class="op">(</span>add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="https://github.com/noaa-gml/rtorf/blob/main/man/figures/obsplot_aircraftinsitu_map.png?raw=true" alt="Map"><div class="figcaption">Map</div>
</div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">df3</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="va">ch4</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">value</span><span class="op">*</span><span class="fl">1e+9</span></span>
<span><span class="fu"><a href="../reference/obs_plot.html">obs_plot</a></span><span class="op">(</span><span class="va">x</span>, </span>
<span>         time <span class="op">=</span> <span class="st">"ch4"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"altitude_final"</span>, </span>
<span>         colu <span class="op">=</span> <span class="st">"month"</span>, <span class="co">#n = c(1L, 3L, 6L, 8L, 9L, 11L, 12L), </span></span>
<span>         type <span class="op">=</span> <span class="st">"b"</span>, </span>
<span>         xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">CH</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">~</span><span class="va">ppb</span><span class="op">)</span>, </span>
<span>         ylab <span class="op">=</span> <span class="st">"altitude (m)"</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="https://github.com/noaa-gml/rtorf/blob/main/man/figures/obsplot_aircraftinsitu_vert.png?raw=true" alt="Vertical profiles"><div class="figcaption">Vertical profiles</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sergio Ibarra-Espinosa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
