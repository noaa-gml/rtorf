<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>aircore â€¢ rtorf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="aircore">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtorf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/aircore.html">aircore</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-flask.html">aircraft-flask</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-insitu.html">aircraft-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/aircraft-pfp.html">aircraft-pfp</a></li>
    <li><a class="dropdown-item" href="../articles/summary.html">summary</a></li>
    <li><a class="dropdown-item" href="../articles/surface-flask.html">surface-flask</a></li>
    <li><a class="dropdown-item" href="../articles/surface-insitu.html">surface-insitu</a></li>
    <li><a class="dropdown-item" href="../articles/surface-pfp.html">surface-pfp</a></li>
    <li><a class="dropdown-item" href="../articles/tower-insitu.html">tower-insitu</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/noaa-gml/rtorf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>aircore</h1>
            
            <h4 data-toc-skip class="date">2024-08-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/noaa-gml/rtorf/blob/main/vignettes/aircore.Rmd" class="external-link"><code>vignettes/aircore.Rmd</code></a></small>
      <div class="d-none name"><code>aircore.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/noaa-gml/rtorf" class="external-link">rtorf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">cate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aircraft-pfp"</span>,</span>
<span>         <span class="st">"aircraft-insitu"</span>,</span>
<span>         <span class="st">"aircraft-flask"</span>,</span>
<span>         <span class="st">"surface-insitu"</span>,</span>
<span>         <span class="st">"surface-flask"</span>, </span>
<span>         <span class="st">"surface-pfp"</span>,   </span>
<span>         <span class="st">"tower-insitu"</span>,  </span>
<span>         <span class="st">"aircore"</span>,       </span>
<span>         <span class="st">"shipboard-insitu"</span>,</span>
<span>         <span class="st">"shipboard-flask"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="st">"/media/sergio/ext5/obspack/obspack_ch4_1_GLOBALVIEWplus_v6.0_2023-12-01/data/nc/"</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_summary.html">obs_summary</a></span><span class="op">(</span>obs <span class="op">=</span> <span class="va">obs</span>, </span>
<span>                     categories <span class="op">=</span> <span class="va">cate</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Number of files of index: 479</span></span>
<span><span class="co">#&gt;               sector     N</span></span>
<span><span class="co">#&gt;               &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1:     aircraft-pfp    42</span></span>
<span><span class="co">#&gt;  2:  aircraft-insitu    17</span></span>
<span><span class="co">#&gt;  3:    surface-flask   106</span></span>
<span><span class="co">#&gt;  4:   surface-insitu   121</span></span>
<span><span class="co">#&gt;  5:   aircraft-flask     4</span></span>
<span><span class="co">#&gt;  6:          aircore     1</span></span>
<span><span class="co">#&gt;  7:      surface-pfp    33</span></span>
<span><span class="co">#&gt;  8:     tower-insitu   150</span></span>
<span><span class="co">#&gt;  9:  shipboard-flask     4</span></span>
<span><span class="co">#&gt; 10: shipboard-insitu     1</span></span>
<span><span class="co">#&gt; 11:    Total sectors   479</span></span>
<span><span class="co">#&gt; Detected 203 files with agl</span></span>
<span><span class="co">#&gt; Detected 276 files without agl</span></span></code></pre>
<p>Now we read the aircraft-pfp using the function
<code>obs_read_nc</code>. To this date, <code>solar_time</code> is not
included for aircraft, so we <code>FALSE</code> that argument.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datasetid</span> <span class="op">&lt;-</span> <span class="st">"aircore"</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_read_nc.html">obs_read_nc</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">index</span>,</span>
<span>                  categories <span class="op">=</span> <span class="va">datasetid</span>,</span>
<span>                  solar_time <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Searching aircore...</span></span>
<span><span class="co">#&gt; 1: ch4_aircorenoaa_aircore_1_allvalid.nc</span></span></code></pre>
<p>Now we check the data</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;         year month   day  hour minute second       time start_time</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;int&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt;     1:  2012     1    14    20     16     52 1326572212 1326572212</span></span>
<span><span class="co">#&gt;     2:  2012     1    14    20     16     54 1326572214 1326572214</span></span>
<span><span class="co">#&gt;     3:  2012     1    14    20     16     57 1326572217 1326572217</span></span>
<span><span class="co">#&gt;     4:  2012     1    14    20     16     59 1326572219 1326572219</span></span>
<span><span class="co">#&gt;     5:  2012     1    14    20     17      1 1326572221 1326572221</span></span>
<span><span class="co">#&gt;    ---                                                            </span></span>
<span><span class="co">#&gt; 72003:  2021     7    28    18     48      8 1627498088 1627498088</span></span>
<span><span class="co">#&gt; 72004:  2021     7    28    18     48     10 1627498090 1627498090</span></span>
<span><span class="co">#&gt; 72005:  2021     7    28    18     48     11 1627498091 1627498091</span></span>
<span><span class="co">#&gt; 72006:  2021     7    28    18     48     14 1627498094 1627498094</span></span>
<span><span class="co">#&gt; 72007:  2021     7    28    18     48     17 1627498097 1627498097</span></span>
<span><span class="co">#&gt;        midpoint_time                    datetime time_decimal time_interval</span></span>
<span><span class="co">#&gt;                &lt;int&gt;                      &lt;char&gt;        &lt;num&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt;     1:    1326572212 2012-01-14T20:16:52.500000Z     2012.038             1</span></span>
<span><span class="co">#&gt;     2:    1326572214 2012-01-14T20:16:54.500000Z     2012.038             1</span></span>
<span><span class="co">#&gt;     3:    1326572217 2012-01-14T20:16:57.500000Z     2012.038             1</span></span>
<span><span class="co">#&gt;     4:    1326572219 2012-01-14T20:16:59.500000Z     2012.038             1</span></span>
<span><span class="co">#&gt;     5:    1326572221 2012-01-14T20:17:01.500000Z     2012.038             1</span></span>
<span><span class="co">#&gt;    ---                                                                     </span></span>
<span><span class="co">#&gt; 72003:    1627498088 2021-07-28T18:48:08.500000Z     2021.572             1</span></span>
<span><span class="co">#&gt; 72004:    1627498090 2021-07-28T18:48:10.500000Z     2021.572             1</span></span>
<span><span class="co">#&gt; 72005:    1627498091 2021-07-28T18:48:11.500000Z     2021.572             1</span></span>
<span><span class="co">#&gt; 72006:    1627498094 2021-07-28T18:48:14.500000Z     2021.572             1</span></span>
<span><span class="co">#&gt; 72007:    1627498097 2021-07-28T18:48:17.500000Z     2021.572             1</span></span>
<span><span class="co">#&gt;              value value_unc latitude  longitude altitude pressure temperature</span></span>
<span><span class="co">#&gt;              &lt;num&gt;     &lt;num&gt;    &lt;num&gt;      &lt;num&gt;    &lt;num&gt;    &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt;     1: 1.28550e-06  1.88e-09 36.85327  -98.20967 21685.83    42.22          NA</span></span>
<span><span class="co">#&gt;     2: 1.28640e-06  1.88e-09 36.85339  -98.20983 21626.17    42.63          NA</span></span>
<span><span class="co">#&gt;     3: 1.28762e-06  1.87e-09 36.85342  -98.21008 21565.31    43.03          NA</span></span>
<span><span class="co">#&gt;     4: 1.28904e-06  1.87e-09 36.85336  -98.21020 21508.82    43.43          NA</span></span>
<span><span class="co">#&gt;     5: 1.29071e-06  1.87e-09 36.85347  -98.21030 21453.79    43.81          NA</span></span>
<span><span class="co">#&gt;    ---                                                                        </span></span>
<span><span class="co">#&gt; 72003: 1.92660e-06  7.00e-10 39.95629 -104.16959  1801.49   820.30      303.02</span></span>
<span><span class="co">#&gt; 72004: 1.92784e-06  7.00e-10 39.95627 -104.16962  1787.17   828.84      303.20</span></span>
<span><span class="co">#&gt; 72005: 1.92688e-06  7.00e-10 39.95625 -104.16962  1776.80   822.42      303.32</span></span>
<span><span class="co">#&gt; 72006: 1.92769e-06  7.00e-10 39.95626 -104.16955  1757.47   824.24      303.39</span></span>
<span><span class="co">#&gt; 72007: 1.92808e-06  7.00e-10 39.95625 -104.16945  1735.74   826.09      303.66</span></span>
<span><span class="co">#&gt;           source_id  profile_id flight_id obs_flag obspack_num</span></span>
<span><span class="co">#&gt;              &lt;char&gt;      &lt;char&gt;    &lt;char&gt;    &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;     1: NOAA AirCore ACBIG002_AC  ACBIG002        1     1174889</span></span>
<span><span class="co">#&gt;     2: NOAA AirCore ACBIG002_AC  ACBIG002        1     1174890</span></span>
<span><span class="co">#&gt;     3: NOAA AirCore ACBIG002_AC  ACBIG002        1     1174891</span></span>
<span><span class="co">#&gt;     4: NOAA AirCore ACBIG002_AC  ACBIG002        1     1174892</span></span>
<span><span class="co">#&gt;     5: NOAA AirCore ACBIG002_AC  ACBIG002        1     1174893</span></span>
<span><span class="co">#&gt;    ---                                                        </span></span>
<span><span class="co">#&gt; 72003: NOAA AirCore ACGMD009_AC  ACGMD009        1     1246891</span></span>
<span><span class="co">#&gt; 72004: NOAA AirCore ACGMD008_AC  ACGMD008        1     1246892</span></span>
<span><span class="co">#&gt; 72005: NOAA AirCore ACGMD009_AC  ACGMD009        1     1246893</span></span>
<span><span class="co">#&gt; 72006: NOAA AirCore ACGMD009_AC  ACGMD009        1     1246894</span></span>
<span><span class="co">#&gt; 72007: NOAA AirCore ACGMD009_AC  ACGMD009        1     1246895</span></span>
<span><span class="co">#&gt;                                                                                     obspack_id</span></span>
<span><span class="co">#&gt;                                                                                         &lt;char&gt;</span></span>
<span><span class="co">#&gt;     1: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1174889</span></span>
<span><span class="co">#&gt;     2: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1174890</span></span>
<span><span class="co">#&gt;     3: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1174891</span></span>
<span><span class="co">#&gt;     4: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1174892</span></span>
<span><span class="co">#&gt;     5: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1174893</span></span>
<span><span class="co">#&gt;    ---                                                                                        </span></span>
<span><span class="co">#&gt; 72003: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1246891</span></span>
<span><span class="co">#&gt; 72004: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1246892</span></span>
<span><span class="co">#&gt; 72005: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1246893</span></span>
<span><span class="co">#&gt; 72006: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1246894</span></span>
<span><span class="co">#&gt; 72007: obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08~ch4_aircorenoaa_aircore_1_allvalid~1246895</span></span>
<span><span class="co">#&gt;        unique_sample_location_num         scale dataset_project</span></span>
<span><span class="co">#&gt;                             &lt;int&gt;        &lt;char&gt;          &lt;char&gt;</span></span>
<span><span class="co">#&gt;     1:                   24769354 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt;     2:                   24769358 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt;     3:                   24769357 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt;     4:                   24769356 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt;     5:                   24769364 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt;    ---                                                         </span></span>
<span><span class="co">#&gt; 72003:                   46264921 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt; 72004:                   46264920 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt; 72005:                   46264901 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt; 72006:                   46264919 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt; 72007:                   46264902 WMO CH4 X2004         aircore</span></span>
<span><span class="co">#&gt;        dataset_selection_tag     site_name site_elevation site_latitude</span></span>
<span><span class="co">#&gt;                       &lt;char&gt;        &lt;char&gt;          &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;     1:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt;     2:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt;     3:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt;     4:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt;     5:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt;    ---                                                                 </span></span>
<span><span class="co">#&gt; 72003:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt; 72004:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt; 72005:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt; 72006:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt; 72007:              allvalid NOAA AirCore          -1e+34        -1e+34</span></span>
<span><span class="co">#&gt;        site_longitude  site_country   site_code lab_1_abbr</span></span>
<span><span class="co">#&gt;                 &lt;num&gt;        &lt;char&gt;      &lt;char&gt;     &lt;char&gt;</span></span>
<span><span class="co">#&gt;     1:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt;     2:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt;     3:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt;     4:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt;     5:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt;    ---                                                    </span></span>
<span><span class="co">#&gt; 72003:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt; 72004:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt; 72005:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt; 72006:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt; 72007:         -1e+34 United States AirCoreNOAA       NOAA</span></span>
<span><span class="co">#&gt;        dataset_calibration_scale altitude_final type_altitude</span></span>
<span><span class="co">#&gt;                           &lt;char&gt;          &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt;     1:             WMO CH4 X2004       21685.83             1</span></span>
<span><span class="co">#&gt;     2:             WMO CH4 X2004       21626.17             1</span></span>
<span><span class="co">#&gt;     3:             WMO CH4 X2004       21565.31             1</span></span>
<span><span class="co">#&gt;     4:             WMO CH4 X2004       21508.82             1</span></span>
<span><span class="co">#&gt;     5:             WMO CH4 X2004       21453.79             1</span></span>
<span><span class="co">#&gt;    ---                                                       </span></span>
<span><span class="co">#&gt; 72003:             WMO CH4 X2004        1801.49             1</span></span>
<span><span class="co">#&gt; 72004:             WMO CH4 X2004        1787.17             1</span></span>
<span><span class="co">#&gt; 72005:             WMO CH4 X2004        1776.80             1</span></span>
<span><span class="co">#&gt; 72006:             WMO CH4 X2004        1757.47             1</span></span>
<span><span class="co">#&gt; 72007:             WMO CH4 X2004        1735.74             1</span></span></code></pre>
<p>Now we can process the data. We first filter for observations within
our spatial domain:</p>
<div class="section level2">
<h2 id="checks-and-definitions">Checks and definitions<a class="anchor" aria-label="anchor" href="#checks-and-definitions"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">north</span> <span class="op">&lt;-</span> <span class="fl">80</span></span>
<span><span class="va">south</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">west</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">170</span></span>
<span><span class="va">east</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">50</span></span>
<span><span class="va">max_altitude</span> <span class="op">&lt;-</span> <span class="fl">8000</span></span>
<span><span class="va">yy</span> <span class="op">&lt;-</span> <span class="fl">2022</span></span></code></pre></div>
<p>We check altitude, intake_height, altitude_final and elevation.
altitude_final is a column from intake_height, added to match column
from obs_read text files.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"altitude"</span>, <span class="st">"altitude_final"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;        altitude altitude_final</span></span>
<span><span class="co">#&gt;           &lt;num&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt;     1: 21685.83       21685.83</span></span>
<span><span class="co">#&gt;     2: 21626.17       21626.17</span></span>
<span><span class="co">#&gt;     3: 21565.31       21565.31</span></span>
<span><span class="co">#&gt;     4: 21508.82       21508.82</span></span>
<span><span class="co">#&gt;     5: 21453.79       21453.79</span></span>
<span><span class="co">#&gt;    ---                        </span></span>
<span><span class="co">#&gt; 72003:  1801.49        1801.49</span></span>
<span><span class="co">#&gt; 72004:  1787.17        1787.17</span></span>
<span><span class="co">#&gt; 72005:  1776.80        1776.80</span></span>
<span><span class="co">#&gt; 72006:  1757.47        1757.47</span></span>
<span><span class="co">#&gt; 72007:  1735.74        1735.74</span></span></code></pre>
<p>The temporal range of data is</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 2012 2021</span></span></code></pre>
<p>We also check for dimensions of data</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 72007    39</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="filters">Filters<a class="anchor" aria-label="anchor" href="#filters"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">year</span> <span class="op">==</span> <span class="va">yy</span><span class="op">]</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">altitude_final</span> <span class="op">&lt;</span> <span class="va">max_altitude</span> <span class="op">&amp;</span></span>
<span>           <span class="va">latitude</span> <span class="op">&lt;</span> <span class="va">north</span> <span class="op">&amp;</span></span>
<span>           <span class="va">latitude</span> <span class="op">&gt;</span> <span class="va">south</span> <span class="op">&amp;</span></span>
<span>           <span class="va">longitude</span> <span class="op">&lt;</span> <span class="va">east</span> <span class="op">&amp;</span></span>
<span>           <span class="va">longitude</span> <span class="op">&gt;</span> <span class="va">west</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 3256   39</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="adding-time-as-posixct-class">Adding time as POSIXct class<a class="anchor" aria-label="anchor" href="#adding-time-as-posixct-class"></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_addtime.html">obs_addtime</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="st">"timeUTC"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                   timeUTC</span></span>
<span><span class="co">#&gt;                    &lt;POSc&gt;</span></span>
<span><span class="co">#&gt;    1: 2020-01-30 19:37:28</span></span>
<span><span class="co">#&gt;    2: 2020-01-30 19:37:32</span></span>
<span><span class="co">#&gt;    3: 2020-01-30 19:37:36</span></span>
<span><span class="co">#&gt;    4: 2020-01-30 19:37:40</span></span>
<span><span class="co">#&gt;    5: 2020-01-30 19:37:43</span></span>
<span><span class="co">#&gt;   ---                    </span></span>
<span><span class="co">#&gt; 3252: 2020-12-17 18:56:09</span></span>
<span><span class="co">#&gt; 3253: 2020-12-17 18:56:10</span></span>
<span><span class="co">#&gt; 3254: 2020-12-17 18:56:12</span></span>
<span><span class="co">#&gt; 3255: 2020-12-17 18:56:12</span></span>
<span><span class="co">#&gt; 3256: 2020-12-17 18:56:15</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="cut-time">Cut time<a class="anchor" aria-label="anchor" href="#cut-time"></a>
</h2>
<p>now we can cut time every 20 seconds. We can chosse other frequency
as well.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">sec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_freq.html">obs_freq</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">second</span>,</span>
<span>                     freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"second"</span>, <span class="st">"sec2"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;       second  sec2</span></span>
<span><span class="co">#&gt;        &lt;int&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:     28    20</span></span>
<span><span class="co">#&gt;    2:     32    20</span></span>
<span><span class="co">#&gt;    3:     36    20</span></span>
<span><span class="co">#&gt;    4:     40    20</span></span>
<span><span class="co">#&gt;    5:     43    40</span></span>
<span><span class="co">#&gt;   ---             </span></span>
<span><span class="co">#&gt; 3252:      9     0</span></span>
<span><span class="co">#&gt; 3253:     10     0</span></span>
<span><span class="co">#&gt; 3254:     12     0</span></span>
<span><span class="co">#&gt; 3255:     12     0</span></span>
<span><span class="co">#&gt; 3256:     15     0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="aggregate-data">Aggregate data<a class="anchor" aria-label="anchor" href="#aggregate-data"></a>
</h2>
<p>now we need to add the column key_time, that it will be used to
aggregate other variables</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">key_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html" class="external-link">ISOdatetime</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">year</span>,</span>
<span>                           month <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">month</span>,</span>
<span>                           day <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">day</span>,</span>
<span>                           hour <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">hour</span>,</span>
<span>                           min <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">minute</span>,</span>
<span>                           sec <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">sec2</span>,</span>
<span>                           tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"timeUTC"</span>, <span class="st">"key_time"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                   timeUTC            key_time</span></span>
<span><span class="co">#&gt;                    &lt;POSc&gt;              &lt;POSc&gt;</span></span>
<span><span class="co">#&gt;    1: 2020-01-30 19:37:28 2020-01-30 19:37:20</span></span>
<span><span class="co">#&gt;    2: 2020-01-30 19:37:32 2020-01-30 19:37:20</span></span>
<span><span class="co">#&gt;    3: 2020-01-30 19:37:36 2020-01-30 19:37:20</span></span>
<span><span class="co">#&gt;    4: 2020-01-30 19:37:40 2020-01-30 19:37:20</span></span>
<span><span class="co">#&gt;    5: 2020-01-30 19:37:43 2020-01-30 19:37:40</span></span>
<span><span class="co">#&gt;   ---                                        </span></span>
<span><span class="co">#&gt; 3252: 2020-12-17 18:56:09 2020-12-17 18:56:00</span></span>
<span><span class="co">#&gt; 3253: 2020-12-17 18:56:10 2020-12-17 18:56:00</span></span>
<span><span class="co">#&gt; 3254: 2020-12-17 18:56:12 2020-12-17 18:56:00</span></span>
<span><span class="co">#&gt; 3255: 2020-12-17 18:56:12 2020-12-17 18:56:00</span></span>
<span><span class="co">#&gt; 3256: 2020-12-17 18:56:15 2020-12-17 18:56:00</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_agg.html">obs_agg</a></span><span class="op">(</span><span class="va">df</span>, cols <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>,</span>
<span>                             <span class="st">"month"</span>,</span>
<span>                             <span class="st">"day"</span>,</span>
<span>                             <span class="st">"hour"</span>,</span>
<span>                             <span class="st">"minute"</span>,</span>
<span>                             <span class="st">"second"</span>,</span>
<span>                             <span class="st">"time"</span>,</span>
<span>                             <span class="st">"time_decimal"</span>,</span>
<span>                             <span class="st">"value"</span>,</span>
<span>                             <span class="st">"latitude"</span>,</span>
<span>                             <span class="st">"longitude"</span>,</span>
<span>                             <span class="st">"altitude_final"</span>,</span>
<span>                             <span class="co"># "elevation",</span></span>
<span>                             <span class="co"># "intake_height",</span></span>
<span>                             <span class="co"># "gps_altitude",</span></span>
<span>                             <span class="co"># "pressure",</span></span>
<span>                             <span class="co"># "pressure_altitude",</span></span>
<span>                             <span class="co"># "u", "v", "temperature",</span></span>
<span>                             <span class="st">"type_altitude"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-local-time">Add local time<a class="anchor" aria-label="anchor" href="#add-local-time"></a>
</h2>
<p>Now we add local time</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_addltime.html">obs_addltime</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorderv</a></span><span class="op">(</span><span class="va">df3</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site_code"</span>, <span class="st">"timeUTC"</span><span class="op">)</span>,</span>
<span>          order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df3</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                  timeUTC   site_code lab_1_abbr dataset_calibration_scale  year</span></span>
<span><span class="co">#&gt;                   &lt;POSc&gt;      &lt;char&gt;     &lt;char&gt;                    &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1: 2020-01-30 19:37:20 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;   2: 2020-01-30 19:37:40 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;   3: 2020-01-30 19:38:00 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;   4: 2020-01-30 19:38:20 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;   5: 2020-01-30 19:38:40 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;  ---                                                                           </span></span>
<span><span class="co">#&gt; 334: 2020-12-17 18:54:40 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt; 335: 2020-12-17 18:55:00 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt; 336: 2020-12-17 18:55:20 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt; 337: 2020-12-17 18:55:40 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt; 338: 2020-12-17 18:56:00 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;      month    day  hour minute second       time time_decimal        value</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;char&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;num&gt;        &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:     1     30    19     37     20 1580413040     2020.081 1.912662e-06</span></span>
<span><span class="co">#&gt;   2:     1     30    19     37     40 1580413060     2020.081 1.913034e-06</span></span>
<span><span class="co">#&gt;   3:     1     30    19     38      0 1580413080     2020.081 1.913344e-06</span></span>
<span><span class="co">#&gt;   4:     1     30    19     38     20 1580413100     2020.081 1.913346e-06</span></span>
<span><span class="co">#&gt;   5:     1     30    19     38     40 1580413120     2020.081 1.913906e-06</span></span>
<span><span class="co">#&gt;  ---                                                                      </span></span>
<span><span class="co">#&gt; 334:    12     17    18     54     40 1608231280     2020.961 1.958356e-06</span></span>
<span><span class="co">#&gt; 335:    12     17    18     55      0 1608231300     2020.961 1.958784e-06</span></span>
<span><span class="co">#&gt; 336:    12     17    18     55     20 1608231320     2020.961 1.959021e-06</span></span>
<span><span class="co">#&gt; 337:    12     17    18     55     40 1608231340     2020.961 1.958858e-06</span></span>
<span><span class="co">#&gt; 338:    12     17    18     56      0 1608231360     2020.961 1.959788e-06</span></span>
<span><span class="co">#&gt;      latitude longitude altitude_final type_altitude          local_time    lh</span></span>
<span><span class="co">#&gt;         &lt;num&gt;     &lt;num&gt;          &lt;num&gt;         &lt;num&gt;              &lt;POSc&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1: 39.68173 -103.7711       7926.282             1 2020-01-30 12:42:14    12</span></span>
<span><span class="co">#&gt;   2: 39.67923 -103.7686       7795.292             1 2020-01-30 12:42:35    12</span></span>
<span><span class="co">#&gt;   3: 39.67596 -103.7657       7647.354             1 2020-01-30 12:42:56    12</span></span>
<span><span class="co">#&gt;   4: 39.67261 -103.7625       7500.024             1 2020-01-30 12:43:16    12</span></span>
<span><span class="co">#&gt;   5: 39.66949 -103.7596       7357.494             1 2020-01-30 12:43:37    12</span></span>
<span><span class="co">#&gt;  ---                                                                          </span></span>
<span><span class="co">#&gt; 334: 39.47656 -103.8517       2353.402             1 2020-12-17 11:59:15    11</span></span>
<span><span class="co">#&gt; 335: 39.47749 -103.8506       2233.901             1 2020-12-17 11:59:35    11</span></span>
<span><span class="co">#&gt; 336: 39.47844 -103.8497       2121.761             1 2020-12-17 11:59:56    11</span></span>
<span><span class="co">#&gt; 337: 39.47984 -103.8488       2007.779             1 2020-12-17 12:00:16    12</span></span>
<span><span class="co">#&gt; 338: 39.48127 -103.8481       1905.712             1 2020-12-17 12:00:36    12</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="master">Master<a class="anchor" aria-label="anchor" href="#master"></a>
</h2>
<p>Before generating the receptors list, we have the databe with all the
required information</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master</span> <span class="op">&lt;-</span> <span class="va">df3</span></span></code></pre></div>
<p>We may replace missing values with a nine nines. Here is
commented</p>
<p>#master[is.na(master)] &lt;- 999999999</p>
<p>We transform the time variables to character and round coordinates
with 4 digits</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master</span><span class="op">$</span><span class="va">timeUTC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">timeUTC</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">local_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">local_time</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">latitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">latitude</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">master</span><span class="op">$</span><span class="va">longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">master</span><span class="op">$</span><span class="va">longitude</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="save-master">Save master<a class="anchor" aria-label="anchor" href="#save-master"></a>
</h2>
<p>Finally we save the master file</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="txt">txt<a class="anchor" aria-label="anchor" href="#txt"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".txt\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">master</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".txt"</span><span class="op">)</span>,</span>
<span>       sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpQ33K7x\file8b4862a53ca7_aircore.txt</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="csv">csv<a class="anchor" aria-label="anchor" href="#csv"></a>
</h3>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csv\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">master</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csv"</span><span class="op">)</span>,</span>
<span>       sep <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpQ33K7x\file8b4862a53ca7_aircore.csv</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="csvy">csvy<a class="anchor" aria-label="anchor" href="#csvy"></a>
</h3>
<p>CSVY are csv files with a YAML header to include metadata in
tabulated text files</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAdding notes in csvy:\n"</span><span class="op">)</span></span>
<span><span class="va">notes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sector: "</span>, <span class="va">datasetid</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"timespan: "</span>, <span class="va">yy</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"spatial_limits: north = "</span>, <span class="va">north</span>, <span class="st">", south = "</span>, <span class="va">south</span>, <span class="st">", east = "</span>, <span class="va">east</span>, <span class="st">", west = "</span>, <span class="va">west</span><span class="op">)</span>,</span>
<span>           <span class="st">"data: Data averaged every 20 seconds"</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"altitude: &lt; "</span>, <span class="va">max_altitude</span><span class="op">)</span>,</span>
<span>           <span class="st">"hours: All"</span>,</span>
<span>           <span class="st">"local_time: if var `site_utc2lst` is not available, calculated as"</span>,</span>
<span>           <span class="st">"longitude/15*60*60 (John Miller)"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">notes</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/obs_write_csvy.html">obs_write_csvy</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="va">master</span>,</span>
<span>               notes <span class="op">=</span> <span class="va">notes</span>,</span>
<span>               out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Adding notes in csvy:</span></span>
<span><span class="co">#&gt; sector: aircore</span></span>
<span><span class="co">#&gt; timespan: 2020</span></span>
<span><span class="co">#&gt; spatial_limits: north = 80, south = 10, east = -50, west = -170</span></span>
<span><span class="co">#&gt; data: Data averaged every 20 seconds</span></span>
<span><span class="co">#&gt; altitude: &lt; 8000</span></span>
<span><span class="co">#&gt; hours: All</span></span>
<span><span class="co">#&gt; local_time: if var `site_utc2lst` is not available, calculated as</span></span>
<span><span class="co">#&gt; longitude/15*60*60 (John Miller)</span></span>
<span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpQ33K7x\file8b4862a53ca7_aircore.csvy</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/obs_read_csvy.html">obs_read_csvy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>,<span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">".csvy"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;  [1] "---"                                                               </span></span>
<span><span class="co">#&gt;  [2] "name: Metadata "                                                   </span></span>
<span><span class="co">#&gt;  [3] "sector: aircore"                                                   </span></span>
<span><span class="co">#&gt;  [4] "timespan: 2020"                                                    </span></span>
<span><span class="co">#&gt;  [5] "spatial_limits: north = 80, south = 10, east = -50, west = -170"   </span></span>
<span><span class="co">#&gt;  [6] "data: Data averaged every 20 seconds"                              </span></span>
<span><span class="co">#&gt;  [7] "altitude: &lt; 8000"                                                  </span></span>
<span><span class="co">#&gt;  [8] "hours: All"                                                        </span></span>
<span><span class="co">#&gt;  [9] "local_time: if var `site_utc2lst` is not available, calculated as" </span></span>
<span><span class="co">#&gt; [10] "longitude/15*60*60 (John Miller)"                                  </span></span>
<span><span class="co">#&gt; [11] "structure: "                                                       </span></span>
<span><span class="co">#&gt; [12] "Classes 'data.table' and 'data.frame':\t338 obs. of  19 variables:"</span></span>
<span><span class="co">#&gt; [13] " $ timeUTC                  : chr  \"2020-01-30 19:37:20\" \".."   </span></span>
<span><span class="co">#&gt; [14] " $ site_code                : chr  \"AirCoreNOAA\" \"AirCore\".."  </span></span>
<span><span class="co">#&gt; [15] " $ lab_1_abbr               : chr  \"NOAA\" \"NOAA\" ..."          </span></span>
<span><span class="co">#&gt; [16] " $ dataset_calibration_scale: chr  \"WMO CH4 X2004\" \"WMO C\".."  </span></span>
<span><span class="co">#&gt; [17] " $ year                     : int  2020 2020 2020 2020 202.."      </span></span>
<span><span class="co">#&gt; [18] " $ month                    : int  1 1 1 1 1 ..."                  </span></span>
<span><span class="co">#&gt; [19] " $ day                      : chr  \"30\" \"30\" ..."              </span></span>
<span><span class="co">#&gt; [20] " $ hour                     : int  19 19 19 19 19 ..."             </span></span>
<span><span class="co">#&gt; [21] " $ minute                   : int  37 37 38 38 38 ..."             </span></span>
<span><span class="co">#&gt; [22] " $ second                   : int  20 40 0 20 40 ..."              </span></span>
<span><span class="co">#&gt; [23] " $ time                     : num  1.58e+09 1.58e+09 ..."          </span></span>
<span><span class="co">#&gt; [24] " $ time_decimal             : num  2020 2020 ..."                  </span></span>
<span><span class="co">#&gt; [25] " $ value                    : num  1.91e-06 1.91e-06 ..."          </span></span>
<span><span class="co">#&gt; [26] " $ latitude                 : num  39.7 39.7 ..."                  </span></span>
<span><span class="co">#&gt; [27] " $ longitude                : num  -104 -104 ..."                  </span></span>
<span><span class="co">#&gt; [28] " $ altitude_final           : num  7926 7795 ..."                  </span></span>
<span><span class="co">#&gt; [29] " $ type_altitude            : num  1 1 1 1 1 ..."                  </span></span>
<span><span class="co">#&gt; [30] " $ local_time               : chr  \"2020-01-30 12:42:14.9\".."    </span></span>
<span><span class="co">#&gt; [31] " $ lh                       : int  12 12 12 12 12 ..."             </span></span>
<span><span class="co">#&gt; [32] " - attr(*, \".internal.selfref\")=&lt;externalptr&gt; "                  </span></span>
<span><span class="co">#&gt; [33] "NULL"                                                              </span></span>
<span><span class="co">#&gt; [34] "---"</span></span>
<span><span class="co">#&gt;                  timeUTC   site_code lab_1_abbr dataset_calibration_scale  year</span></span>
<span><span class="co">#&gt;                   &lt;POSc&gt;      &lt;char&gt;     &lt;char&gt;                    &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1: 2020-01-30 19:37:20 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;   2: 2020-01-30 19:37:40 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;   3: 2020-01-30 19:38:00 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;   4: 2020-01-30 19:38:20 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;   5: 2020-01-30 19:38:40 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;  ---                                                                           </span></span>
<span><span class="co">#&gt; 334: 2020-12-17 18:54:40 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt; 335: 2020-12-17 18:55:00 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt; 336: 2020-12-17 18:55:20 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt; 337: 2020-12-17 18:55:40 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt; 338: 2020-12-17 18:56:00 AirCoreNOAA       NOAA             WMO CH4 X2004  2020</span></span>
<span><span class="co">#&gt;      month   day  hour minute second       time time_decimal        value</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt;      &lt;int&gt;        &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:     1    30    19     37     20 1580413040     2020.081 1.912662e-06</span></span>
<span><span class="co">#&gt;   2:     1    30    19     37     40 1580413060     2020.081 1.913034e-06</span></span>
<span><span class="co">#&gt;   3:     1    30    19     38      0 1580413080     2020.081 1.913344e-06</span></span>
<span><span class="co">#&gt;   4:     1    30    19     38     20 1580413100     2020.081 1.913346e-06</span></span>
<span><span class="co">#&gt;   5:     1    30    19     38     40 1580413120     2020.081 1.913906e-06</span></span>
<span><span class="co">#&gt;  ---                                                                     </span></span>
<span><span class="co">#&gt; 334:    12    17    18     54     40 1608231280     2020.961 1.958356e-06</span></span>
<span><span class="co">#&gt; 335:    12    17    18     55      0 1608231300     2020.961 1.958784e-06</span></span>
<span><span class="co">#&gt; 336:    12    17    18     55     20 1608231320     2020.961 1.959021e-06</span></span>
<span><span class="co">#&gt; 337:    12    17    18     55     40 1608231340     2020.961 1.958858e-06</span></span>
<span><span class="co">#&gt; 338:    12    17    18     56      0 1608231360     2020.961 1.959788e-06</span></span>
<span><span class="co">#&gt;      latitude longitude altitude_final type_altitude          local_time    lh</span></span>
<span><span class="co">#&gt;         &lt;num&gt;     &lt;num&gt;          &lt;num&gt;         &lt;int&gt;              &lt;POSc&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;   1:  39.6817 -103.7711       7926.282             1 2020-01-30 12:42:14    12</span></span>
<span><span class="co">#&gt;   2:  39.6792 -103.7686       7795.292             1 2020-01-30 12:42:35    12</span></span>
<span><span class="co">#&gt;   3:  39.6760 -103.7657       7647.354             1 2020-01-30 12:42:56    12</span></span>
<span><span class="co">#&gt;   4:  39.6726 -103.7625       7500.024             1 2020-01-30 12:43:16    12</span></span>
<span><span class="co">#&gt;   5:  39.6695 -103.7596       7357.494             1 2020-01-30 12:43:37    12</span></span>
<span><span class="co">#&gt;  ---                                                                          </span></span>
<span><span class="co">#&gt; 334:  39.4766 -103.8517       2353.402             1 2020-12-17 11:59:15    11</span></span>
<span><span class="co">#&gt; 335:  39.4775 -103.8506       2233.901             1 2020-12-17 11:59:35    11</span></span>
<span><span class="co">#&gt; 336:  39.4784 -103.8497       2121.761             1 2020-12-17 11:59:56    11</span></span>
<span><span class="co">#&gt; 337:  39.4798 -103.8488       2007.779             1 2020-12-17 12:00:16    12</span></span>
<span><span class="co">#&gt; 338:  39.4813 -103.8481       1905.712             1 2020-12-17 12:00:36    12</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="receptors">Receptors<a class="anchor" aria-label="anchor" href="#receptors"></a>
</h2>
<p>Now we can do the last step which is generating the receptor list
files. Now we filter selected columns</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span> <span class="op">&lt;-</span> <span class="va">master</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"site_code"</span>,</span>
<span>                       <span class="st">"year"</span>,</span>
<span>                       <span class="st">"month"</span>,</span>
<span>                       <span class="st">"day"</span>,</span>
<span>                       <span class="st">"hour"</span>,</span>
<span>                       <span class="st">"minute"</span>,</span>
<span>                       <span class="st">"second"</span>,</span>
<span>                       <span class="st">"latitude"</span>,</span>
<span>                       <span class="st">"longitude"</span>,</span>
<span>                       <span class="st">"altitude_final"</span>,</span>
<span>                       <span class="st">"type_altitude"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>We can round altitude also</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span><span class="op">$</span><span class="va">altitude_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">receptor</span><span class="op">$</span><span class="va">altitude_final</span><span class="op">)</span></span></code></pre></div>
<p>Now we can format time variables with two digits</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/obs_format.html">obs_format</a></span><span class="op">(</span><span class="va">receptor</span>,</span>
<span>                        spf <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"month"</span>, <span class="st">"day"</span>,</span>
<span>                                 <span class="st">"hour"</span>, <span class="st">"minute"</span>, <span class="st">"second"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We have a column that indicate AGL or ASL</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receptor_agl</span> <span class="op">&lt;-</span> <span class="va">receptor</span><span class="op">[</span><span class="va">type_altitude</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="va">receptor_asl</span> <span class="op">&lt;-</span> <span class="va">receptor</span><span class="op">[</span><span class="va">type_altitude</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>Finally, we save the receptors</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">receptor_agl</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_AGL.txt"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receptor_agl</span>,</span>
<span>         file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_AGL.txt"</span><span class="op">)</span>,</span>
<span>         sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">receptor_asl</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"_receptor_ASL.txt"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">receptor_asl</span>,</span>
<span>         file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"_"</span>, <span class="va">datasetid</span>, <span class="st">"receptor_ASL.txt"</span><span class="op">)</span>,</span>
<span>         sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; C:\Users\sibarrae\AppData\Local\Temp\RtmpQ33K7x\file8b4862a53ca7_aircore_receptor_ASL.txt</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="plot">Plot<a class="anchor" aria-label="anchor" href="#plot"></a>
</h2>
<p>Finally, we just plot some data, run it locally</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/obs_plot.html">obs_plot</a></span><span class="op">(</span><span class="va">df3</span>, time <span class="op">=</span> <span class="st">"timeUTC"</span>, yfactor <span class="op">=</span> <span class="fl">1e9</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Found the following sites: </span></span>
<span><span class="co">#&gt; [1] AirCoreNOAA</span></span>
<span><span class="co">#&gt; Plotting the following sites: </span></span>
<span><span class="co">#&gt; [1] AirCoreNOAA</span></span>
<span><span class="co">#&gt; png </span></span>
<span><span class="co">#&gt;   2</span></span></code></pre>
<p><img src="https://github.com/noaa-gml/rtorf/blob/main/man/figures/obsplot_aircore.png?raw=true"></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">df3</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="st">"value"</span><span class="op">]</span>, axes <span class="op">=</span> <span class="cn">T</span>, reset <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu">maps</span><span class="fu">::</span><span class="fu">map</span><span class="op">(</span>add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="https://github.com/noaa-gml/rtorf/blob/main/man/figures/obsplot_aircore_map.png?raw=true"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sergio Ibarra-Espinosa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
