# R Tools for Observations, Receptors and Footprints (rtorf)

![](reference/figures/logo.png)

![GitHub commit
activity](https://img.shields.io/github/commit-activity/y/noaa-gml/rtorf)[![R-CMD-check](https://github.com/noaa-gml/rtorf/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/noaa-gml/rtorf/actions/workflows/R-CMD-check.yaml)
![GitHub Repo stars](https://img.shields.io/github/stars/noaa-gml/rtorf)

[NOAA Obspack](https://gml.noaa.gov/ccgg/obspack/) is a collection of
greenhouse gases observations

`rtorf` only depends on `data.table` and `ncdf4`, which is basically
parallel C, so it can be installed in any machine.

## Installation

Using git bash/powershell

``` bash
git clone https://github.com/noaa-gml/rtorf
R CMD INSTALL rtorf
```

Using remotes R package

``` r
remotes::install_github("noaa-gml/rtorf")
```

``` r
library(rtorf)
library(data.table)
utils::packageVersion("rtorf")
```

``` R
## [1] '3.2.2'
```

## ObsPack summary

The first step consists in constructing a summary for ObsPack (CH4, CO2
or other). This is required to read the data, but also, identify `agl`,
which is present in some of the file names. This function returns a
`data.frame`. Optionally, the user can indicate a path to store the
`data.frame`. `obs_summary` also prints a summary of the data. The
second argument is the categories, and by default includes the
categories shown below, to account for all the files. Then the summary
`data.frame` contains the columns `id` as the full path to each file,
`name` which is the name or relative path of the file, `n` just an id,
`sector` such as tower, and the column `agl` which indicates the `agl`
indicated in the name of the file if available. To read the
documentation of this function, the user must run
[`?obs_summary`](https://noaa-gml.github.io/rtorf/reference/obs_summary.md).

> We first define the categories

``` r
cate = c(
  "aircraft-pfp",
  "aircraft-insitu",
  "aircraft-flask",
  "surface-insitu",
  "surface-flask",
  "surface-pfp",
  "tower-insitu",
  "aircore",
  "shipboard-insitu",
  "shipboard-flask"
)

obs <- "Z:/obspack/obspack_ch4_1_GLOBALVIEWplus_v5.1_2023-03-08/data/nc/"
index <- obs_summary(obs = obs, categories = cate)
```

``` R
## Number of files of index: 0
##           sector     N
##           <char> <int>
## 1: Total sectors     0
## Detected 0 files with agl
## Detected 0 files without agl
```

For each one of these dataset ids, check the articles in the
documentation

<https://noaa-gml.github.io/rtorf/>

e.g. for the `aircraft-pfp` we can read $CO_{2}$ and
$CH_{4}$[here](https://noaa-gml.github.io/rtorf/articles/aircraft-pfp.html)

## Implementation in python:

I’m currently implementing a version in python
[pytorf](https://github.com/noaa-gml/pytorf):

## Special thanks to all the

**contributors**

[![Contributors](https://contrib.rocks/image?repo=noaa-gml/rtorf)](https://github.com/noaa-gml/rtorf/graphs/contributors)

and

**Stargazers**

[![](http://reporoster.com/stars/dark/noaa-gml/rtorf)](https://github.com/noaa-gml/rtorf/stargazers)

### Note about legacy code.

I received the task of reformat legacy code used to read PARTICLE.DAT
and generate NetCDF. This code is really old and since STILT and other
have permissive licenses, it is here, however, some code is not exported
to NAMESPACE. A future version of rtorf, will have a new design for the
legacy code, a modern and efficient approach, keeping the essential
tasks.

# Package index

## All functions

- [`fex()`](https://noaa-gml.github.io/rtorf/reference/fex.md) : File
  extension
- [`obs_addltime()`](https://noaa-gml.github.io/rtorf/reference/obs_addltime.md)
  : add local time
- [`obs_addmtime()`](https://noaa-gml.github.io/rtorf/reference/obs_addmtime.md)
  : Add matlab time
- [`obs_addstime()`](https://noaa-gml.github.io/rtorf/reference/obs_addstime.md)
  : Add solar time
- [`obs_addtime()`](https://noaa-gml.github.io/rtorf/reference/obs_addtime.md)
  : Add times
- [`obs_agg()`](https://noaa-gml.github.io/rtorf/reference/obs_agg.md) :
  Aggregates Observations by time
- [`obs_convolve()`](https://noaa-gml.github.io/rtorf/reference/obs_convolve.md)
  : obs_convolve
- [`obs_find_receptors()`](https://noaa-gml.github.io/rtorf/reference/obs_find_receptors.md)
  : Compares expected receptors
- [`obs_foot()`](https://noaa-gml.github.io/rtorf/reference/obs_foot.md)
  : obs_footprints
- [`obs_footname()`](https://noaa-gml.github.io/rtorf/reference/obs_footname.md)
  : Expected footprint name
- [`obs_format()`](https://noaa-gml.github.io/rtorf/reference/obs_format.md)
  : Formatting data
- [`obs_freq()`](https://noaa-gml.github.io/rtorf/reference/obs_freq.md)
  : return numeric vector in intervals
- [`obs_grid()`](https://noaa-gml.github.io/rtorf/reference/obs_grid.md)
  : obs_grid
- [`obs_hysplit_ascdata()`](https://noaa-gml.github.io/rtorf/reference/obs_hysplit_ascdata.md)
  : obs_hysplit_ascdata
- [`obs_hysplit_control()`](https://noaa-gml.github.io/rtorf/reference/obs_hysplit_control.md)
  : obs_hysplit_control
- [`obs_hysplit_control_read()`](https://noaa-gml.github.io/rtorf/reference/obs_hysplit_control_read.md)
  : obs_hysplit_control_read
- [`obs_hysplit_setup()`](https://noaa-gml.github.io/rtorf/reference/obs_hysplit_setup.md)
  : obs_hysplit_setup
- [`obs_id2pos()`](https://noaa-gml.github.io/rtorf/reference/obs_id2pos.md)
  : obs_id2pos
- [`obs_info2id()`](https://noaa-gml.github.io/rtorf/reference/obs_info2id.md)
  : obs_info2id
- [`obs_julian()`](https://noaa-gml.github.io/rtorf/reference/obs_julian.md)
  : obs_julian
- [`obs_list.dt()`](https://noaa-gml.github.io/rtorf/reference/obs_list.dt.md)
  : list.dt
- [`obs_meta()`](https://noaa-gml.github.io/rtorf/reference/obs_meta.md)
  : Read obspack metadata
- [`obs_nc()`](https://noaa-gml.github.io/rtorf/reference/obs_nc.md) :
  obs_nc
- [`obs_nc_get()`](https://noaa-gml.github.io/rtorf/reference/obs_nc_get.md)
  : obs_nc_get
- [`obs_normalize_dmass()`](https://noaa-gml.github.io/rtorf/reference/obs_normalize_dmass.md)
  : obs_normalize_dmass
- [`obs_out()`](https://noaa-gml.github.io/rtorf/reference/obs_out.md) :
  outersect
- [`obs_plot()`](https://noaa-gml.github.io/rtorf/reference/obs_plot.md)
  : Read obspack metadata
- [`obs_rbind()`](https://noaa-gml.github.io/rtorf/reference/obs_rbind.md)
  : rbind obspack
- [`obs_read()`](https://noaa-gml.github.io/rtorf/reference/obs_read.md)
  : Read obspack (.txt)
- [`obs_read_csvy()`](https://noaa-gml.github.io/rtorf/reference/obs_read_csvy.md)
  : reads CSVY
- [`obs_read_nc()`](https://noaa-gml.github.io/rtorf/reference/obs_read_nc.md)
  : Read obspack (.nc)
- [`obs_read_nc_att()`](https://noaa-gml.github.io/rtorf/reference/obs_read_nc_att.md)
  : Read obspack attributes (.nc)
- [`obs_roundtime()`](https://noaa-gml.github.io/rtorf/reference/obs_roundtime.md)
  : round seconds from "POSIXct" "POSIXt" classes
- [`obs_select_sec()`](https://noaa-gml.github.io/rtorf/reference/obs_select_sec.md)
  : Select Observations by closest time (seconds)
- [`obs_summary()`](https://noaa-gml.github.io/rtorf/reference/obs_summary.md)
  [`obs_index()`](https://noaa-gml.github.io/rtorf/reference/obs_summary.md)
  : Summary of the ObsPack files (.txt)
- [`obs_table()`](https://noaa-gml.github.io/rtorf/reference/obs_table.md)
  : Obspack Table Summary
- [`obs_traj_foot()`](https://noaa-gml.github.io/rtorf/reference/obs_traj_foot.md)
  : obs_traj_foot
- [`obs_trunc()`](https://noaa-gml.github.io/rtorf/reference/obs_trunc.md)
  : Trunc numbers with a desired number of decimals
- [`obs_write_csvy()`](https://noaa-gml.github.io/rtorf/reference/obs_write_csvy.md)
  : Generates YAML and write data.frame
- [`sr()`](https://noaa-gml.github.io/rtorf/reference/sr.md) : Extacts n
  last characters

# Articles

### All vignettes

- [aircore](https://noaa-gml.github.io/rtorf/articles/aircore.md):
- [aircraft-flask](https://noaa-gml.github.io/rtorf/articles/aircraft-flask.md):
- [aircraft-insitu](https://noaa-gml.github.io/rtorf/articles/aircraft-insitu.md):
- [aircraft-pfp](https://noaa-gml.github.io/rtorf/articles/aircraft-pfp.md):
- [hysplit](https://noaa-gml.github.io/rtorf/articles/hysplit.md):
- [shipboard-flask](https://noaa-gml.github.io/rtorf/articles/shipboard-flask.md):
- [shipboard-insitu](https://noaa-gml.github.io/rtorf/articles/shipoboard-insitu.md):
- [summary](https://noaa-gml.github.io/rtorf/articles/summary.md):
- [surface-flask](https://noaa-gml.github.io/rtorf/articles/surface-flask.md):
- [surface-insitu](https://noaa-gml.github.io/rtorf/articles/surface-insitu.md):
- [surface-pfp](https://noaa-gml.github.io/rtorf/articles/surface-pfp.md):
- [tower-insitu](https://noaa-gml.github.io/rtorf/articles/tower-insitu.md):
